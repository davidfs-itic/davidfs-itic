{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Documentaci\u00f3 Cicles Formatius Fam\u00edlia Inform\u00e0tica","text":""},{"location":"#contingut","title":"Contingut","text":"<ul> <li>Android</li> <li> <p>Exemples de codi Android</p> </li> <li> <p>Arduino </p> </li> <li> <p>IoT</p> </li> </ul>"},{"location":"#_1","title":"Inici","text":""},{"location":"Android/","title":"Introducci\u00f3 al desenvolupament en Android","text":""},{"location":"Android/#contingut","title":"Contingut","text":"<ul> <li>Llenguatge Kotlin</li> <li>Interficies</li> <li>Arquitectura</li> <li>Llibreries</li> <li>Firebase</li> </ul>"},{"location":"Android/activities/","title":"Activities","text":"<p>Per Fer!</p>"},{"location":"Android/fragments/","title":"Fragments","text":"<p>Documentaci\u00f3 oficial</p> <ul> <li>https://developer.android.com/guide/fragments</li> </ul> <p>Exemple pas a pas - https://cursokotlin.com/capitulo-22-fragments-en-kotlin/</p>"},{"location":"Android/fragments/#1-introduccio-als-fragments-que-son-i-per-que-utilitzar-los","title":"1-Introducci\u00f3 als Fragments Qu\u00e8 s\u00f3n i per qu\u00e8 utilitzar-los?","text":"<p>Definici\u00f3: Components reutilitzables d'UI que representen una part d'una pantalla dins d'una Activity. Cada fragment t\u00e9 el seu cicle de vida. Han d'existir dins d'una activity o d'un altre fragment.</p> <p>Avantatges:</p> <ul> <li> <p>Reutilitzaci\u00f3: El mateix fragment pot usar-se en m\u00faltiples activities.</p> </li> <li> <p>Disseny adaptable: Diferents layouts per m\u00f2bils/tablets.</p> </li> <li> <p>Modularitat: Divideix la UI en components independents.</p> </li> <li> <p>Comparaci\u00f3: Els fragments s\u00f3n com \"sub-activitats\" amb cicle de vida propi.</p> </li> </ul> <p>Mostra visual d'una activity amb 2 fragments: </p>"},{"location":"Android/fragments/#2-anatomia-dun-fragment","title":"2-Anatomia d'un Fragment","text":""},{"location":"Android/fragments/#estructura-basica","title":"Estructura b\u00e0sica","text":"<p>Els fragments tenen layouts igual que les activities, en xml.</p> <p>Tamb\u00e9 tenen la seva classe Fragment() de la qual herata i sobreescriu m\u00e8todes clau: <pre><code>class NewFragment : Fragment() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n    }\n\n    override fun onCreateView(\n        inflater: LayoutInflater, container: ViewGroup?,\n        savedInstanceState: Bundle?\n    ): View? {\n        // Inflate the layout for this fragment\n        return inflater.inflate(R.layout.fragment_blank, container, false)\n    }\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        val someInt = requireArguments().getInt(\"some_int\")\n        ...\n    }    \n</code></pre></p>"},{"location":"Android/fragments/#metodes-essencials","title":"M\u00e8todes essencials:","text":"<ul> <li> <p>onCreateView(): Infla el layout i retorna la View.</p> </li> <li> <p>onViewCreated(): Configura les vistes un cop creades.</p> </li> </ul>"},{"location":"Android/fragments/#cicle-de-vida-del-fragment","title":"Cicle de vida del Fragment","text":"<p>Punt important: onDestroyView() es crida abans que onDestroy(), alliberant la vista.</p> <p>Refer\u00e8ncia: Cicle de vida dels Fragments: https://developer.android.com/guide/fragments/lifecycle</p>"},{"location":"Android/fragments/#3-implementacio-basica","title":"3-Implementaci\u00f3 B\u00e0sica","text":""},{"location":"Android/fragments/#afegir-fragments-a-una-activity","title":"Afegir fragments a una Activity","text":"<p>M\u00e8tode est\u00e0tic: Via XML amb etiqueta (per fragments fixos). <pre><code>&lt;androidx.fragment.app.FragmentContainerView\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:id=\"@+id/fragmentContainerView\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" /&gt;\n</code></pre> M\u00e8tode din\u00e0mic: Via FragmentManager i FragmentTransaction (m\u00e9s flexible).</p>"},{"location":"Android/fragments/#fragmentmanager-i-fragmenttransaction","title":"FragmentManager i FragmentTransaction","text":"<p>Refer\u00e8ncies: https://developer.android.com/guide/fragments/fragmentmanager</p> <p>El fragmentmanager \u00e9s la classe responsable d'afegir, eliminar i la resta d'accions sobre un fragment. Al fragmentmanager hi accedim des de l'activity a trav\u00e9s de la funci\u00f3 supportFragmentManager.</p> <p>Des del fragment, podem accedir al fragmentmanager de la app, amb la funci\u00f3 getParentFragmentManager().</p> <p></p>"},{"location":"Android/fragments/#afegir-fragment-a-un-fragmentcontainer","title":"Afegir fragment a un fragmentcontainer","text":"<p>Hi ha 2 maneres de carregar un fragment, afegint-lo a l'stack, o reempla\u00e7ant-lo.</p> <ul> <li>BackStack: Permet tornar enrrere per tota la pila (stack) de fragments afegits.</li> <li>Replace: Substitueix la pila anterior per un altre. Nom\u00e9s es pot tornar al fragment substituit.</li> </ul> <p></p> <pre><code>    //Afegeix el fragment i l'afegeix a la pila (backstack)\n    // de manera que tornar enrrere, tornara al fragment anterior.\n    private fun addFragment(fragment: Fragment,args : Bundle?) {\n        fragment.arguments = args\n        val fragmentTransaction = supportFragmentManager.beginTransaction()\n        fragmentTransaction.add(R.id.fragmentbottom, fragment)\n        fragmentTransaction.addToBackStack(null)\n        fragmentTransaction.commit()\n    }\n    //Intercanvia el fragment. Tornar enrrere no tornara al fragment anterior.\n    private fun replaceFragment(fragment: Fragment,args : Bundle?){\n        fragment.arguments = args\n        val fragmentTransaction = supportFragmentManager.beginTransaction()\n        fragmentTransaction.replace(R.id.fragmentbottom, fragment)\n        fragmentTransaction.commit()\n    }\n</code></pre> <p>Amb la versi\u00f3 m\u00e9s moderna (segons la documentaci\u00f3 de android).</p> <p>Cal afegir les dependiencies: <pre><code>dependencies {\n    implementation \"androidx.fragment:fragment-ktx:1.6.2\"\n    // o la versi\u00f3 m\u00e9s recent disponible\n}\n</code></pre></p> <p>i el codi es transforma en el seg\u00fcent:</p> <pre><code>private fun addFragment(fragment: Fragment, args: Bundle?) {\n    supportFragmentManager.commit {\n        setReorderingAllowed(true)\n        add(R.id.fragmentbottom, fragment::class.java, args)\n        addToBackStack(null)\n    }\n}\n</code></pre>"},{"location":"Android/fragments/#4-comunicacio","title":"4-Comunicaci\u00f3","text":""},{"location":"Android/fragments/#accedir-a-lactivity-des-del-fragment","title":"Accedir a l'Activity des del Fragment","text":"<p>De vegades necessitem accedir a l'activity, per exemple si necessitem modificar la appbar o toolbar.</p> <pre><code>// Forma segura - llan\u00e7a excepci\u00f3 si no hi ha activity\nval activity = requireActivity()\n\n// Forma nullable - retorna null si no hi ha activity  \nval activity = activity\n\n// Modificar Toolbar\n(requireActivity() as AppCompatActivity).supportActionBar?.title = \"Nou T\u00edtol\"\n</code></pre>"},{"location":"Android/fragments/#patro-de-callbacks","title":"Patr\u00f3 de Callbacks","text":"<p><pre><code>class ExempleFragment : Fragment() {\n\n    interface OnDataListener {\n        fun onDataReceived(data: String)\n    }\n\n    private var callback: OnDatatListener? = null\n\n    override fun onAttach(context: Context) {\n        super.onAttach(context)\n        if (context is OnDataListener) {\n            callback = context\n        } else {\n            throw RuntimeException(\"$context must implement OnDataListener\")\n        }\n    }\n\n    override fun onDetach() {\n        super.onDetach()\n        callback = null\n    }\n\n    // Exemple: alg\u00fa prem un bot\u00f3 al fragment\n    private fun enviarDades() {\n        callback?.onDataReceived(\"Hola des del fragment!\")\n    }\n}\n\nclass MainActivity : AppCompatActivity(), ExempleFragment.OnDataListener {\n\n    override fun onDataReceived(data: String) {\n        // Fer alguna cosa amb les dades rebudes\n        Log.d(\"MainActivity\", data)\n    }\n}\n</code></pre> Avantatge: Desacobla el fragment de l'activity espec\u00edfica.</p>"},{"location":"Android/fragments/#amb-shared-viewmodels","title":"Amb shared Viewmodels","text":"<p>Vegeu documentaci\u00f3 a Shared Viewmodels</p>"},{"location":"Android/fragments/#5-animacio-de-les-transicions-entre-fragments","title":"5-Animaci\u00f3 de les transicions entre fragments","text":"<p>Podem definir les animacions a la carpeta res/anim (tipus anim)</p> <p>Arxius:</p> <p>fade_out.xml <pre><code>&lt;!-- res/anim/fade_out.xml --&gt;\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;alpha xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:interpolator=\"@android:anim/decelerate_interpolator\"\n    android:fromAlpha=\"1\"\n    android:toAlpha=\"0\" /&gt;\n</code></pre></p> <p>fade_in.xml <pre><code>&lt;!-- res/anim/slide_in.xml --&gt;\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;translate xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:interpolator=\"@android:anim/decelerate_interpolator\"\n    android:fromXDelta=\"100%\"\n    android:toXDelta=\"0%\" /&gt;\n</code></pre> En la transacci\u00f3 que intercanvia els fragments</p> <pre><code>        fragmentTransaction.setCustomAnimations(\n            R.anim.fade_out, // exit\n            R.anim.fade_in, // popEnter\n        )\n</code></pre>"},{"location":"Android/fragments/#definir-la-animacio-en-entrar-o-sortir-en-el-oncreate","title":"Definir la animacio en entrar o sortir en el onCreate","text":"<p>Es creen els arxius en la carpeta res/transition (type transition)</p> <p>Arxiu fade.xml <pre><code>&lt;!-- res/transition/fade.xml --&gt;\n&lt;fade xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"/&gt;\n</code></pre> Arxiu slide.xml <pre><code>&lt;slide xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:slideEdge=\"right\" /&gt;\n</code></pre></p> <p>en els fragments: <pre><code>class FragmentA : Fragment() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        val inflater = TransitionInflater.from(requireContext())\n        exitTransition = inflater.inflateTransition(R.transition.fade)\n    }\n}\n\nclass FragmentB : Fragment() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        val inflater = TransitionInflater.from(requireContext())\n        enterTransition = inflater.inflateTransition(R.transition.slide_right)\n    }\n}\n</code></pre></p>"},{"location":"Android/Arquitectura/","title":"Arquitectura","text":"<p>Si seguim les indicacions de google i de molts altres desenvolupadors, veurem que qualsevol aplicaci\u00f3 ha d'estar estructurada per \"capes\", o funcionalitats separades.</p> <p>Vegeu com a refer\u00e8ncia aquest document: https://developer.android.com/topic/architecture (Dins hi trobareu la Guide to app architecture)</p> <p>Cursos (tutorial) de Android: https://developer.android.com/courses/pathways/android-architecture</p> <p>Elements de l'arquitectura:</p> <ul> <li>ViewModel</li> <li>Application ViewModel</li> <li>Observer</li> <li></li> <li></li> <li>Inversi\u00f3 de Depend\u00e8ncies</li> <li>Patr\u00f3 Factory</li> <li>Exemple DIP recycler </li> <li>Principis SOLID</li> </ul>"},{"location":"Android/Arquitectura/applicationviewmodel/","title":"Application ViewModel","text":""},{"location":"Android/Arquitectura/applicationviewmodel/#1-que-es-lapplicationviewmodel","title":"1. Qu\u00e8 \u00e9s l'ApplicationViewModel","text":"<p>ApplicationViewModel es refereix a una inst\u00e0ncia de ViewModel que est\u00e0 vinculada al cicle de vida de l'aplicaci\u00f3 sencera mitjan\u00e7ant la classe Application d'Android.</p> <p>\u00c0mbit (Scope): Si un ViewModel s'associa amb l'objecte Application (que actua com a ViewModelStoreOwner), aquest ViewModel existir\u00e0 durant tota la vida de l'aplicaci\u00f3. Es destrueix nom\u00e9s quan el proc\u00e9s de l'aplicaci\u00f3 es finalitza pel sistema operatiu.</p> <p>AndroidViewModel: La classe AndroidViewModel \u00e9s una subclasse de ViewModel que rep l'objecte Application al seu constructor, cosa que li permet accedir a recursos a nivell d'aplicaci\u00f3 (com Context) de manera segura (sense provocar fugues de mem\u00f2ria).</p> <p>L'Application ViewModel s'utilitza principalment per a la gesti\u00f3 de dades a nivell global que han de sobreviure a tota la vida de l'aplicaci\u00f3 i ser accessibles des de qualsevol punt de la UI.</p> <p>\u00c9s important notar que, en lloc d'utilitzar directament la classe base ViewModel, utilitzem la seva subclasse AndroidViewModel.</p> <p>Refer\u00e8ncia: https://www.youtube.com/watch?v=THt9QISnIMQ&amp;t=51s</p>"},{"location":"Android/Arquitectura/applicationviewmodel/#2-creacio-de-landroidviewmodel","title":"2. Creaci\u00f3 de l'AndroidViewModel:","text":"<p>Per crear un \"Application ViewModel\" de forma correcta, cal estendre la classe AndroidViewModel</p> <pre><code>// Exemple: Aplicaci\u00f3 per gestionar les prefer\u00e8ncies d'usuari globals\nclass AppViewModel(application: Application) : AndroidViewModel(application) {\n\n    // 1. Variable privada modificable (MutableLiveData)\n    private val _counter = MutableLiveData&lt;Int&gt;() \n\n    // 2. Variable p\u00fablica no modificable (LiveData)\n    // Aquesta \u00e9s la variable que les Vistes (Fragments/Activities) observaran.\n    val counter: LiveData&lt;Int&gt; = _counter\n\n    // 3. Inicialitzaci\u00f3\n    init {\n        _counter.value = 0 \n    }\n\n    // 4. M\u00e8tode per modificar l'estat (la l\u00f2gica de negoci)\n    fun incrementCounter() {\n        // Utilitzem el m\u00e8tode 'value' per assignaci\u00f3 s\u00edncrona\n        val currentValue = _counter.value ?: 0\n        _counter.value = currentValue + 1\n    }\n\n    fun decrementCounter() {\n        val currentValue = _counter.value ?: 0\n        _counter.value = currentValue - 1\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/applicationviewmodel/#3-instanciacio","title":"3. Instanciaci\u00f3","text":"<p>Des d'una Activity o un Fragment, s'utilitza la funci\u00f3 de delegat viewModels()</p> <p>En realitat, el framework de ViewModel ja gestiona autom\u00e0ticament la depend\u00e8ncia de l'Application quan detecta que s'est\u00e0 utilitzant la subclasse AndroidViewModel.</p> <pre><code>private val appViewModel: AppPreferencesViewModel by viewModels()\n</code></pre> <p>No cal que passis expl\u00edcitament l'objecte Application a viewModels() o a ViewModelProvider perqu\u00e8 el sistema ja s'encarrega de fer-ho autom\u00e0ticament per tu quan utilitzes la subclasse correcta.</p> <p>Quan crides a viewModels(), Android utilitza un objecte anomenat ViewModelProvider.Factory. Per defecte, si no en proporciones un de propi, s'utilitza el DefaultViewModelProviderFactory.</p> <p>Aquesta Factory per defecte cont\u00e9 l\u00f2gica espec\u00edfica per gestionar els dos casos m\u00e9s comuns:</p>"},{"location":"Android/Arquitectura/applicationviewmodel/#cas-1-viewmodel-base-class-myviewmodel-viewmodel","title":"Cas 1: ViewModel Base (class MyViewModel : ViewModel)","text":"<p>La Factory intenta instanciar-lo directament utilitzant el seu constructor sense arguments (constructor buit).</p>"},{"location":"Android/Arquitectura/applicationviewmodel/#cas-2-androidviewmodel-class-myappviewmodel-androidviewmodel","title":"Cas 2: AndroidViewModel (class MyAppViewModel : AndroidViewModel)","text":"<p>La Factory detecta que la classe del ViewModel sol\u00b7licitat \u00e9s una subclasse d'AndroidViewModel.</p> <p>Quan detecta AndroidViewModel, autom\u00e0ticament mira el ViewModelStoreOwner (que \u00e9s el teu Activity o Fragment) i n'extreu l'objecte Application associat (a trav\u00e9s del Context ).</p> <p>Finalment, utilitza aquest objecte Application per cridar al constructor de la teva classe: AppPreferencesViewModel(application).</p> <p>Info</p> <p>Tota Activity i Fragment t\u00e9 acc\u00e9s al Context, i mitjan\u00e7ant el context, es pot accedir a l'objecte Application de l'aplicaci\u00f3. $$\\text{Activity/Fragment} \\rightarrow \\text{Context} \\rightarrow \\text{Application}$$</p>"},{"location":"Android/Arquitectura/applicationviewmodel/#4-utilitzacio","title":"4. Utilitzaci\u00f3","text":"<pre><code>class CounterFragment : Fragment() {\n\n    // Instanciaci\u00f3: Obtenim la mateixa inst\u00e0ncia del ViewModel Global\n    // El sistema sap que \u00e9s un AndroidViewModel i li passa l'Application\n    private val appViewModel: AppViewModel by viewModels()\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        appViewModel.counter.observe(viewLifecycleOwner) { count -&gt;\n            // Actualitzaci\u00f3 autom\u00e0tica de la UI quan canvia el valor\n            counterTextView.text = \"Comptador Global: $count\"\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_android/","title":"Capa repositori i dades","text":"<p>Documents rellevants:</p> <ul> <li>https://developer.android.com/topic/architecture/data-layer</li> <li>https://developer.android.com/topic/architecture/domain-layer</li> </ul>"},{"location":"Android/Arquitectura/capa_dades_android/#1-situacio-inicial","title":"1. Situaci\u00f3 inicial","text":"<p>Partint del codi relatiu al RecyclerView, veurem que t\u00e9 algunes mancances o dificultats. No respecta els principis de clean code, ni t\u00e9 cap arquitectura definida:</p>"},{"location":"Android/Arquitectura/capa_dades_android/#problemes-darquitectura","title":"Problemes d'arquitectura","text":"<p>Abs\u00e8ncia de separaci\u00f3 de capes: La Activity accedeix directament a les dades (directament a la llista en mem\u00f2ria o mitjan\u00e7ant una API). Aix\u00f2 crea un acoblament fort i dificulta enormement el testing i el manteniment.</p> <p>DataSource com a singleton est\u00e0tic: Qualsevol canvi en com s'obtenen les dades (API, base de dades local, etc.) requerir\u00e0 modificar directament la Activity, per\u00f2 tamb\u00e9 tots els llocs on s'utilitza.</p> <p>L\u00f2gica de negoci a la UI: La Activity est\u00e0 fent massa coses: configura el RecyclerView, gestiona el clic, i decideix qu\u00e8 mostrar (el Toast o l'error). No hi ha cap ViewModel ni cap capa interm\u00e8dia que gestioni l'estat o la l\u00f2gica.</p>"},{"location":"Android/Arquitectura/capa_dades_android/#problemes-que-pot-ocasionar","title":"Problemes que pot ocasionar","text":"<ul> <li>Escalabilitat nul\u00b7la: Quan el projecte creixi i necessitis m\u00faltiples fonts de dades, c\u00e0rrega as\u00edncrona, cach\u00e9, o sincronitzaci\u00f3, aquest codi ser\u00e0 molt dif\u00edcil de mantenir.</li> <li>Impossibilitat de testing autom\u00e0tic: Aquest codi fa els tests pr\u00e0cticament impossibles.</li> <li>Duplicaci\u00f3 de codi futura: Sense una arquitectura clara, cada nova funcionalitat similar acabar\u00e0 repetint patrons, copiant i enganxant codi.</li> </ul>"},{"location":"Android/Arquitectura/capa_dades_android/#2-analisi-del-codi-incorrecte-sense-separacio-de-capes","title":"2. An\u00e0lisi del codi incorrecte (sense separaci\u00f3 de capes)","text":"<p>Item: Classe que cont\u00e9 les dades que necessitem (pot ser recepta, pel\u00b7l\u00edcula, reserva, itemcompra, ticket, etc.)</p> <pre><code>// Fitxer: MyItem.kt\ndata class MyItem(\n    val id: Int,\n    val title: String,\n    val subtitle: String\n)\n</code></pre> <p>DataSource: Classe (objecte en aquest cas) que cont\u00e9 la llista d'items</p> <pre><code>// Fitxer: DataSource.kt\n\n/**\n * Objecte singleton que proporciona dades en mem\u00f2ria\n * per ser utilitzades al RecyclerView.\n */\nobject DataSource {\n\n    // Llista de dades en mem\u00f2ria (nom\u00e9s de lectura)\n    val items: List&lt;MyItem&gt; = listOf(\n        MyItem(1, \"Element 1\", \"Subt\u00edtol 1\"),\n        MyItem(2, \"Element 2\", \"Subt\u00edtol 2\"),\n        MyItem(3, \"Element 3\", \"Subt\u00edtol 3\"),\n        MyItem(4, \"Element 4\", \"Subt\u00edtol 4\")\n    )\n}\n</code></pre> <p>Des de l'Activity, es crea la llista d'items, la qual cosa \u00e9s incorrecte doncs no \u00e9s la tasca de l'Activity.</p> <pre><code>// A dins de l'Activity:\nval items = DataSource.items\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_android/#objectiu-separar-la-ui-de-les-dades","title":"Objectiu: separar la UI de les dades","text":"<p>Hem de fer que les dades siguin independents de la UI, perqu\u00e8 la UI pugui cridar un m\u00e8tode gen\u00e8ric sense saber d'on venen les dades ni com s'obtenen.</p> <p>La classe que coordina l'acc\u00e9s a les dades s'anomena Repository, i pertany a la capa de dades (Data Layer).</p>"},{"location":"Android/Arquitectura/capa_dades_android/#3-arquitectura-en-2-capes-ui-dades","title":"3. Arquitectura en 2 capes (UI + Dades)","text":"<p>Seguint l'arquitectura oficial d'Android, separarem el codi en dues capes:</p> <ol> <li>UI Layer (Activity, Fragment, ViewModel)</li> <li>Data Layer (Repository + DataSources)</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UI LAYER                                            \u2502\n\u2502  Activity/Fragment \u2192 ViewModel                       \u2502\n\u2502  (dep\u00e8n del Repository)                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DATA LAYER                                          \u2502\n\u2502                                                      \u2502\n\u2502  ItemsRepository (classe concreta)                   \u2502\n\u2502  \u2514\u2500\u2192 ItemsDataSource (interface)                     \u2502\n\u2502      \u251c\u2500\u2192 MockItemsDataSource                         \u2502\n\u2502      \u251c\u2500\u2192 RetrofitItemsDataSource                     \u2502\n\u2502      \u2514\u2500\u2192 RoomItemsDataSource                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>El Repository \u00e9s una classe concreta que actua com a punt d'entrada a la capa de dades. El ViewModel el rep directament.</p> <p>Els DataSources s\u00f3n classes que implementen una interface, la qual cosa permet intercanviar la font de dades (Mock, API, Room) sense modificar el Repository.</p>"},{"location":"Android/Arquitectura/capa_dades_android/#4-implementacio","title":"4. Implementaci\u00f3","text":""},{"location":"Android/Arquitectura/capa_dades_android/#capa-de-dades-data-layer","title":"Capa de Dades (Data Layer)","text":""},{"location":"Android/Arquitectura/capa_dades_android/#interface-del-datasource","title":"Interface del DataSource","text":"<p>Defineix el contracte que han de complir totes les fonts de dades:</p> <pre><code>interface ItemsDataSource {\n   fun getItems(): List&lt;MyItem&gt;\n   fun addItem(item: MyItem)\n   fun updateItem(item: MyItem)\n   fun deleteItem(item: MyItem)\n}\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_android/#datasources-concrets","title":"DataSources concrets","text":"<p>Ara podem crear m\u00faltiples DataSources, amb implementacions diferents (Mock, API, base de dades):</p> <p>Qu\u00e8 \u00e9s Mock?</p> <p>Mock es refereix a dades falses, i s'utilitza en programaci\u00f3 per provar les classes abans no es tingui una base de dades, API, etc. En aquest cas, el MockItemsDataSource \u00e9s una llista precodificada (com hav\u00edem fet abans en el nostre object DataSource).</p> <pre><code>class MockItemsDataSource : ItemsDataSource {\n   private val items = mutableListOf(\n       MyItem(1, \"T\u00edtol 1\", \"Subt\u00edtol A\"),\n       MyItem(2, \"T\u00edtol 2\", \"Subt\u00edtol B\"),\n       MyItem(3, \"T\u00edtol 3\", \"Subt\u00edtol C\")\n   )\n   override fun getItems(): List&lt;MyItem&gt; = items\n   override fun addItem(item: MyItem) { items.add(item) }\n   override fun updateItem(item: MyItem) { /* implementaci\u00f3 */ }\n   override fun deleteItem(item: MyItem) { /* implementaci\u00f3 */ }\n}\n\n\nclass RetrofitItemsDataSource : ItemsDataSource {\n   override fun getItems(): List&lt;MyItem&gt; { /* crida a l'API */ }\n   override fun addItem(item: MyItem) { /* crida a l'API */ }\n   override fun updateItem(item: MyItem) { /* crida a l'API */ }\n   override fun deleteItem(item: MyItem) {\n       RetrofitClient.instance.deleteItem(item.id).execute()\n   }\n}\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_android/#repository","title":"Repository","text":"<p>El Repository \u00e9s una classe concreta (sense interface). Rep un DataSource i li delega l'acc\u00e9s a les dades. No sap (ni li importa) si el DataSource \u00e9s Mock, Retrofit o Room:</p> <pre><code>class ItemsRepository(\n    private val dataSource: ItemsDataSource\n) {\n    fun getItems(): List&lt;MyItem&gt; {\n        return dataSource.getItems()\n    }\n\n    fun addItem(item: MyItem) {\n        dataSource.addItem(item)\n    }\n\n    fun updateItem(item: MyItem) {\n        dataSource.updateItem(item)\n    }\n\n    fun deleteItem(item: MyItem) {\n        dataSource.deleteItem(item)\n    }\n}\n</code></pre> <p>Per qu\u00e8 el Repository \u00e9s \u00fatil, si ara mateix nom\u00e9s delega al DataSource? Perqu\u00e8 quan el projecte creixi, el Repository ser\u00e0 el lloc on afegir:</p> <ul> <li>Gesti\u00f3 de cach\u00e9</li> <li>Combinaci\u00f3 de m\u00faltiples fonts de dades (local + remota)</li> <li>Decisi\u00f3 de quan usar dades locals vs remotes</li> <li>Transformaci\u00f3 de dades entre capes</li> <li>Gesti\u00f3 d'errors i fallbacks</li> </ul> <p>El DataSource, en canvi, s'encarrega NOM\u00c9S d'obtenir/guardar dades d'una font espec\u00edfica.</p>"},{"location":"Android/Arquitectura/capa_dades_android/#capa-ui-ui-layer","title":"Capa UI (UI Layer)","text":"<p>El ViewModel rep el Repository directament:</p> <pre><code>class ItemsViewModel(\n    private val repository: ItemsRepository\n) : ViewModel() {\n\n    fun getItems(): List&lt;MyItem&gt; {\n        return repository.getItems()\n    }\n\n    fun addItem(item: MyItem) {\n        repository.addItem(item)\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_android/#com-es-connecta-tot","title":"Com es connecta tot","text":"<p>A l'hora de crear les inst\u00e0ncies, decidim quina implementaci\u00f3 del DataSource utilitzem:</p> <pre><code>// Triem el DataSource segons l'entorn\nval dataSource: ItemsDataSource = if (isTesting) {\n    MockItemsDataSource()\n} else {\n    RetrofitItemsDataSource()\n}\n\n// Creem el Repository amb el DataSource triat\nval repository = ItemsRepository(dataSource)\n\n// Ja podem fer servir el repository independentment de la font de dades\nrepository.addItem(MyItem(5, \"Nou element\", \"Subt\u00edtol nou\"))\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_android/#5-capa-de-domini-opcional","title":"5. Capa de Domini (opcional)","text":"<p>Segons la documentaci\u00f3 oficial d'Android, la capa de Domini \u00e9s opcional. S'afegeix quan necessitem Use Cases: l\u00f2gica de negoci reutilitzable entre diferents ViewModels.</p> <p>Veure la documentaci\u00f3 oficial de Domain Layer</p> <p>En l'arquitectura Android, la direcci\u00f3 de les depend\u00e8ncies \u00e9s natural (cap avall):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UI LAYER                     \u2502\n\u2502  ViewModel                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 dep\u00e8n de\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DOMAIN LAYER (opcional)      \u2502\n\u2502  Use Cases                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 dep\u00e8n de\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DATA LAYER                   \u2502\n\u2502  Repository + DataSources     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>El Domain Layer dep\u00e8n del Data Layer (utilitza el Repository). Simplement afegeix una capa d'intermediaris (Use Cases) entre la UI i les dades.</p> <p>Info</p> <p>Veure apartat de Use Cases per a m\u00e9s detalls.</p>"},{"location":"Android/Arquitectura/capa_dades_android/#6-principis-aplicats","title":"6. Principis aplicats","text":"<ul> <li>Single Responsibility: Cada classe t\u00e9 una \u00fanica responsabilitat.</li> <li>Separation of Concerns: La UI no sap d'on venen les dades, el Repository no sap com s'obtenen, el DataSource no sap qui el crida.</li> </ul>"},{"location":"Android/Arquitectura/capa_dades_android/#inversio-de-dependencies-dip-entre-repository-i-datasource","title":"Inversi\u00f3 de depend\u00e8ncies (DIP) entre Repository i DataSource","text":"<p>Dins la capa de dades, s'aplica el principi d'inversi\u00f3 de depend\u00e8ncies entre el Repository i els DataSources.</p> <p>Sense DIP, el Repository dependria directament d'una implementaci\u00f3 concreta:</p> <pre><code>// \u274c Sense DIP: el Repository dep\u00e8n d'una classe concreta\nclass ItemsRepository() {\n    private val dataSource = MockItemsDataSource()  // acoblament fort\n\n    fun getItems(): List&lt;MyItem&gt; {\n        return dataSource.getItems()\n    }\n}\n</code></pre> <p>Si volem canviar de <code>MockItemsDataSource</code> a <code>RetrofitItemsDataSource</code>, hem de modificar el Repository.</p> <p>Amb DIP, el Repository dep\u00e8n d'una abstracci\u00f3 (interface):</p> <pre><code>// \u2705 Amb DIP: el Repository dep\u00e8n de la interface\nclass ItemsRepository(\n    private val dataSource: ItemsDataSource  // interface, no implementaci\u00f3\n) {\n    fun getItems(): List&lt;MyItem&gt; {\n        return dataSource.getItems()\n    }\n}\n</code></pre> <pre><code>                    ItemsDataSource (interface)\n                   \u2571                          \u2572\n                  \u2571   dep\u00e8n de      implementa \u2572\n                 \u2571                               \u2572\n    ItemsRepository              MockItemsDataSource\n    (m\u00f2dul alt nivell)           RetrofitItemsDataSource\n                                 RoomItemsDataSource\n                                 (m\u00f2duls baix nivell)\n</code></pre> <p>Tant el m\u00f2dul d'alt nivell (Repository) com els de baix nivell (DataSources concrets) depenen de l'abstracci\u00f3. Aix\u00f2 \u00e9s el principi DIP:</p> <p>\"Els m\u00f2duls d'alt nivell no han de dependre dels m\u00f2duls de baix nivell. Ambd\u00f3s han de dependre d'abstraccions.\"</p> <p>D'aquesta manera, podem canviar la implementaci\u00f3 del DataSource (de Mock a Retrofit, de Retrofit a Room) sense tocar ni una l\u00ednia del Repository ni de la UI.</p> <p>Note</p> <p>En l'arquitectura Android, la DIP s'aplica a nivell de classe (entre Repository i DataSource), no entre capes. Per veure la DIP aplicada entre capes, consulteu l'apartat de Clean Architecture (secci\u00f3 7).</p> <p></p>"},{"location":"Android/Arquitectura/capa_dades_android/#7-diferencies-amb-clean-architecture","title":"7. Difer\u00e8ncies amb Clean Architecture","text":"<p>L'arquitectura oficial d'Android i Clean Architecture (Uncle Bob) comparteixen la idea de separar en capes, per\u00f2 tenen difer\u00e8ncies importants:</p> Arquitectura Android Clean Architecture Repository Classe concreta al Data Layer Interface al Domain + Implementaci\u00f3 al Data Domain Layer Opcional. Cont\u00e9 Use Cases Obligatori. \u00c9s el nucli de l'aplicaci\u00f3 Domain dep\u00e8n de... Data Layer (direcci\u00f3 natural) Res. \u00c9s completament independent Direcci\u00f3 depend\u00e8ncies UI \u2192 Domain \u2192 Data (cap avall) UI \u2192 Domain \u2190 Data (inversi\u00f3 entre capes) DIP entre capes No. Nom\u00e9s a nivell de classe (DataSource interface) S\u00ed. El Data Layer implementa interfaces definides al Domain"},{"location":"Android/Arquitectura/capa_dades_android/#diagrama-comparatiu","title":"Diagrama comparatiu","text":"<pre><code>ANDROID ARCHITECTURE:           CLEAN ARCHITECTURE:\n\nUI \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Domain \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Data  UI \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Domain \u25c0\u2500\u2500\u2500\u2500\u2500\u2500 Data\n          (opcional)                     (obligatori)\n     tot cap avall                  tot apunta al Domain\n</code></pre> <p>En Clean Architecture, el Domain defineix les interfaces (contractes): la UI en dep\u00e8n (a trav\u00e9s dels Use Cases) i el Data les implementa. El Domain no dep\u00e8n de ning\u00fa, \u00e9s el nucli estable de l'aplicaci\u00f3.</p> <p>Nota important</p> <p>La documentaci\u00f3 oficial d'Android inclou aquesta nota: \"The term 'domain layer' is used in other software architectures, such as 'clean' architecture, and has a different meaning there. Don't confuse the definition of 'domain layer' defined in the Android official architecture guidance with other definitions you may have read elsewhere.\"</p> <p>Info</p> <p>Veure apartat d'inversi\u00f3 de depend\u00e8ncies per aprofundir en Clean Architecture.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/","title":"De l'arquitectura Android a Clean Architecture","text":"<p>Prerequisit</p> <p>Aquest document parteix de l'arquitectura en 2 capes (UI + Dades) explicada a Capa repositori i dades. Es recomana llegir-lo primer.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#1-punt-de-partida-arquitectura-android","title":"1. Punt de partida: Arquitectura Android","text":"<p>Recordem l'arquitectura que ten\u00edem:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UI LAYER                                        \u2502\n\u2502  Activity/Fragment \u2192 ViewModel                   \u2502\n\u2502  (dep\u00e8n de ItemsRepository, classe concreta)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DATA LAYER                                      \u2502\n\u2502                                                  \u2502\n\u2502  ItemsRepository (classe concreta)               \u2502\n\u2502  \u2514\u2500\u2192 ItemsDataSource (interface)                 \u2502\n\u2502      \u251c\u2500\u2192 MockItemsDataSource                     \u2502\n\u2502      \u2514\u2500\u2192 RetrofitItemsDataSource                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Amb les classes:</p> <pre><code>// Data Layer\ninterface ItemsDataSource {\n   fun getItems(): List&lt;MyItem&gt;\n   fun addItem(item: MyItem)\n   fun updateItem(item: MyItem)\n   fun deleteItem(item: MyItem)\n}\n\nclass ItemsRepository(\n    private val dataSource: ItemsDataSource\n) {\n    fun getItems(): List&lt;MyItem&gt; = dataSource.getItems()\n    fun addItem(item: MyItem) = dataSource.addItem(item)\n    fun updateItem(item: MyItem) = dataSource.updateItem(item)\n    fun deleteItem(item: MyItem) = dataSource.deleteItem(item)\n}\n\n// UI Layer\nclass ItemsViewModel(\n    private val repository: ItemsRepository  // classe concreta\n) : ViewModel() {\n    fun getItems(): List&lt;MyItem&gt; = repository.getItems()\n    fun addItem(item: MyItem) = repository.addItem(item)\n}\n</code></pre> <p>Qu\u00e8 ja funciona b\u00e9: Gr\u00e0cies a la interface <code>ItemsDataSource</code>, podem canviar la font de dades (Mock, Retrofit, Room) sense modificar ni el Repository ni el ViewModel. Per testejar amb dades falses, n'hi ha prou passant un <code>MockItemsDataSource</code> al Repository.</p> <p>Limitaci\u00f3: El ViewModel dep\u00e8n de la classe concreta <code>ItemsRepository</code>. Si volem testejar el ViewModel de forma a\u00efllada (sense cap Repository real), no podem crear f\u00e0cilment un \"fake Repository\" perqu\u00e8 no hi ha una interface per implementar. Necessitar\u00edem una llibreria de mocking (com Mockk) per simular la classe concreta.</p> <p>Amb Clean Architecture, aplicarem DIP entre capes: el ViewModel dependr\u00e0 d'una interface del Repository (definida al Domain), cosa que permetr\u00e0 substituir el Repository complet per un fake en els tests.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#2-pas-1-clean-architecture-minima-afegir-la-interface-del-repository","title":"2. Pas 1 \u2014 Clean Architecture m\u00ednima: afegir la interface del Repository","text":"<p>El canvi m\u00ednim per passar a Clean Architecture \u00e9s:</p> <ol> <li>Crear una capa de Domini (Domain Layer)</li> <li>Crear la interface del Repository al Domain</li> <li>Moure l'entitat (<code>MyItem</code>) al Domain</li> <li>La implementaci\u00f3 del Repository queda al Data Layer</li> </ol>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#que-canvia-i-que-no-canvia","title":"Qu\u00e8 canvia i qu\u00e8 no canvia","text":"Classe Android Architecture Clean Architecture m\u00ednima <code>MyItem</code> Data Layer \u2192 Domain Layer <code>ItemsRepository</code> (interface) No existia \u2192 Domain Layer (NOVA) <code>ItemsRepository</code> (classe concreta) Data Layer \u2192 Reanomenada a <code>ItemsRepositoryImpl</code>, es queda al Data Layer <code>ItemsDataSource</code> (interface) Data Layer Data Layer (sense canvis) <code>MockItemsDataSource</code> Data Layer Data Layer (sense canvis) <code>RetrofitItemsDataSource</code> Data Layer Data Layer (sense canvis) <code>ItemsViewModel</code> UI Layer UI Layer (canvia el tipus de depend\u00e8ncia)"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#diagrama-resultant","title":"Diagrama resultant","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UI LAYER                                        \u2502\n\u2502  ItemsViewModel                                  \u2502\n\u2502  (dep\u00e8n de ItemsRepository, INTERFACE del Domain)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 dep\u00e8n de\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DOMAIN LAYER                                    \u2502\n\u2502                                                  \u2502\n\u2502  ItemsRepository (interface)                     \u2502\n\u2502  MyItem (entitat)                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u25b2\n               \u2502 implementa (dep\u00e8n de)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DATA LAYER                                      \u2502\n\u2502                                                  \u2502\n\u2502  ItemsRepositoryImpl (implementa la interface)   \u2502\n\u2502  \u2514\u2500\u2192 ItemsDataSource (interface)                 \u2502\n\u2502      \u251c\u2500\u2192 MockItemsDataSource                     \u2502\n\u2502      \u2514\u2500\u2192 RetrofitItemsDataSource                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Fixeu-vos en la direcci\u00f3 de les fletxes: tant la UI com el Data apunten cap al Domain. El Domain no dep\u00e8n de ning\u00fa. Aquesta \u00e9s la inversi\u00f3 de depend\u00e8ncies entre capes.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#codi","title":"Codi","text":""},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#domain-layer","title":"Domain Layer","text":"<p>L'entitat i la interface del Repository:</p> <pre><code>// domain/model/MyItem.kt\ndata class MyItem(\n    val id: Int,\n    val title: String,\n    val subtitle: String\n)\n\n// domain/repository/ItemsRepository.kt\ninterface ItemsRepository {\n    fun getItems(): List&lt;MyItem&gt;\n    fun addItem(item: MyItem)\n    fun updateItem(item: MyItem)\n    fun deleteItem(item: MyItem)\n}\n</code></pre> <p>El Domain nom\u00e9s cont\u00e9 definicions (interfaces i entitats). No cont\u00e9 cap implementaci\u00f3 ni cap depend\u00e8ncia externa.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#data-layer","title":"Data Layer","text":"<p>La implementaci\u00f3 del Repository i els DataSources (gaireb\u00e9 igual que abans):</p> <pre><code>// data/datasource/ItemsDataSource.kt\ninterface ItemsDataSource {\n    fun getItems(): List&lt;MyItem&gt;\n    fun addItem(item: MyItem)\n    fun updateItem(item: MyItem)\n    fun deleteItem(item: MyItem)\n}\n\n// data/repository/ItemsRepositoryImpl.kt\nclass ItemsRepositoryImpl(\n    private val dataSource: ItemsDataSource\n) : ItemsRepository {  // \u2190 implementa la interface del DOMAIN\n\n    override fun getItems(): List&lt;MyItem&gt; = dataSource.getItems()\n    override fun addItem(item: MyItem) = dataSource.addItem(item)\n    override fun updateItem(item: MyItem) = dataSource.updateItem(item)\n    override fun deleteItem(item: MyItem) = dataSource.deleteItem(item)\n}\n\n// data/datasource/MockItemsDataSource.kt\nclass MockItemsDataSource : ItemsDataSource {\n    private val items = mutableListOf(\n        MyItem(1, \"T\u00edtol 1\", \"Subt\u00edtol A\"),\n        MyItem(2, \"T\u00edtol 2\", \"Subt\u00edtol B\"),\n        MyItem(3, \"T\u00edtol 3\", \"Subt\u00edtol C\")\n    )\n    override fun getItems(): List&lt;MyItem&gt; = items\n    override fun addItem(item: MyItem) { items.add(item) }\n    override fun updateItem(item: MyItem) { /* implementaci\u00f3 */ }\n    override fun deleteItem(item: MyItem) { /* implementaci\u00f3 */ }\n}\n</code></pre> <p>L'\u00fanic canvi respecte l'arquitectura Android \u00e9s que <code>ItemsRepositoryImpl</code> ara implementa <code>ItemsRepository</code> (interface del Domain) en lloc de ser una classe independent.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#ui-layer","title":"UI Layer","text":"<p>El ViewModel ara dep\u00e8n de la interface (Domain), no de la classe concreta (Data):</p> <pre><code>// ui/ItemsViewModel.kt\nclass ItemsViewModel(\n    private val repository: ItemsRepository  // \u2190 INTERFACE, no classe concreta\n) : ViewModel() {\n\n    fun getItems(): List&lt;MyItem&gt; = repository.getItems()\n    fun addItem(item: MyItem) = repository.addItem(item)\n}\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#com-es-connecta-tot","title":"Com es connecta tot","text":"<pre><code>val dataSource: ItemsDataSource = if (isTesting) {\n    MockItemsDataSource()\n} else {\n    RetrofitItemsDataSource()\n}\n\n// El tipus declarat \u00e9s la INTERFACE (Domain), la implementaci\u00f3 \u00e9s del Data\nval repository: ItemsRepository = ItemsRepositoryImpl(dataSource)\n\nval viewModel = ItemsViewModel(repository)\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#que-hem-guanyat","title":"Qu\u00e8 hem guanyat?","text":"<p>Amb aquest canvi m\u00ednim (una interface + moure l'entitat):</p> <ul> <li>DIP entre capes: La UI i el Data depenen del Domain. El Domain no dep\u00e8n de ning\u00fa.</li> <li>Testabilitat del ViewModel: Podem crear un mock del Repository sense necessitar cap DataSource.</li> <li>Domain estable: Si canviem tota la capa de dades (de Retrofit a Room, per exemple), el Domain i la UI no es veuen afectats.</li> </ul>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#3-pas-2-clean-architecture-completa-afegir-use-cases","title":"3. Pas 2 \u2014 Clean Architecture completa: afegir Use Cases","text":"<p>El pas anterior ja ens d\u00f3na Clean Architecture. Per\u00f2 el ViewModel encara crida directament el Repository. En projectes grans, aix\u00f2 pot ser un problema:</p> <ul> <li>Si dos ViewModels necessiten la mateixa operaci\u00f3 amb la mateixa l\u00f2gica, la dupliquem.</li> <li>La l\u00f2gica de negoci queda escampada entre ViewModels.</li> </ul> <p>La soluci\u00f3 s\u00f3n els Use Cases (o Interactors): classes al Domain que encapsulen una \u00fanica operaci\u00f3 de negoci.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#que-canvia","title":"Qu\u00e8 canvia","text":"Classe Clean m\u00ednima Clean completa <code>GetItemsUseCase</code> No existia \u2192 Domain Layer (NOU) <code>AddItemUseCase</code> No existia \u2192 Domain Layer (NOU) <code>ItemsViewModel</code> Dep\u00e8n de <code>ItemsRepository</code> \u2192 Dep\u00e8n dels Use Cases Resta de classes \u2014 Sense canvis"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#diagrama-resultant_1","title":"Diagrama resultant","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UI LAYER                                        \u2502\n\u2502  ItemsViewModel                                  \u2502\n\u2502  (dep\u00e8n dels Use Cases)                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 dep\u00e8n de\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DOMAIN LAYER                                    \u2502\n\u2502                                                  \u2502\n\u2502  GetItemsUseCase \u2500\u2500\u2510                             \u2502\n\u2502  AddItemUseCase    \u251c\u2500\u2192 ItemsRepository (interface)\u2502\n\u2502  ...               \u2518                             \u2502\n\u2502  MyItem (entitat)                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u25b2\n               \u2502 implementa (dep\u00e8n de)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DATA LAYER                                      \u2502\n\u2502                                                  \u2502\n\u2502  ItemsRepositoryImpl                             \u2502\n\u2502  \u2514\u2500\u2192 ItemsDataSource (interface)                 \u2502\n\u2502      \u251c\u2500\u2192 MockItemsDataSource                     \u2502\n\u2502      \u2514\u2500\u2192 RetrofitItemsDataSource                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#codi_1","title":"Codi","text":""},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#domain-layer-use-cases","title":"Domain Layer \u2014 Use Cases","text":"<p>Cada Use Case t\u00e9 una \u00fanica responsabilitat: executar una operaci\u00f3.</p> <pre><code>// domain/usecase/GetItemsUseCase.kt\nclass GetItemsUseCase(\n    private val repository: ItemsRepository\n) {\n    fun execute(): List&lt;MyItem&gt; {\n        return repository.getItems()\n    }\n}\n\n// domain/usecase/AddItemUseCase.kt\nclass AddItemUseCase(\n    private val repository: ItemsRepository\n) {\n    fun execute(item: MyItem) {\n        repository.addItem(item)\n    }\n}\n</code></pre> <p>Per qu\u00e8 una classe per operaci\u00f3?</p> <p>Pot semblar excessiu crear una classe per cada operaci\u00f3. Per\u00f2 els Use Cases s\u00f3n el lloc on afegir l\u00f2gica de negoci (validacions, transformacions, combinaci\u00f3 de repositoris). Si un Use Case nom\u00e9s delega al Repository, \u00e9s perqu\u00e8 encara no t\u00e9 l\u00f2gica pr\u00f2pia \u2014 per\u00f2 ja tenim l'estructura preparada per quan en necessitem.</p>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#ui-layer-viewmodel-amb-use-cases","title":"UI Layer \u2014 ViewModel amb Use Cases","text":"<p>El ViewModel ja no coneix el Repository. Nom\u00e9s coneix els Use Cases:</p> <pre><code>// ui/ItemsViewModel.kt\nclass ItemsViewModel(\n    private val getItemsUseCase: GetItemsUseCase,\n    private val addItemUseCase: AddItemUseCase\n) : ViewModel() {\n\n    fun getItems(): List&lt;MyItem&gt; = getItemsUseCase.execute()\n\n    fun addItem(item: MyItem) = addItemUseCase.execute(item)\n}\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#com-es-connecta-tot_1","title":"Com es connecta tot","text":"<pre><code>// Capa de dades\nval dataSource: ItemsDataSource = RetrofitItemsDataSource()\nval repository: ItemsRepository = ItemsRepositoryImpl(dataSource)\n\n// Capa de domini\nval getItemsUseCase = GetItemsUseCase(repository)\nval addItemUseCase = AddItemUseCase(repository)\n\n// Capa UI\nval viewModel = ItemsViewModel(getItemsUseCase, addItemUseCase)\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#4-resum-de-la-transicio","title":"4. Resum de la transici\u00f3","text":""},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#classes-per-capa-a-cada-pas","title":"Classes per capa a cada pas","text":"<pre><code>ANDROID ARCHITECTURE (2 capes):\n  UI:     ItemsViewModel \u2192 ItemsRepository (concreta)\n  Data:   ItemsRepository, ItemsDataSource(I), Mock, Retrofit\n\nCLEAN M\u00cdNIMA (3 capes, sense Use Cases):\n  UI:     ItemsViewModel \u2192 ItemsRepository (interface)\n  Domain: ItemsRepository(I), MyItem\n  Data:   ItemsRepositoryImpl, ItemsDataSource(I), Mock, Retrofit\n\nCLEAN COMPLETA (3 capes, amb Use Cases):\n  UI:     ItemsViewModel \u2192 GetItemsUseCase, AddItemUseCase\n  Domain: GetItemsUseCase, AddItemUseCase, ItemsRepository(I), MyItem\n  Data:   ItemsRepositoryImpl, ItemsDataSource(I), Mock, Retrofit\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#direccio-de-les-dependencies","title":"Direcci\u00f3 de les depend\u00e8ncies","text":"<pre><code>Android:        UI \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Data              (cap avall)\nClean m\u00ednima:   UI \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Domain \u25c0\u2500\u2500\u2500\u2500\u2500\u2500 Data  (inversi\u00f3 entre capes)\nClean completa: UI \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Domain \u25c0\u2500\u2500\u2500\u2500\u2500\u2500 Data  (igual, amb Use Cases)\n</code></pre>"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#taula-comparativa","title":"Taula comparativa","text":"Android Clean m\u00ednima Clean completa Capes 2 (UI + Data) 3 (UI + Domain + Data) 3 (UI + Domain + Data) Repository Classe concreta Interface (Domain) + Impl (Data) Interface (Domain) + Impl (Data) ViewModel dep\u00e8n de <code>ItemsRepository</code> (classe) <code>ItemsRepository</code> (interface) Use Cases Domain cont\u00e9 \u2014 Interface Repository + Entitats Interface Repository + Use Cases + Entitats DIP entre capes No S\u00ed S\u00ed L\u00f2gica de negoci Al ViewModel Al ViewModel Als Use Cases"},{"location":"Android/Arquitectura/capa_dades_clean_architecture/#5-quan-utilitzar-cada-enfocament","title":"5. Quan utilitzar cada enfocament?","text":"<ul> <li> <p>Android Architecture (2 capes): Projectes petits o prototips. Suficient quan no necessites testejar el ViewModel de forma a\u00efllada i la l\u00f2gica de negoci \u00e9s m\u00ednima.</p> </li> <li> <p>Clean m\u00ednima (3 capes, sense Use Cases): Projectes mitjans. Vols independ\u00e8ncia entre capes i testabilitat, per\u00f2 no tens l\u00f2gica de negoci complexa ni compartida entre ViewModels.</p> </li> <li> <p>Clean completa (3 capes, amb Use Cases): Projectes grans. Tens l\u00f2gica de negoci que es reutilitza entre ViewModels, m\u00faltiples fonts de dades, o necessites una capa de domini s\u00f2lida i testable.</p> </li> </ul> <p>Nota important</p> <p>La documentaci\u00f3 oficial d'Android inclou aquesta nota: \"The term 'domain layer' is used in other software architectures, such as 'clean' architecture, and has a different meaning there. Don't confuse the definition of 'domain layer' defined in the Android official architecture guidance with other definitions you may have read elsewhere.\"</p> <p>El Domain Layer d'Android (opcional, depend\u00e8ncies cap avall) no \u00e9s el mateix que el Domain Layer de Clean Architecture (obligatori, independent, amb inversi\u00f3 de depend\u00e8ncies).</p>"},{"location":"Android/Arquitectura/factory/","title":"Patr\u00f3 Factory","text":""},{"location":"Android/Arquitectura/factory/#1-que-es","title":"1. Qu\u00e8 \u00e9s?","text":"<p>El patr\u00f3 Factory \u00e9s un patr\u00f3 de disseny que proporciona una manera de crear objectes sense especificar la classe exacta de l'objecte que crear\u00e0. En comptes d'aix\u00f3, es confia a un m\u00e9tode \"factory\" que crei i retorni l'objecte, tipicament basat en par\u00e0metres d'entrada o configuraci\u00f3.</p> <p>El principi fonamental \u00e9s que el codi que necessita un objecte, interactua amb una interf\u00edcie comuna i no necessita saber exactament quina classe concreta s'est\u00e0 instant. El \"Factory\" \u00e9s l'entitat responsable de decidir i crear la inst\u00e0ncia correcta.</p>"},{"location":"Android/Arquitectura/factory/#components-del-patro","title":"Components del patr\u00f3:","text":"<ul> <li> <p>Una Interf\u00edcie/Classe Base del \"Producte\": Defineix el contracte com\u00fa que tots els objectes creats pel Factory han de seguir. A Kotlin, aix\u00f2 sol ser una interface o una abstract class.</p> </li> <li> <p>Productes Concrets: S\u00f3n les classes que implementen la interf\u00edcie del Producte. S\u00f3n les inst\u00e0ncies que el Factory crear\u00e0.</p> </li> <li> <p>El Factory: La classe o funci\u00f3 que cont\u00e9 la l\u00f2gica per decidir quin Producte Concret instanciar i retornar.</p> </li> </ul>"},{"location":"Android/Arquitectura/factory/#com-simplementa","title":"Com s'implementa?","text":"<p>Imagina que necessitem mostrar diferents tipus de Notificacions (per exemple, una notificaci\u00f3 simple, una amb imatge, o una de progr\u00e9s). </p> <p>En lloc que cada part del teu codi d'Android (com una Activity o ViewModel) s\u00e0piga com construir cada tipus de notificaci\u00f3 amb els seus par\u00e0metres espec\u00edfics, podem usar un Factory.</p>"},{"location":"Android/Arquitectura/factory/#1-interficie-del-producte-notification","title":"1. Interf\u00edcie del \"Producte\" (Notification)","text":"<p>Definim la interf\u00edcie comuna que totes les notificacions han d'implementar.</p> <pre><code>interface AppNotification {\n    fun show(context: Context)\n}\n</code></pre>"},{"location":"Android/Arquitectura/factory/#2-productes-concrets-simple-image-progress-notification","title":"2. Productes Concrets (Simple, Image, Progress Notification)","text":"<p>Implementem les classes espec\u00edfiques de notificacions.</p> <pre><code>class SimpleNotification(private val message: String) : AppNotification {\n    override fun show(context: Context) {\n        // L\u00f2gica de construcci\u00f3 d'una notificaci\u00f3 simple d'Android\n        println(\"Mostrant notificaci\u00f3 simple: $message\")\n    }\n}\n\nclass ImageNotification(private val imageUrl: String) : AppNotification {\n    override fun show(context: Context) {\n        // L\u00f2gica de construcci\u00f3 amb imatge (m\u00e9s complexa)\n        println(\"Mostrant notificaci\u00f3 amb imatge des de: $imageUrl\")\n    }\n}\n// Podria haver-n'hi m\u00e9s, com ProgressNotification, etc.\n</code></pre>"},{"location":"Android/Arquitectura/factory/#3-el-factory-notificationfactory","title":"3. El Factory (NotificationFactory)","text":"<p>Creem un objecte object (que actua com un Singleton a Kotlin) amb una funci\u00f3 que decideix quin tipus de producte instanciar basant-se en el parametre type</p> <pre><code>// Usem una 'sealed class' o 'enum' per definir els tipus\nsealed class NotificationType {\n    data class Simple(val message: String) : NotificationType()\n    data class Image(val url: String) : NotificationType()\n    object Progress : NotificationType() // Exemple d'un tipus simple\n}\n\nobject NotificationFactory {\n\n    fun createNotification(type: NotificationType): AppNotification = when (type) {\n        is NotificationType.Simple -&gt; SimpleNotification(type.message)\n        is NotificationType.Image -&gt; ImageNotification(type.url)\n        NotificationType.Progress -&gt; ProgressNotification() // Assumint que existeix\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/factory/#4-us-a-activityviewmodel","title":"4. \u00das a Activity/ViewModel","text":"<p>Ara, en el codi d'Android, nom\u00e9s cal cridar al Factory i treballar amb la interf\u00edcie AppNotification, sense preocupar-se pels detalls de creaci\u00f3.</p> <pre><code>// En una Activity o ViewModel\nfun showNotification(data: MessageData, context: Context) {\n    val type = if (data.hasImage) {\n        NotificationType.Image(data.imageUrl)\n    } else {\n        NotificationType.Simple(data.text)\n    }\n\n    // El codi de la Activity nom\u00e9s interactua amb el Factory i la interf\u00edcie\n    val notification = NotificationFactory.createNotification(type)\n    notification.show(context)\n}\n</code></pre>"},{"location":"Android/Arquitectura/factory/#resum","title":"Resum","text":"<p>El Patr\u00f3 Factory no s'utilitza per amagar qu\u00e8 vols crear, sin\u00f3 COM es crea.</p> <p>S'oculta:</p>"},{"location":"Android/Arquitectura/factory/#1-la-classe-concreta","title":"1. La Classe Concreta","text":"<p>El Factory amaga l'exist\u00e8ncia (i el nom) de les classes que implementen la interf\u00edcie del producte.</p> <ul> <li> <p>Sense Factory: El l'Activity hauria de fer:</p> <p><pre><code>val notification: AppNotification = SimpleNotification(data.text) // Necessita saber el nom exacte\n</code></pre> - Amb Factory: El l'Activity nom\u00e9s veu el tipus d'entrada (NotificationType) i el tipus de sortida (AppNotification). <pre><code>val notification: AppNotification = NotificationFactory.createNotification(type) // No coneix SimpleNotification\n</code></pre></p> </li> </ul>"},{"location":"Android/Arquitectura/factory/#2-la-logica-complexa-de-construccio","title":"2. La L\u00f2gica Complexa de Construcci\u00f3","text":"<p>l Factory s'utilitza per amagar tota la l\u00f2gica de configuraci\u00f3 interna necess\u00e0ria per construir la inst\u00e0ncia. - Sense Factory</p> <pre><code>```kotlin \n// El client s'ha de preocupar: \nval builder = NotificationCompat.Builder(context, CHANNEL_ID) \n    .setContentTitle(\"New message\") \n    .setContentText(data.text) \n    .setSmallIcon(R.drawable.ic_noti) // ... 10 l\u00ednies de configuraci\u00f3 m\u00e9s \n```kotlin\n</code></pre> <ul> <li>Amb Factory (L\u00f2gica oculta)     <pre><code>// El client nom\u00e9s subministra les dades:\nval notification = NotificationFactory.createNotification(type)\n</code></pre></li> </ul>"},{"location":"Android/Arquitectura/factory/#exemple-de-mes-ocultacio","title":"Exemple de M\u00e9s Ocultaci\u00f3","text":"<p>Imagina que el Factory rep nom\u00e9s les dades en brut (<code>MessageData</code>) i decideix internament.</p> <pre><code>data class MessageData(\n    val title: String,\n    val text: String,\n    val hasImage: Boolean,\n    val imageUrl: String?\n)\n\nobject SmartNotificationFactory {\n    // El Factory rep DADES GEN\u00c8RIQUES, no un tipus de Producte pre-escollit.\n    fun createNotificationFromData(data: MessageData): AppNotification {\n        return if (data.hasImage) {\n            // El Factory decideix la classe i fa la instanciaci\u00f3\n            ImageNotification(data.imageUrl!!) \n        } else {\n            SimpleNotification(data.text)\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/inversiodependencies/","title":"Inversi\u00f3 de Depend\u00e8ncies","text":""},{"location":"Android/Arquitectura/inversiodependencies/#inversio-de-dependencies","title":"Inversi\u00f3 de depend\u00e8ncies:","text":"<p>Llegir el seguent article: </p>"},{"location":"Android/Arquitectura/observer/","title":"Observaci\u00f3 de LiveData des de la UI","text":""},{"location":"Android/Arquitectura/observer/#metode-observe-i-el-lifecycleowner","title":"M\u00e8tode observe() i el LifecycleOwner","text":"<p>El m\u00e8tode observe() \u00e9s la forma principal d'observar LiveData des dels components de UI. Requereix dos par\u00e0metres: un LifecycleOwner i un Observer.</p> <p>Signatura del m\u00e8tode: <pre><code>fun observe(owner: LifecycleOwner, observer: Observer&lt;T&gt;)\n</code></pre></p> <p>Components:</p> <ul> <li>LifecycleOwner: Component amb cicle de vida (Activity, Fragment)</li> <li>Observer: Lambda o classe que rep les actualitzacions</li> </ul> <p>A Activity: <pre><code>class MainActivity : AppCompatActivity() {\n    private val viewModel: DadesViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        // 'this' \u00e9s el LifecycleOwner (Activity)\n        viewModel.dades.observe(this) { dades -&gt;\n            // Actualitzar UI amb les noves dades\n            textView.text = dades\n        }\n    }\n}\n</code></pre> A Fragment (IMPORTANT): <pre><code>class MeuFragment : Fragment() {\n    private val viewModel: DadesViewModel by viewModels()\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        //CORRECTE: usar viewLifecycleOwner\n        viewModel.dades.observe(viewLifecycleOwner) { dades -&gt;\n            textView.text = dades\n        }\n\n        //INCORRECTE: NO usar 'this' en Fragments\n        // viewModel.dades.observe(this) { ... }  // Pot causar memory leaks!\n    }\n}\n</code></pre> Per qu\u00e8 viewLifecycleOwner en Fragments:</p> <p>Els Fragments tenen DOS cicles de vida: el del Fragment i el de la View La View pot destruir-se i recrear-se mentre el Fragment segueix viu. Usar this pot causar que l'observer segueixi actiu quan la View ja no existeix viewLifecycleOwner s'atura quan la View es destrueix, evitant fugues de mem\u00f2ria (memory leaks).</p>"},{"location":"Android/Arquitectura/recyclerinversio/","title":"Exemple d'inversi\u00f3 de depend\u00e8ncies amb el Recycler view senzill","text":""},{"location":"Android/Arquitectura/recyclerinversio/#problema-de-callbacks","title":"Problema de callbacks:","text":"<p>Si examinem l'exemple de recyclerview tal i com est\u00e0, (passant funcions de callback), podem trobar els problemes seg\u00fcents:</p>"},{"location":"Android/Arquitectura/recyclerinversio/#1-memory-leaks","title":"1. Memory Leaks\u200b","text":"<ul> <li>La lambda f\u00e0 refer\u00e8ncia a l'activity( el this en el Toast)</li> <li>Si l'Activity es destrueix (rotaci\u00f3, backstack), per\u00f2 l'Adapter/ViewHolder segueix viu \u2192 leak.</li> <li>L'Activity no es pot recollir per garbage collector.</li> </ul>"},{"location":"Android/Arquitectura/recyclerinversio/#2-acoblament-fort","title":"2. Acoblament fort","text":"<ul> <li>L'Activity s'ha de con\u00e8ixer qu\u00e8 fa l'Adapter (passar callbacks espec\u00edfics).</li> <li>Dif\u00edcil reutilitzar l'Adapter en un altre context.</li> </ul>"},{"location":"Android/Arquitectura/recyclerinversio/#3-violacio-single-responsibility","title":"3. Violaci\u00f3 Single Responsibility","text":"<ul> <li>L'Activity fa 3 coses:</li> <li>Presenta UI</li> <li>Gestiona RecyclerView</li> <li>Gestiona negocis (qu\u00e8 fer al clic). Aix\u00f3 \u00faltim no ho hauria de fer. No \u00e9s la serva responsabilitat.</li> </ul>"},{"location":"Android/Arquitectura/recyclerinversio/#sollucio-amb-inversio-de-dependencies-dependency-inversion-principle-dip","title":"Sol\u00b7luci\u00f3 amb inversi\u00f3 de depend\u00e8ncies (Dependency Inversion Principle - DIP)","text":""},{"location":"Android/Arquitectura/recyclerinversio/#1-interficie-clara-i-tipada","title":"1. Interf\u00edcie clara i tipada","text":"<pre><code>interface ItemClickListener {\n    fun onItemClick(item: MyItem)\n}\n</code></pre>"},{"location":"Android/Arquitectura/recyclerinversio/#2-adapter-rep-interficie-no-lambda","title":"2. Adapter rep interf\u00edcie (NO lambda)","text":"<pre><code>class MyAdapter(\n    private val items: List&lt;MyItem&gt;,\n    private val listener: ItemClickListener  // \u2190 Millor!\n) : RecyclerView.Adapter&lt;MyViewHolder&gt;() {\n    // ... mateix codi\n}\n</code></pre>"},{"location":"Android/Arquitectura/recyclerinversio/#3-activity-nomes-implementa-interficie","title":"3. Activity nom\u00e9s implementa interf\u00edcie","text":"<pre><code>class MainActivity : AppCompatActivity(), ItemClickListener {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        // ...\n        adapter = MyAdapter(items, this)  // \u2190 Passa Activity com a listener\n        recyclerView.adapter = adapter\n    }\n\n    // L\u00f2gica de negoci AQU\u00cd, separada de UI\n    override fun onItemClick(item: MyItem) {\n        Toast.makeText(this, \"Clicat ${item.title}\", Toast.LENGTH_SHORT).show()\n        // O millor: cridar ViewModel\n        // viewModel.onItemSelected(item)\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/recyclerinversio/#que-diu-el-principi-dip","title":"Qu\u00e8 diu el principi DIP?\u200b","text":"<pre><code>\"Les m\u00f2duls d'alt nivell NO han de dependre de m\u00f2duls de baix nivell.\nAMBDOs han de dependre d'abstraccions (interf\u00edcies).\"\n</code></pre>"},{"location":"Android/Arquitectura/recyclerinversio/#en-el-nostre-cas","title":"En el nostre cas:","text":"<p><pre><code>- Incorrecte: Activity (alt nivell) \u2190 DEPEN de MyAdapter (baix nivell)\n- Correcte: Activity (alt nivell) \u2192 ItemClickListener \u2190 MyAdapter (baix nivell)\n</code></pre> Beneficis pr\u00e0ctics:</p> <ol> <li>L'Activity es pot canviar (Fragment, Compose Screen) sense tocar Adapter</li> <li>L'Adapter es pot reutilitzar en qualsevol Activity/Fragment</li> <li>No t\u00e9 memory leaks (no captura 'this' directament dins lambda)</li> <li>Testejable: mockejar ItemClickListener</li> </ol>"},{"location":"Android/Arquitectura/solid/","title":"Principis SOLID","text":""},{"location":"Android/Arquitectura/solid/#principis-solid","title":"Principis SOLID","text":"<p>Llegir el seg\u00fcent document:</p> <p>https://devexpert.io/blog/principios-solid</p>"},{"location":"Android/Arquitectura/viewmodel/","title":"Viewmodel","text":"<p>Documentaci\u00f3 oficial: https://developer.android.com/topic/libraries/architecture/viewmodel</p>"},{"location":"Android/Arquitectura/viewmodel/#informacio-viewmodel-i-livedata","title":"Informaci\u00f3 Viewmodel i livedata","text":"<p>View model \u00e9s una arquitectura que permet separar la l\u00f2gica de la activity, de l'activity mateixa.</p> <p>La separaci\u00f3 \u00e9s important, perque s'ent\u00e9n que una activity no hauria de saber quines dades s'utilitzen per implementar la l\u00f2gica, nom\u00e9s li cal saber com gestionar la UI. Si volem modificar una variable que no pertany a la UI, ho haur\u00e0 de fer per la via d'una funci\u00f3.</p> <p>El livedata (veure els apunts en l'apartat de Llenguatge Kotlin)</p>"},{"location":"Android/Arquitectura/viewmodel/#1-conceptes-basics","title":"1-Conceptes b\u00e0sics","text":""},{"location":"Android/Arquitectura/viewmodel/#que-es-i-per-que-existeix-separacio-de-logica-i-ui","title":"Qu\u00e8 \u00e9s i per qu\u00e8 existeix (separaci\u00f3 de l\u00f2gica i UI)","text":"<p>El ViewModel \u00e9s un component d'arquitectura dissenyat per emmagatzemar i gestionar dades relacionades amb la UI de manera conscient del cicle de vida. Per qu\u00e8 existeix:</p> <ul> <li>Separaci\u00f3 de responsabilitats: La l\u00f2gica de negoci i les dades estan separades de la UI (Activity/Fragment).</li> <li>Testabilitat: Pots testejar la l\u00f2gica sense necessitat de components d'Android.</li> <li>Reutilitzaci\u00f3: Diversos Fragments poden compartir el mateix ViewModel.</li> <li>Persist\u00e8ncia: Les dades sobreviuen a canvis de configuraci\u00f3.</li> </ul>"},{"location":"Android/Arquitectura/viewmodel/#sense-viewmodel","title":"Sense ViewModel:","text":"<pre><code>class MainActivity : AppCompatActivity() {\n    private var counter = 0 // Es perd en rotar la pantalla\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        // L\u00f2gica barrejada amb codi de UI\n        button.setOnClickListener {\n            counter++\n            textView.text = counter.toString()\n            // Crides a API, c\u00e0lculs, etc...\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/viewmodel/#amb-viewmodel","title":"Amb ViewModel:","text":"<pre><code>class CounterViewModel : ViewModel() {\n    private val _counter = MutableLiveData(0)\n    val counter: LiveData&lt;Int&gt; = _counter\n\n    fun increment() {\n        _counter.value = (_counter.value ?: 0) + 1\n    }\n}\n\nclass MainActivity : AppCompatActivity() {\n    private val viewModel: CounterViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        viewModel.counter.observe(this) { count -&gt;\n            textView.text = count.toString()\n        }\n\n        button.setOnClickListener {\n            viewModel.increment()\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Arquitectura/viewmodel/#cicle-de-vida-del-viewmodel-vs-activityfragment","title":"Cicle de vida del ViewModel vs Activity/Fragment","text":"<p>El ViewModel t\u00e9 un cicle de vida diferent i m\u00e9s llarg que l'Activity o Fragment que l'utilitza.</p> <p>Cicle de vida: <pre><code>ActivityCreated -&gt; (rotation) \u2192 Re-created \u2192 Finished\n    \u2502                                     \u2502         \u2502\n    \u25bc                                     \u2502         \u25bc\nViewModel Created                         \u2502     onCleared()\n    \u2502                                     \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         (ViewModel es mant\u00e9 viu)\n</code></pre> Exemple pr\u00e0ctic: <pre><code>class MyViewModel : ViewModel() {\n    init {\n        Log.d(\"ViewModel\", \"ViewModel creat\")\n    }\n\n    override fun onCleared() {\n        super.onCleared()\n        Log.d(\"ViewModel\", \"ViewModel destru\u00eft\")\n        // Neteja recursos: cancel\u00b7lar coroutines, tancar connexions, etc.\n    }\n}\n\nclass MainActivity : AppCompatActivity() {\n    private val viewModel: MyViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        Log.d(\"Activity\", \"onCreate\")\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(\"Activity\", \"onDestroy\")\n    }\n}\n</code></pre></p> <p>Logs en rotar la pantalla: <pre><code>ViewModel creat\nActivity onCreate\nActivity onDestroy (rotaci\u00f3)\nActivity onCreate (nova inst\u00e0ncia)\n// ViewModel segueix viu!\n\n// Nom\u00e9s quan tanquem l'Activity:\nActivity onDestroy\nViewModel destru\u00eft\n</code></pre></p>"},{"location":"Android/Arquitectura/viewmodel/#supervivencia-a-canvis-de-configuracio-rotacions","title":"Superviv\u00e8ncia a canvis de configuraci\u00f3 (rotacions)","text":"<p>El ViewModel sobreviu autom\u00e0ticament a canvis de configuraci\u00f3 com rotacions, canvis d'idioma, etc.</p> <p>El problema sense ViewModel: <pre><code>class MainActivity : AppCompatActivity() {\n    private var userData: User? = null\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        // Cada cop que rotes, has de tornar a carregar les dades\n        // i si s'han modificat, es perden les modificacions\n        userData=loadUserData() // Crida a l'API, base de dades...\n\n    }\n}\n</code></pre></p> <p>La soluci\u00f3 amb ViewModel: <pre><code>class UserViewModel : ViewModel() {\n    private val _userData = MutableLiveData&lt;User&gt;()\n    val userData: LiveData&lt;User&gt; = _userData\n\n    init {\n        loadUserData() // Nom\u00e9s es crida UNA vegada\n    }\n\n    //loadUserData obt\u00e9 l'usuari de una bbdd, api, etc..\n    private fun loadUserData() {\n        //obtenir l'usuari de manera as\u00edncronta (veure corrutines)\n        viewModelScope.launch {\n            _userData.value = \"Usuari1\"\n        }\n    }\n}\n\nclass MainActivity : AppCompatActivity() {\n    private val viewModel: UserViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        // Les dades ja estan disponibles despr\u00e9s de rotar\n        viewModel.userData.observe(this) { user -&gt;\n            textView.text = user.name\n        }\n    }\n}\n</code></pre></p>"},{"location":"Android/Arquitectura/viewmodel/#2-ambits-scopes","title":"2-\u00c0mbits (Scopes)","text":""},{"location":"Android/Arquitectura/viewmodel/#viewmodel-no-compartit-viewmodels","title":"ViewModel no compartit (viewModels())","text":"<p>Cada Activity o Fragment t\u00e9 la seva pr\u00f2pia inst\u00e0ncia del ViewModel. \u00c0mbit d'Activity: <pre><code>class MainActivity : AppCompatActivity() {\n    // ViewModel amb \u00e0mbit d'aquesta Activity\n    private val viewModel: MyViewModel by viewModels()\n}\n\nclass OtherActivity : AppCompatActivity() {\n    // Inst\u00e0ncia DIFERENT del mateix ViewModel\n    private val viewModel: MyViewModel by viewModels()\n}\n</code></pre></p> <p>\u00c0mbit de Fragment: <pre><code>class FirstFragment : Fragment() {\n    // ViewModel amb \u00e0mbit d'aquest Fragment\n    private val viewModel: MyViewModel by viewModels()\n}\n\nclass SecondFragment : Fragment() {\n    // Inst\u00e0ncia DIFERENT, incl\u00fas si estan a la mateixa Activity\n    private val viewModel: MyViewModel by viewModels()\n}\n</code></pre></p> <p>Quan utilitzar-ho:</p> <ul> <li>Dades espec\u00edfiques d'una \u00fanica pantalla</li> <li>No necessites compartir informaci\u00f3 entre components</li> <li>L\u00f2gica a\u00efllada d'un sol Fragment</li> </ul>"},{"location":"Android/Arquitectura/viewmodel/#viewmodel-compartit-activityviewmodels","title":"ViewModel compartit (activityViewModels())","text":"<p>Diversos Fragments dins de la mateixa Activity poden accedir a la mateixa inst\u00e0ncia del ViewModel.</p> <p>Exemple de comunicaci\u00f3 entre Fragments: <pre><code>class SharedViewModel : ViewModel() {\n    private val _selectedItem = MutableLiveData&lt;Item&gt;()\n    val selectedItem: LiveData&lt;Item&gt; = _selectedItem\n\n    fun selectItem(item: Item) {\n        _selectedItem.value = item\n    }\n}\n\nclass ListFragment : Fragment() {\n    // Obt\u00e9 el ViewModel de l'Activity pare\n    private val sharedViewModel: SharedViewModel by activityViewModels()\n\n    private fun onItemClicked(item: Item) {\n        sharedViewModel.selectItem(item)\n    }\n}\n\nclass DetailFragment : Fragment() {\n    // La MATEIXA inst\u00e0ncia del ViewModel\n    private val sharedViewModel: SharedViewModel by activityViewModels()\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        sharedViewModel.selectedItem.observe(viewLifecycleOwner) { item -&gt;\n            // Mostra els detalls de l'item seleccionat\n            textView.text = item.name\n        }\n    }\n}\n</code></pre></p> <p>Quan utilitzar-ho:</p> <ul> <li>Comunicaci\u00f3 entre Fragments</li> <li>Compartir estat dins d'una Activity</li> <li>Navegaci\u00f3 amb dades (passar informaci\u00f3 entre pantalles)</li> <li>Patr\u00f3 Master-detail</li> </ul>"},{"location":"Android/Arquitectura/viewmodel/#resum","title":"Resum:","text":"Delegat On s'utilitza \u00c0mbit de Cicle de Vida Prop\u00f2sit principal by viewModels() Fragment o ComponentActivity Lligat al cicle de vida de la Fragment o Activity actual. ViewModel local per a una sola pantalla (Fragment o Activity). by activityViewModels() Fragment (nom\u00e9s) Lligat al cicle de vida de l'Activity que cont\u00e9 el Fragment. Compartir dades i l\u00f2gica entre m\u00faltiples Fragments dins de la mateixa Activity."},{"location":"Android/Arquitectura/viewmodel/#3-viewmodelprovider-i-factories","title":"3-ViewModelProvider i Factories","text":"<p>Quan el ViewModel necessita par\u00e0metres al constructor, \u00e9s necessari implementar un patr\u00f3 factory, per poder passar les dades. Es fa aix\u00ed:</p> <p>ViewModel amb par\u00e0metres: <pre><code>class UserViewModel(\n    private val userId: String,\n    private val repository: UserRepository\n) : ViewModel() {\n\n    private val _user = MutableLiveData&lt;User&gt;()\n    val user: LiveData&lt;User&gt; = _user\n\n    init {\n        loadUser()\n    }\n\n    private fun loadUser() {\n        viewModelScope.launch {\n            _user.value = repository.getUser(userId)\n        }\n    }\n}\n</code></pre></p> <p>Crear un Factory: <pre><code>class UserViewModelFactory(\n    private val userId: String,\n    private val repository: UserRepository\n) : ViewModelProvider.Factory {\n\n    override fun &lt;T : ViewModel&gt; create(modelClass: Class&lt;T&gt;): T {\n        if (modelClass.isAssignableFrom(UserViewModel::class.java)) {\n            @Suppress(\"UNCHECKED_CAST\")\n            return UserViewModel(userId, repository) as T\n        }\n        throw IllegalArgumentException(\"Unknown ViewModel class\")\n    }\n}\n</code></pre> Utilitzar el Factory: <pre><code>class UserActivity : AppCompatActivity() {\n\n    private val viewModel: UserViewModel by viewModels {\n        UserViewModelFactory(\n            userId = intent.getStringExtra(\"USER_ID\") ?: \"\",\n            repository = UserRepository()\n        )\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        viewModel.user.observe(this) { user -&gt;\n            textView.text = user.name\n        }\n    }\n}\n</code></pre></p>"},{"location":"Android/Arquitectura/viewmodel/#4-recursos","title":"4. Recursos","text":"<p>https://www.youtube.com/watch?v=orH4K6qBzvE</p>"},{"location":"Android/Firebase/","title":"Firebase","text":"<p>Continguts:</p> <ul> <li>Setup de Firebase a Android: Android/Firebase/fbsetup.md</li> <li>Firestore:  Android/Firebase/firestore.md</li> <li>Autenticaci\u00f3: (Pendent)</li> <li>Storage:  (Pendent)</li> <li>FireCloud Messaging:  (Pendent)</li> </ul>"},{"location":"Android/Firebase/#les-eines-de-firebase-es-poden-dividir-en-4-blocs-principals","title":"Les eines de Firebase es poden dividir en 4 blocs principals:","text":""},{"location":"Android/Firebase/#1-back-end-database","title":"1. Back-end Database","text":""},{"location":"Android/Firebase/#11-firestore-base-de-dades-nosql","title":"1.1. Firestore (Base de dades NoSQL)","text":"<ul> <li>Base de Dades NoSQL Documental<ul> <li>Estructura flexible: Documents \u2192 Col\u00b7leccions \u2192 Subcol\u00b7leccions</li> <li>Sense esquema fix: Pots afegir camps din\u00e0micament</li> <li>Millor escalabilitat que bases de dades SQL per a certs casos d'\u00fas</li> </ul> </li> <li>Sincronitzaci\u00f3 en Temps Real<ul> <li>Listeners autom\u00e0tics: Rebes canvis immediatament</li> <li>Multiplataforma: Tots els clients reben les dades actualitzades</li> <li>Offline-first: Funciona sense connexi\u00f3 i sincronitza despr\u00e9s</li> </ul> </li> <li>Seguretat Integrada<ul> <li>Regles de seguretat: Control d'acc\u00e9s a nivell de document</li> <li>Validaci\u00f3 de dades: A les mateixes regles</li> <li>Autenticaci\u00f3 integrada: Amb Firebase Auth</li> </ul> </li> <li>Limitacions clau:<ul> <li>Sense JOINs: Has de desnormalitzar dades</li> <li>Sense consultes entre col\u00b7leccions: Tot en una consulta ha d'estar a la mateixa col\u00b7lecci\u00f3</li> <li>Restriccions en filtres: No pots filtrar per dos camps diferents sense \u00edndex compost</li> </ul> </li> </ul>"},{"location":"Android/Firebase/#projectes-tipics","title":"Projectes t\u00edpics:","text":"<p>App de Tasques (Todoist-like) App de Fitness (Strava-like)</p>"},{"location":"Android/Firebase/#en-general","title":"En general:","text":"<ul> <li>Firestore \u00e9s ideal quan:<ul> <li>Necessites temps real</li> <li>Tens dades jer\u00e0rquiques o estructurades</li> <li>Vols escalar autom\u00e0ticament</li> <li>El teu model de dades no necessita JOINs complexos</li> <li>Pots desnormalitzar les dades</li> </ul> </li> <li>Millor evitar Firestore quan:<ul> <li>Necessites moltes agregacions (SUM, AVG, GROUP BY)</li> <li>Tens relacions complexes entre entitats</li> <li>Necessites consist\u00e8ncia estricta en tot moment</li> <li>Tens volums massius d'escriptura cont\u00ednua</li> </ul> </li> </ul>"},{"location":"Android/Firebase/#12-realtime-database","title":"1.2 Realtime Database","text":"<ul> <li> <p>Estructura \u00danica: Arbre JSON Gran</p> <ul> <li>Un gran JSON: Totes les dades en un sol arbre</li> <li>Anidaci\u00f3 profunda: nodes/ins/outre/loques/sigui/profund</li> <li>Sense esquema: Totalment flexible</li> </ul> </li> <li> <p>Sincronitzaci\u00f3 Ultra R\u00e0pida</p> <ul> <li>Baix\u00edssima lat\u00e8ncia: Mil\u00b7lisegons per actualitzacions</li> <li>WebSocket persistent: Connexi\u00f3 cont\u00ednua</li> <li>Broadcast autom\u00e0tic: Tots els clients reben canvis immediatament</li> </ul> </li> <li> <p>Consultes Limitades Simples</p> <ul> <li>Consultes b\u00e0siques: .orderByChild(), .orderByValue(), .orderByKey()</li> <li>Un sol filtre per consulta: No pots combinar m\u00faltiples where()</li> <li>Sense \u00edndexs complexos: M\u00e9s simple de gestionar</li> </ul> </li> </ul>"},{"location":"Android/Firebase/#projectes","title":"Projectes:","text":"<ul> <li>Aplicacions de Xat en Temps Real</li> <li>Jocs Multijugador i Competici\u00f3</li> <li>Aplicacions de Pres\u00e8ncia i Estat (connectat, escrivint...)</li> <li>Control i Monitoritzaci\u00f3 IoT</li> </ul>"},{"location":"Android/Firebase/#en-general_1","title":"En general:","text":"<ul> <li> <p>Tria Realtime Database quan:</p> <ul> <li>Necessites lat\u00e8ncia ultra baixa (&lt;100ms)</li> <li>Tens dades que canvien constantment (cada segon)</li> <li>El teu model de dades \u00e9s pl\u00e0 o arbre simple</li> <li>Necessites broadcast a tots els clients simult\u00e0niament</li> <li>Tens pocs usuaris concurrents (o acceptes el l\u00edmit)</li> </ul> </li> <li> <p>Millor evitar RTDB quan:</p> <ul> <li>Necessites consultes complexes amb m\u00faltiples filtres</li> <li>Esperes creixement massiu (&gt;200k usuaris concurrents)</li> <li>Tens dades amb estructura molt jer\u00e0rquica</li> <li>Necessites transaccions complexes</li> <li>Vols paginaci\u00f3 avan\u00e7ada i ordenaci\u00f3</li> </ul> </li> </ul>"},{"location":"Android/Firebase/#2-autenticacio-i-seguretat","title":"2. Autenticaci\u00f3 i seguretat","text":""},{"location":"Android/Firebase/#21-firebase-authentication-imprescindible","title":"2.1, Firebase Authentication (imprescindible)","text":"<ul> <li>Manera f\u00e0cil i moderna d\u2019autenticar usuaris:</li> <li>Correu + contrasenya</li> <li>Google, Facebook, Apple</li> <li>An\u00f2nim</li> <li>Enviament de correus de verificaci\u00f3</li> </ul>"},{"location":"Android/Firebase/#perfeta-per","title":"Perfeta per:","text":"<ul> <li>Login + registre complet en 15 minuts, sense backend.</li> </ul>"},{"location":"Android/Firebase/#22-cloud-firestore-security-rules","title":"2.2, Cloud Firestore Security Rules","text":"<ul> <li>Sistema per definir permisos:<ul> <li>Qui pot llegir?</li> <li>Qui pot escriure?</li> <li>Condicions basades en usuari?</li> </ul> </li> </ul>"},{"location":"Android/Firebase/#projectes_1","title":"Projectes:","text":"<ul> <li>Apps multi-usuari segures sense servidor.</li> </ul>"},{"location":"Android/Firebase/#3-comunicacio-i-notificacions","title":"3. Comunicaci\u00f3 i notificacions","text":""},{"location":"Android/Firebase/#firebase-cloud-messaging-fcm","title":"Firebase Cloud Messaging (FCM)","text":"<ul> <li>Servei professional per a notificacions push.</li> <li>Enviar notificacions a dispositius Android</li> <li>Des de consola o backend</li> <li>Personalitzaci\u00f3 per topic (\u201cnovetats\u201d, \u201cpromocions\u201d\u2026)</li> <li>Rebre notificacions en segon pla</li> </ul>"},{"location":"Android/Firebase/#perfecte-per","title":"Perfecte per:","text":"<ul> <li>Enviar avisos a moda de \u201cbackend real\u201d.</li> </ul>"},{"location":"Android/Firebase/#4-eines-complementaries-molt-utils-segons-el-projecte","title":"4. Eines complement\u00e0ries (molt \u00fatils segons el projecte)","text":""},{"location":"Android/Firebase/#firebase-storage","title":"Firebase Storage","text":"<ul> <li>Emmagatzemament d\u2019arxius:<ul> <li>Imatges</li> <li>PDFs</li> <li>Audios</li> <li>V\u00eddeos</li> </ul> </li> </ul>"},{"location":"Android/Firebase/#projectes_2","title":"Projectes:","text":"<ul> <li>Perfil d\u2019usuari amb foto, pujar documents.</li> </ul>"},{"location":"Android/Firebase/#firebase-analytics","title":"Firebase Analytics","text":"<ul> <li>Anal\u00edtica integrada:<ul> <li>Pantalles visitades</li> <li>Temps en cada vista</li> <li>Esdeveniments personalitzats</li> </ul> </li> </ul>"},{"location":"Android/Firebase/fbsetup/","title":"Setup de Firebase a Android","text":""},{"location":"Android/Firebase/fbsetup/#1-crear-un-projecte-a-la-consola-de-firebase","title":"1. Crear un projecte a la consola de Firebase","text":"<ol> <li>Accedeix a Firebase Console</li> <li>Fes clic a \u201cAdd project\u201d (Afegir projecte).</li> <li>Introdueix el nom del projecte.</li> <li>(Opcional) Pots activar Google Analytics, per\u00f2 no \u00e9s necessari per comen\u00e7ar.</li> <li>Fes clic a \u201cCreate project\u201d i espera que Firebase finalitzi la creaci\u00f3 del projecte.</li> </ol>"},{"location":"Android/Firebase/fbsetup/#2-afegir-una-aplicacio-android-al-projecte-firebase","title":"2. Afegir una aplicaci\u00f3 Android al projecte Firebase","text":"<ol> <li> <p>A la vista del projecte a Firebase, fes clic a Android icon (\u201cAdd app\u201d).</p> </li> <li> <p>Introdueix el nom del paquet de la teva app Android (exactament el que tens a AndroidManifest.xml).</p> </li> <li> <p>(Opcional) Pots afegir un nickname de l\u2019aplicaci\u00f3 i el SHA-1 del certificat de depuraci\u00f3, si m\u00e9s endavant vols usar autenticaci\u00f3 o notificacions.</p> </li> </ol> <p>Fes clic a \u201cRegister app\u201d.</p>"},{"location":"Android/Firebase/fbsetup/#3-descarregar-el-fitxer-google-servicesjson","title":"3. Descarregar el fitxer google-services.json","text":"<ol> <li> <p>Despr\u00e9s de registrar l\u2019app, Firebase et donar\u00e0 un fitxer google-services.json.</p> </li> <li> <p>Descarrega aquest fitxer.</p> </li> <li> <p>Col\u00b7loca\u2019l a la carpeta app/ del teu projecte Android (no a la carpeta arrel del projecte).</p> </li> </ol> <pre><code>Important: No afegeixis aquest fitxer al repositori p\u00fablic de GitHub si cont\u00e9 credencials sensibles. Si \u00e9s p\u00fablic, considera utilitzar [GitHub Secrets] o ignorar-lo amb .gitignore.\n</code></pre>"},{"location":"Android/Firebase/fbsetup/#4-configuracio-del-projecte-a-android-studio","title":"4. Configuraci\u00f3 del projecte a Android Studio","text":"<p>Firebase utilitza el plugin de Google Services. Haur\u00e0s d\u2019afegir-lo al projecte.</p>"},{"location":"Android/Firebase/fbsetup/#pas-1-afegir-els-repositoris-i-dependencies-a-buildgradle-project-level","title":"Pas 1: Afegir els repositoris i depend\u00e8ncies a build.gradle (Project-level)","text":"<pre><code>buildscript {\n    repositories {\n        google()  // Necessari per Firebase\n        mavenCentral()\n    }\n    dependencies {\n        classpath \"com.android.tools.build:gradle:8.1.0\"  // Versi\u00f3 d\u2019exemple\n        classpath \"com.google.gms:google-services:4.4.0\"   // Plugin de Google Services\n    }\n}\n\nallprojects {\n    repositories {\n        google()\n        mavenCentral()\n    }\n}\n</code></pre>"},{"location":"Android/Firebase/fbsetup/#pas-2-aplicar-el-plugin-a-buildgradle-app-level","title":"Pas 2: Aplicar el plugin a build.gradle (App-level)","text":"<p>A app/build.gradle:</p> <pre><code>plugins {\n    id 'com.android.application'\n    id 'com.google.gms.google-services'  // Firebase plugin\n}\n</code></pre>"},{"location":"Android/Firebase/fbsetup/#pas-3-afegir-dependencies-especifiques-opcional-ara","title":"Pas 3: Afegir depend\u00e8ncies espec\u00edfiques (opcional ara)","text":"<p>Quan utilitzem algun dels serveis concrets de firebase, afegirem algunes depend\u00e8ncies. Aix\u00f2 estar\u00e0 explicat en el cap\u00edtol corresponent al servei.</p>"},{"location":"Android/Firebase/fbsetup/#5-sincronitzacio-del-projecte-amb-gradle","title":"5. Sincronitzaci\u00f3 del projecte amb Gradle","text":"<p>A Android Studio, fes clic a \u201cSync Now\u201d quan t\u2019aparegui la notificaci\u00f3.</p> <p>Assegura\u2019t que no hi ha errors. Si hi ha problemes amb repositoris o versions, comprova que google() est\u00e0 incl\u00f2s.</p>"},{"location":"Android/Firebase/fbsetup/#6-integracio-amb-github","title":"6. Integraci\u00f3 amb GitHub","text":"<p>Si el projecte est\u00e0 a GitHub, tingues en compte:</p> <p>Afegir google-services.json a .gitignore per evitar exposar credencials</p> <pre><code># Firebase config\n/app/google-services.json\n</code></pre> <p>Si treballes en equip, cada desenvolupador hauria de descarregar el seu fitxer google-services.json des de Firebase i col\u00b7locar-lo a app/.</p> <p>El fitxer build.gradle i la configuraci\u00f3 del plugin es poden versionar sense problemes.</p>"},{"location":"Android/Firebase/fbsetup/#7-verificar-la-integracio","title":"7. Verificar la integraci\u00f3","text":"<p>Tot i que encara no hem configurat cap servei concret, la millor manera de comprovar que el setup funciona \u00e9s sincronitzar i compilar el projecte. Si no hi ha errors relacionats amb Firebase, la configuraci\u00f3 \u00e9s correcta.</p>"},{"location":"Android/Firebase/fbsetup/#8-resum-dels-passos","title":"8. Resum dels passos:","text":"<pre><code>1. Crear projecte a Firebase Console\n   \u251c\u2500 Accedir a: https://console.firebase.google.com/\n   \u251c\u2500 \"Add project\"\n   \u251c\u2500 Nom del projecte\n   \u2514\u2500 (Opcional) Activar Google Analytics\n\n2. Afegir aplicaci\u00f3 Android al projecte Firebase\n   \u251c\u2500 Cliquer sobre el logo Android \"Add app\"\n   \u251c\u2500 Introduir el nom del paquet (package name)\n   \u251c\u2500 (Opcional) Nickname i SHA-1\n   \u2514\u2500 \"Register app\"\n\n3. Descarregar fitxer google-services.json\n   \u251c\u2500 Guardar-lo a la carpeta: app/\n   \u2514\u2500 \u26a0\ufe0f No pujar-lo a repositoris p\u00fablics\n\n4. Configuraci\u00f3 del projecte a Android Studio\n   \u251c\u2500 build.gradle (Project-level):\n   \u2502   \u251c\u2500 Afegir repositoris: google(), mavenCentral()\n   \u2502   \u2514\u2500 Afegir classpath: com.google.gms:google-services\n   \u251c\u2500 build.gradle (App-level):\n   \u2502   \u2514\u2500 Aplicar plugin: id 'com.google.gms.google-services'\n   \u2514\u2500 (Opcional) Afegir depend\u00e8ncies Firebase\n\n5. Sincronitzaci\u00f3 amb Gradle\n   \u2514\u2500 \"Sync Now\" \u2192 verificar que no hi hagi errors\n\n6. Integraci\u00f3 amb GitHub\n   \u251c\u2500 Afegir google-services.json a .gitignore\n   \u251c\u2500 Cada desenvolupador descarrega el seu google-services.json\n   \u2514\u2500 Versionar build.gradle i plugins sense problemes\n\n7. Verificaci\u00f3\n   \u2514\u2500 Compilar projecte \u2192 si no hi ha errors, configuraci\u00f3 correcta\n</code></pre>"},{"location":"Android/Firebase/firestore/","title":"1. Qu\u00e8 \u00e9s Cloud Firestore?","text":"<p>Cloud Firestore \u00e9s una base de dades de tipus NoSQL allotjada al n\u00favol, que forma part de la plataforma Firebase de Google. </p> <p>A difer\u00e8ncia de les bases de dades relacionals cl\u00e0ssiques (com MySQL o PostgreSQL), Firestore no fa servir taules ni files, sin\u00f3 que organitza la informaci\u00f3 en Documents i Col\u00b7leccions.</p>"},{"location":"Android/Firebase/firestore/#1-lestructura-de-dades","title":"1. L'Estructura de Dades","text":"<p>L'arquitectura de Firestore es basa en tres pilars:</p> <ul> <li> <p>Document: \u00c9s la unitat b\u00e0sica de dades. S'assembla a un fitxer JSON i cont\u00e9 parelles de \"clau-valor\" (per exemple: nom: \"Cadirat\", preu: 25).</p> </li> <li> <p>Col\u00b7lecci\u00f3: \u00c9s un contenidor de documents. Imagina-ho com una carpeta que guarda molts \"fitxers\" (documents) del mateix tipus (per exemple, una col\u00b7lecci\u00f3 anomenada items).</p> </li> <li> <p>Camps (Fields): S\u00f3n les dades espec\u00edfiques dins d'un document (strings, n\u00fameros, booleans, llistes, etc.).</p> </li> </ul> <p>Jerarquia: </p> <p>L'estructura segueix sempre el patr\u00f3 Col\u00b7lecci\u00f3 &gt; Document &gt; Col\u00b7lecci\u00f3 &gt; Document.</p>"},{"location":"Android/Firebase/firestore/#2-caracteristiques-principals","title":"2. Caracter\u00edstiques Principals","text":"<ul> <li> <p>Temps Real: Firestore pot \"avisar\" a l'aplicaci\u00f3 Android cada vegada que una dada canvia al servidor, actualitzant la interf\u00edcie autom\u00e0ticament sense haver de refrescar.</p> </li> <li> <p>Suport Offline: L'aplicaci\u00f3 pot seguir escrivint i llegint dades encara que no hi hagi internet; Firestore sincronitza els canvis autom\u00e0ticament quan es recupera la connexi\u00f3.</p> </li> <li> <p>Escalabilitat: Est\u00e0 dissenyada per cr\u00e9ixer sense que el rendiment de les consultes se'n ressenti, ideal tant per a projectes petits com per a aplicacions amb milions d'usuaris.</p> </li> </ul>"},{"location":"Android/Firebase/firestore/#2-inicialitzar-firestore","title":"2. Inicialitzar Firestore","text":"<p>Dins del teu Activity, Fragment o ViewModel, obt\u00e9 la inst\u00e0ncia de la base de dades:</p> <pre><code>    val db = Firebase.firestore\n</code></pre>"},{"location":"Android/Firebase/firestore/#3-guardar-dades","title":"3. Guardar Dades","text":"<p>Afegir un nou \u00edtem.</p> <p>Podem deixar que Firestore generi un ID autom\u00e0tic o especificar-ne un. Aqu\u00ed fem servir un ID generat autom\u00e0ticament:</p> <pre><code>fun guardarItem(nom: String, descripcio: String, categoria: String) {\n    // Creem una refer\u00e8ncia a un nou document (genera l'ID autom\u00e0ticament)\n    val nouDocument = db.collection(\"items\").document()\n\n    val item = Item(\n        id = nouDocument.id, // Guardem l'ID generat dins de l'objecte\n        nom = nom,\n        descripcio = descripcio,\n        categoria = categoria\n    )\n\n    nouDocument.set(item)\n        .addOnSuccessListener {\n            // \u00c8xit en la pujada\n        }\n        .addOnFailureListener { e -&gt;\n            // Error en la pujada\n        }\n}\n</code></pre>"},{"location":"Android/Firebase/firestore/#4-recuperar-dades","title":"4. Recuperar Dades","text":""},{"location":"Android/Firebase/firestore/#obtenir-la-llista-completa-one-time-fetch","title":"Obtenir la llista completa (One-time fetch)","text":"<p>Aquesta operaci\u00f3 llegeix tota la llista d'\u00edtems.  S'utilitza en llistes que no canvien constantment.</p> <pre><code>fun obtenirItems() {\n    db.collection(\"items\")\n        .get()\n        .addOnSuccessListener { result -&gt;\n            // Convertim tots els documents a una llista d'objectes Item\n            val llistaItems = result.toObjects(Item::class.java)\n\n            // Aqu\u00ed pots carregar la llista al teu RecyclerView Adapter\n            actualitzarUI(llistaItems)\n        }\n        .addOnFailureListener { exception -&gt;\n            // Gestionar l'error\n        }\n}\n</code></pre>"},{"location":"Android/Firebase/firestore/#actualitzacio-en-temps-real-real-time-updates","title":"Actualitzaci\u00f3 en temps real (Real-time updates)","text":"<p>Si vols que la llista s'actualitzi autom\u00e0ticament quan hi ha canvis a la base de dades:</p> <pre><code>fun escoltarCanvis() {\n    db.collection(\"items\")\n        .addSnapshotListener { snapshot, e -&gt;\n            if (e != null) return@addSnapshotListener\n\n            if (snapshot != null) {\n                val llistaItems = snapshot.toObjects(Item::class.java)\n                actualitzarUI(llistaItems)\n            }\n        }\n}\n</code></pre>"},{"location":"Android/Firebase/firestore/#5-filtrar-dades","title":"5. Filtrar Dades","text":"<p>Firestore permet fer consultes directes sobre els camps dels objectes. </p> <p>Per exemple, obtenir nom\u00e9s els \u00edtems d'una categoria espec\u00edfica:</p> <pre><code>fun obtenirPerCategoria(categoria: String) {\n    db.collection(\"items\")\n        .whereEqualTo(\"categoria\", categoria)\n        .get()\n        .addOnSuccessListener { documents -&gt;\n            val llistaFiltrada = documents.toObjects(Item::class.java)\n            actualitzarUI(llistaFiltrada)\n        }\n}\n</code></pre>"},{"location":"Android/Firebase/firestore/#6-integracio-amb-github","title":"6. Integraci\u00f3 amb GitHub","text":"<p>Si el projecte est\u00e0 a GitHub, tingues en compte:</p> <p>Afegir google-services.json a .gitignore per evitar exposar credencials:</p> <pre><code># Firebase config\n/app/google-services.json\n</code></pre> <p>Si treballes en equip, cada desenvolupador hauria de descarregar el seu fitxer google-services.json des de Firebase i col\u00b7locar-lo a app/.</p>"},{"location":"Android/Interficies/","title":"Interf\u00edcies i components","text":""},{"location":"Android/Interficies/#continguts","title":"Continguts","text":"<ul> <li>Layouts:</li> <li>Temes i Estils:</li> <li>VieweBinding: </li> <li>Appbar:</li> <li>Toolbar:</li> <li>Bottom Menu:</li> <li>Navigation Drawer:</li> <li>Dialegs:</li> <li>RecyclerView: - RecyclerView Afegir i eliminar:</li> <li>Recyclerview filtrat:</li> <li>Men\u00fas:</li> <li>Splash Screen:</li> <li>Voice Recognition:</li> </ul>"},{"location":"Android/Interficies/appbar/","title":"Appbar","text":"<p>Documentaci\u00f3 oficial: https://developer.android.com/develop/ui/views/components/appbar</p>"},{"location":"Android/Interficies/appbar/#1-concepte-i-funcio","title":"1. Concepte i funci\u00f3","text":"<p>Originalment coneguda com a Action Bar, aquesta barra estava estretament lligada a la tem\u00e0tica de l'activitat.  Va ser la soluci\u00f3 est\u00e0ndard per a la barra d'aplicacions abans de la introducci\u00f3 del widget Toolbar (introdu\u00eft formalment a Android 5.0 Lollipop i el Support Library).</p> <p>Amb l'arribada de Material Design, es va evolucionar al component Toolbar, oferint molta m\u00e9s flexibilitat en estil, posicionament i funcionalitats. Avui, quan parlem d'AppBar, generalment ens referim a una Toolbar configurada a la part superior de la pantalla.</p> <p>En aquest tema nom\u00e9s parlarem de la appbar predefinida pel sistema. Si es vol personalitzar, s'ha d'utilitzar una toolbar.</p> <p>La Appbar no s'ha de confondre amb la status bar.</p> Status bar Appbar"},{"location":"Android/Interficies/appbar/#limitacions","title":"Limitacions","text":"<p>La ra\u00f3 principal per la qual es va promoure la Toolbar \u00e9s la falta de flexibilitat de l'Action Bar per defecte.</p> Caracter\u00edstica Action Bar (Per Defecte) Toolbar (Widget Manual) Posicionament Sempre fixada a la part superior de la finestra de l'Activity. Es pot col\u00b7locar a qualsevol lloc del disseny (part inferior, central, etc.). Integraci\u00f3 amb Scroll No es coordina amb el contingut despla\u00e7able (no es pot col\u00b7lapsar). Integraci\u00f3 nativa amb CoordinatorLayout per a efectes de col\u00b7lapsament. Contingut Personalitzat Molt limitat. Nom\u00e9s permet canviar el text/icona. Es poden afegir widgets personalitzats (camps de cerca, imatges, etc.) directament al seu XML. Gesti\u00f3 Gestionada per la finestra de l'Activity (M\u00e8tode getSupportActionBar()). Gestionada com qualsevol altre widget de vista (findViewById())."},{"location":"Android/Interficies/appbar/#rols-principals","title":"Rols Principals:","text":"<ul> <li> <p>Identitat: Mostrar el nom de l'aplicaci\u00f3 o de la vista actual (T\u00edtol).</p> </li> <li> <p>Navegaci\u00f3: Oferir un mitj\u00e0 per moure's cap enrere o accedir a un calaix de navegaci\u00f3 (Navigation Icon).</p> </li> <li> <p>Accions: Proporcionar acc\u00e9s r\u00e0pid a les accions m\u00e9s importants del context actual (Action Menu).</p> </li> </ul>"},{"location":"Android/Interficies/appbar/#2-implementacio","title":"2. Implementaci\u00f3","text":"<p>L'Action Bar no es declara al fitxer XML del layout. La seva pres\u00e8ncia i estil es controlen exclusivament a trav\u00e9s del Tema de l'aplicaci\u00f3.</p> <p>Requisit de Tema: Per defecte, si el vostre tema hereta d'un tema que inclou una Action Bar (com ara Theme.AppCompat.Light.DarkActionBar), el sistema la dibuixar\u00e0 autom\u00e0ticament a la part superior de l'activitat.</p> <p>Temes Sense Barra: Si voleu eliminar-la (per exemple, per substituir-la per una Toolbar personalitzada), cal utilitzar un tema \"Sense Action Bar\", com ara:</p> <p>Theme.AppCompat.NoActionBar</p> <p>Theme.MaterialComponents.Light.NoActionBar</p> <p>Per accedir a la appbar si es configura a trav\u00e9s del tema, podem obtenir una refer\u00e8ncia aix\u00ed:</p> <pre><code>var toolbar= this.supportActionBar\n</code></pre>"},{"location":"Android/Interficies/appbar/#3-gestio-de-menus-igual-que-la-toolbar","title":"3. Gesti\u00f3 de Men\u00fas (Igual que la Toolbar)","text":"<p>En aquest aspecte, l'Action Bar es comporta de manera id\u00e8ntica a la Toolbar:</p> <p>Inflament del Men\u00fa: El contingut de les accions es defineix en un fitxer XML de men\u00fa i s'infla mitjan\u00e7ant el m\u00e8tode onCreateOptionsMenu(). <pre><code>override fun onCreateOptionsMenu(menu: Menu?): Boolean {\n    menuInflater.inflate(R.menu.main_menu, menu)\n    return true\n}\n</code></pre></p> <p>Gesti\u00f3 de Clics: La l\u00f2gica del clic continua estant en onOptionsItemSelected(), on es gestionen tant les accions del men\u00fa com la fletxa \"Amunt\" (android.R.id.home). <pre><code>override fun onOptionsItemSelected(item: MenuItem): Boolean {\n        // Obtenim l'identificador de l'\u00edtem clicat\n        return when (item.itemId) {\n            ...\n        }\n}\n</code></pre> Gesti\u00f3 dels elements del men\u00fa:</p> <p>Quan l'usuari fa click i s'ha de mostrar el men\u00fa, podem aprofitar per habilitar o deshabilitar algun element.  <pre><code>//Quan l'usuari fa click\noverride fun onPrepareOptionsMenu(menu: Menu?): Boolean {\n    if (true){\n        var item=menu?.findItem(R.id.profile_nav_home)\n       item?.setEnabled(false)\n        Log.i(\"Toolbaronly_prepareoptionsmenu\",item?.title.toString())\n    }\n    return super.onPrepareOptionsMenu(menu)\n}\n</code></pre></p>"},{"location":"Android/Interficies/appbar/#4-gestio-de-la-appbar-amb-els-temes","title":"4. Gesti\u00f3 de la appbar amb els temes","text":"<p>La appbar per defecte, es mostra o no en funci\u00f3 del tema que estigui aplicat a l'activity:</p> <p>Tema amb appbar: <pre><code>    &lt;style name=\"Base.Theme.LaMevaApp\" parent=\"Theme.Material3.DayNight.DarkActionBar\"&gt;\n        &lt;!-- Customize your dark theme here. --&gt;\n        &lt;!-- &lt;item name=\"colorPrimary\"&gt;@color/my_dark_primary&lt;/item&gt; --&gt;\n    &lt;/style&gt;\n</code></pre> Tema sense appbar: <pre><code>    &lt;style name=\"Base.Theme.LaMevaApp\" parent=\"Theme.Material3.DayNight.NoActionBar\"&gt;\n        &lt;!-- Customize your dark theme here. --&gt;\n        &lt;!-- &lt;item name=\"colorPrimary\"&gt;@color/my_dark_primary&lt;/item&gt; --&gt;\n    &lt;/style&gt;\n</code></pre></p>"},{"location":"Android/Interficies/appbar/#personalitzacio-dactivities-amb-o-sense-appbar","title":"Personalitzaci\u00f3 d'activities amb o sense appbar.","text":"<p>Podem definir un conjunt de temes coherent que permeti que algunes de les teves activitats tinguin una barra d'aplicaci\u00f3 i altres no, tot utilitzant els mateixos colors de marca.</p>"},{"location":"Android/Interficies/appbar/#tema-base-de-laplicacio","title":"Tema Base de l'Aplicaci\u00f3","text":"<p>Primer, crea un tema base al teu fitxer themes.xml que contingui tots els teus colors, tipografies i estils personalitzats. </p> <p>Tamb\u00e9 definim el tema de l'aplicaci\u00f3  Aquest ser\u00e0 el tema principal de la teva aplicaci\u00f3. (Theme.MyCustomApp) (Cal definir tamb\u00e9 els colors a colors.xml)</p> <p>Tant el tema base com el de l'aplicaci\u00f3 tenen appbar (hereten de DarkActionBar)</p> <p><pre><code>&lt;resources xmlns:tools=\"http://schemas.android.com/tools\"&gt;\n\n    &lt;style name=\"Base.Theme.MyCustomApp\" parent=\"Theme.MaterialComponents.DayNight.DarkActionBar\"&gt;\n        &lt;item name=\"colorPrimary\"&gt;@color/my_primary_color&lt;/item&gt;\n        &lt;item name=\"colorSecondary\"&gt;@color/my_secondary_color&lt;/item&gt;\n        &lt;item name=\"android:textColorPrimary\"&gt;@color/my_text_primary&lt;/item&gt;\n        &lt;/style&gt;\n    &lt;style name=\"Theme.MyCustomApp\" parent=\"Base.Theme.MyCustomApp\"&gt;\n\n&lt;/resources&gt;\n</code></pre> Aquest ser\u00e0 el tema per defecte de l\u2019aplicaci\u00f3 (amb AppBar).\u200b</p> <p>A AndroidManifest.xml, aplica\u2019l a l\u2019: <p><code>xml &lt;application     ...     android:theme=\"@style/Theme.MyCustomApp\"&gt;     ...</code> Aix\u00f2 fa que totes les activities usin aquest tema, excepte les que el sobreescriguin.\u200b</p>"},{"location":"Android/Interficies/appbar/#tema-fill-sense-appbar","title":"Tema fill sense AppBar","text":"<p>Crea un tema que hereti del base per\u00f2 desactivi la barra d\u2019acci\u00f3 (ideal per pantalles fullscreen, login, splash, etc.):</p> <p><pre><code>&lt;style name=\"Theme.MyCustomApp.NoActionBar\" parent=\"Theme.MyCustomApp\"&gt;\n    &lt;item name=\"windowNoTitle\"&gt;true&lt;/item&gt;\n    &lt;item name=\"windowActionBar\"&gt;false&lt;/item&gt;\n&lt;/style&gt;\n</code></pre> Aix\u00ed es mantenen tots els colors i estils del tema de l'aplicaci\u00f3, per\u00f2 sense AppBar.\u200b</p>"},{"location":"Android/Interficies/appbar/#assignar-tema-per-activity","title":"Assignar tema per Activity","text":"<p>Al AndroidManifest.xml pots dir quines activities porten appbar (tema base) i quines no (tema sense barra):</p> <pre><code>&lt;application\n    ...\n    android:theme=\"@style/Theme.MyCustomApp\"&gt;\n\n    &lt;!-- Activity amb AppBar (usa el tema base) --&gt;\n    &lt;activity\n        android:name=\".MainActivity\" /&gt;\n\n    &lt;!-- Activity sense AppBar --&gt;\n    &lt;activity\n        android:name=\".LoginActivity\"\n        android:theme=\"@style/Theme.MyCustomApp.NoActionBar\" /&gt;\n\n    &lt;!-- Activity amb AppBar personalitzada --&gt;\n    &lt;activity\n        android:name=\".DetailsActivity\"\n        android:theme=\"@style/Theme.MyCustomApp.AppBar\" /&gt;\n&lt;/application&gt;\n</code></pre>"},{"location":"Android/Interficies/bottommenu/","title":"Bottom Menu","text":""},{"location":"Android/Interficies/bottommenu/#menu-de-navegacio-inferior-bottomnavigationview","title":"Men\u00fa de Navegaci\u00f3 Inferior (BottomNavigationView)","text":"<p>El BottomNavigationView gestiona la navegaci\u00f3 de nivell superior entre un nombre redu\u00eft de vistes principals.</p> <p>La seva funci\u00f3 principal \u00e9s la navegaci\u00f3 entre fragments o activities.</p> <p>Vegeu la refer\u00e8ncia en Material 3 aqu\u00ed:</p> <p>https://m3.material.io/components/navigation-bar/overview</p> <p>I aneu a l'apartat Implementation: MDC-Android (p\u00e0gina de Github)</p>"},{"location":"Android/Interficies/bottommenu/#xml-de-menu-de-la-navegacio-inferior","title":"XML de Men\u00fa de la Navegaci\u00f3 Inferior","text":"<p>Per definir un men\u00fa, cal afegir-lo a la carpeta men\u00fa, en l'apartat recursos. (si no existeix, cal crear-lo fent un nou recurs de tipus men\u00fa)</p> <p></p> <p>Exemple: Recurs de Men\u00fa (res/menu/bottom_nav_menu.xml) <pre><code>&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;item\n        android:id=\"@+id/home_fragment\"\n        android:icon=\"@drawable/ic_home\"\n        android:title=\"Inici\" /&gt;\n    &lt;item\n        android:id=\"@+id/dashboard_fragment\"\n        android:icon=\"@drawable/ic_dashboard\"\n        android:title=\"Panell\" /&gt;\n    &lt;item\n        android:id=\"@+id/notifications_fragment\"\n        android:icon=\"@drawable/ic_notifications\"\n        android:title=\"Avisos\" /&gt;\n&lt;/menu&gt;\n</code></pre> Exemple: Layout de l'activity (fixeu-vos en la linia ressaltada) Es vincula el component amb el men\u00fa. (tamb\u00e9 es pot fer per programaci\u00f3) <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\"&gt;\n\n    &lt;androidx.fragment.app.FragmentContainerView\n        android:id=\"@+id/fragment_container\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"0dp\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintBottom_toTopOf=\"@id/bottom_navigation\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\" /&gt;\n\n    &lt;com.google.android.material.bottomnavigation.BottomNavigationView\n        android:id=\"@+id/bottom_navigation\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"?android:attr/windowBackground\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:menu=\"@menu/bottom_nav_menu\" /&gt; \n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>Exemple: Gesti\u00f3 Manual de la Navegaci\u00f3 (Kotlin). Cal afegir un listener al component, tal i com fariem amb un bot\u00f3.</p> <p>En aquest cas estem utiitzant fragments, per\u00f2 \u00e9s el mateix amb activities, simplement far\u00edem la gesti\u00f3 de la navegaci\u00f3 amb intents i startactivity</p> <pre><code>// ...\nval bottomNav: BottomNavigationView = findViewById(R.id.bottom_navigation)\n\nbottomNav.setOnItemSelectedListener { item -&gt;\n    val selectedFragment: Fragment? = when (item.itemId) {\n        R.id.home_fragment -&gt; HomeFragment()\n        R.id.dashboard_fragment -&gt; DashboardFragment()\n        R.id.notifications_fragment -&gt; NotificationsFragment()\n        else -&gt; null\n    }\n\n    // Realitza la transacci\u00f3 de Fragment manualment\n    if (selectedFragment != null) {\n        supportFragmentManager.beginTransaction()\n            .replace(R.id.fragment_container, selectedFragment)\n            .commit()\n    }\n    true // Indica que la selecci\u00f3 ha estat gestionada\n}\n// ...\n</code></pre>"},{"location":"Android/Interficies/dialegs/","title":"Dialogs i dialogfragment","text":"<p>Per Fer!</p> <p>Utilitzant dialogfragment i una subclasse d'aquest: Oficial: https://developer.android.com/guide/fragments/dialogs</p> <p>exemple https://www.youtube.com/watch?v=CXggjg9s4NA Interessant per utilitzar interface per retornar un objecte del dialog. Minut 15:00</p>"},{"location":"Android/Interficies/dialogfragmentviewmodel/","title":"Guia Simplificada: DialogFragment amb ViewModel","text":""},{"location":"Android/Interficies/dialogfragmentviewmodel/#estructura-del-projecte","title":"Estructura del Projecte","text":"<pre><code>app/\n\u251c\u2500\u2500 data/\n\u2502   \u2514\u2500\u2500 TasksList.kt\n\u251c\u2500\u2500 model/\n\u2502   \u2514\u2500\u2500 Task.kt\n\u251c\u2500\u2500 viewmodel/\n\u2502   \u2514\u2500\u2500 TasksViewModel.kt\n\u251c\u2500\u2500 ui/\n\u2502   \u251c\u2500\u2500 fragments/\n\u2502   \u2502   \u2514\u2500\u2500 HomeFragment.kt\n\u2502   \u2514\u2500\u2500 dialogs/\n\u2502       \u251c\u2500\u2500 AfegirTascaDialog.kt\n\u2514\u2500\u2500 adapter/\n    \u2514\u2500\u2500 TasksAdapter.kt\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#flux-de-treball","title":"Flux de Treball","text":"<pre><code>                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502           TasksList (Object)            \u2502\n                \u2502      MutableList&lt;Task&gt; (Singleton)      \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                   \u25b2\n                                   \u2502 modifica\n                                   \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          TasksViewModel                                            \u2502\n\u2502  \u2022 Valida les dades                                                                \u2502\n\u2502  \u2022 Modifica TasksList                                                              \u2502\n\u2502  \u2022 Emet LiveData&lt;TascaAction&gt; (AFEGIDA/MODIFICADA/ELIMINADA)                       \u2502\n\u2502  \u2022 Emet LiveData&lt;String?&gt; (errorMessage)                                           \u2502\n\u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2502                                         \u25b2                 \u2502\n    \u2502  observa tascaActionEvent               \u2502 AfegirTasca VM  \u2502 observa errorMessage\n    \u2502                                         \u2502                 \u2502\n    \u25bc                                         \u2502                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        HomeFragment              \u2502         \u2502   AfegirTascaDialog                  \u2502\n\u2502                                  \u2502         \u2502                                      \u2502\n\u2502  \u2022 Observa tascaActionEvent      \u2502         \u2502  \u2022 Observa errorMessage              \u2502\n\u2502  \u2022 Actualitza RecyclerView       \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  \u2022 Mostra Toast d'error              \u2502\n\u2502  \u2022 Mostra Toast de confirmaci\u00f3   \u2502         \u2502  \u2022 Crida viewModel                   \u2502\n\u2502  \u2022 Crida dialogs                 \u2502         \u2502    amb dades del formulari           \u2502\n\u2502                                  \u2502         \u2502                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#1-model-de-dades","title":"1. Model de Dades","text":"<pre><code>// Task.kt\npackage cat.ivha.sparklestask.model\n\nimport android.os.Parcelable\nimport kotlinx.parcelize.Parcelize\n\n@Parcelize\ndata class Task(\n    val id: Int,\n    val title: String,\n    val points: Int,\n    val data: Long\n) : Parcelable\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#2-llista-de-tasques-object","title":"2. Llista de Tasques (Object)","text":"<pre><code>// TasksList.kt\npackage cat.ivha.sparklestask.data\n\nimport cat.ivha.sparklestask.model.Task\n\nobject TasksList {\n    val items = mutableListOf&lt;Task&gt;(\n        Task(1, \"Tasca 1\", 10, System.currentTimeMillis()),\n        Task(2, \"Tasca 2\", 20, System.currentTimeMillis()),\n        Task(3, \"Tasca 3\", 30, System.currentTimeMillis())\n    )\n\n    private var nextId = 4\n\n    fun getNextId(): Int = nextId++\n\n    fun addTask(task: Task) {\n        items.add(task)\n    }\n\n\n    fun getTaskById(id: Int): Task? {\n        return items.find { it.id == id }\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#3-viewmodel","title":"3. ViewModel","text":"<pre><code>// TasksViewModel.kt\npackage cat.ivha.sparklestask.viewmodel\n\nimport androidx.lifecycle.LiveData\nimport androidx.lifecycle.MutableLiveData\nimport androidx.lifecycle.ViewModel\nimport cat.ivha.sparklestask.data.TasksList\nimport cat.ivha.sparklestask.model.Task\n\nclass TasksViewModel : ViewModel() {\n\n    // Tipus d'acci\u00f3 realitzada\n    enum class TascaAction {\n        AFEGIDA, MODIFICADA, ELIMINADA, NONE\n    }\n\n    // Event per notificar canvis\n    private val _tascaActionEvent = MutableLiveData&lt;TascaAction&gt;()\n    val tascaActionEvent: LiveData&lt;TascaAction&gt; = _tascaActionEvent\n\n    // Missatge d'error si la validaci\u00f3 falla\n    private val _errorMessage = MutableLiveData&lt;String?&gt;()\n    val errorMessage: LiveData&lt;String?&gt; = _errorMessage\n\n    /**\n     * Afegeix una nova tasca amb validaci\u00f3\n     */\n    fun afegirTasca(title: String, points: String, data: String): Boolean {\n        // Validaci\u00f3\n        if (title.isBlank()) {\n            _errorMessage.value = \"El nom \u00e9s obligatori\"\n            return false\n        }\n\n        val pointsInt = points.toIntOrNull()\n        if (pointsInt == null) {\n            _errorMessage.value = \"Els punts han de ser un n\u00famero\"\n            return false\n        }\n\n        val dataLong = data.toLongOrNull()\n        if (dataLong == null) {\n            _errorMessage.value = \"La data no \u00e9s v\u00e0lida\"\n            return false\n        }\n\n        // Crear i afegir la tasca\n        val novaTasca = Task(\n            id = TasksList.getNextId(),\n            title = title,\n            points = pointsInt,\n            data = dataLong\n        )\n\n        TasksList.addTask(novaTasca)\n        _tascaActionEvent.value = TascaAction.AFEGIDA\n        _errorMessage.value = null\n        return true\n    }\n\n\n    /**\n     * Reseteja l'event\n     */\n    fun resetEvent() {\n        _tascaActionEvent.value = TascaAction.NONE\n    }\n\n    /**\n     * Reseteja el missatge d'error\n     */\n    fun resetError() {\n        _errorMessage.value = null\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#4-dialogfragment-per-afegir","title":"4. DialogFragment per AFEGIR","text":"<pre><code>// AfegirTascaDialog.kt\npackage cat.ivha.sparklestask.ui.dialogs\n\nimport android.app.Dialog\nimport android.os.Bundle\nimport android.view.ViewGroup\nimport android.widget.Button\nimport android.widget.EditText\nimport android.widget.Toast\nimport androidx.appcompat.app.AlertDialog\nimport androidx.fragment.app.DialogFragment\nimport androidx.fragment.app.activityViewModels\nimport cat.ivha.sparklestask.R\nimport cat.ivha.sparklestask.viewmodel.TasksViewModel\n\nclass AfegirTascaDialog : DialogFragment() {\n\n    private val viewModel: TasksViewModel by activityViewModels()\n\n    private lateinit var etNom: EditText\n    private lateinit var etPoints: EditText\n    private lateinit var etData: EditText\n    private lateinit var btnGuardar: Button\n    private lateinit var btnCancelar: Button\n\n    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {\n        val builder = AlertDialog.Builder(requireContext())\n        val inflater = requireActivity().layoutInflater\n        val view = inflater.inflate(R.layout.dialog_afegir_tasca, null)\n\n        initViews(view)\n        setupListeners()\n        observeViewModel()\n\n        builder.setView(view)\n        return builder.create()\n    }\n\n    private fun initViews(view: android.view.View) {\n        etNom = view.findViewById(R.id.etNom)\n        etPoints = view.findViewById(R.id.etPoints)\n        etData = view.findViewById(R.id.etData)\n        btnGuardar = view.findViewById(R.id.btnGuardar)\n        btnCancelar = view.findViewById(R.id.btnCancelar)\n\n        // Valor per defecte\n        etData.setText(System.currentTimeMillis().toString())\n    }\n\n    private fun setupListeners() {\n        btnGuardar.setOnClickListener {\n            val title = etNom.text.toString()\n            val points = etPoints.text.toString()\n            val data = etData.text.toString()\n\n            // Crida al ViewModel (ell valida)\n            val success = viewModel.afegirTasca(title, points, data)\n\n            if (success) {\n                dismiss()\n            }\n        }\n\n        btnCancelar.setOnClickListener {\n            dismiss()\n        }\n    }\n\n    private fun observeViewModel() {\n        viewModel.errorMessage.observe(this) { error -&gt;\n            error?.let {\n                Toast.makeText(requireContext(), it, Toast.LENGTH_SHORT).show()\n                viewModel.resetError()\n            }\n        }\n    }\n\n    override fun onStart() {\n        super.onStart()\n        dialog?.window?.setLayout(\n            ViewGroup.LayoutParams.MATCH_PARENT,\n            ViewGroup.LayoutParams.WRAP_CONTENT\n        )\n        dialog?.window?.setBackgroundDrawableResource(android.R.color.transparent)\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#5-homefragment","title":"5. HomeFragment","text":"<pre><code>// HomeFragment.kt\npackage cat.ivha.sparklestask.ui.fragments\n\nimport android.os.Bundle\nimport android.view.LayoutInflater\nimport android.view.View\nimport android.view.ViewGroup\nimport android.widget.Button\nimport android.widget.Toast\nimport androidx.fragment.app.Fragment\nimport androidx.fragment.app.activityViewModels\nimport androidx.recyclerview.widget.LinearLayoutManager\nimport androidx.recyclerview.widget.RecyclerView\nimport cat.ivha.sparklestask.R\nimport cat.ivha.sparklestask.adapter.TasksAdapter\nimport cat.ivha.sparklestask.data.TasksList\nimport cat.ivha.sparklestask.ui.dialogs.AfegirTascaDialog\nimport cat.ivha.sparklestask.ui.dialogs.ModificarTascaDialog\nimport cat.ivha.sparklestask.viewmodel.TasksViewModel\n\nclass HomeFragment : Fragment(R.layout.home_rv) {\n\n    private val viewModel: TasksViewModel by activityViewModels()\n\n    private lateinit var recyclerView: RecyclerView\n    private lateinit var adapter: TasksAdapter\n    private lateinit var btnAfegir: Button\n\n    override fun onCreateView(\n        inflater: LayoutInflater,\n        container: ViewGroup?,\n        savedInstanceState: Bundle?\n    ): View? {\n        return inflater.inflate(R.layout.home_rv, container, false)\n    }\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        initComponents(view)\n        setupRecyclerView()\n        setupListeners()\n        observeViewModel()\n    }\n\n    private fun initComponents(view: View) {\n        recyclerView = view.findViewById(R.id.rvTasques)\n        btnAfegir = view.findViewById(R.id.btnAfegir)\n    }\n\n    private fun setupRecyclerView() {\n        recyclerView.layoutManager = LinearLayoutManager(requireContext())\n\n        adapter = TasksAdapter(\n            itemsComplets = TasksList.items\n        )\n\n        recyclerView.adapter = adapter\n    }\n\n    private fun setupListeners() {\n        btnAfegir.setOnClickListener {\n            AfegirTascaDialog().show(parentFragmentManager, \"AfegirTascaDialog\")\n        }\n    }\n\n    private fun observeViewModel() {\n        viewModel.tascaActionEvent.observe(viewLifecycleOwner) { action -&gt;\n            when (action) {\n                TasksViewModel.TascaAction.AFEGIDA -&gt; {\n                    adapter.updateTasks(TasksList.items)                    \n                    Toast.makeText(requireContext(), \"Tasca afegida!\", Toast.LENGTH_SHORT).show()\n                    viewModel.resetEvent()\n                }\n                TasksViewModel.TascaAction.MODIFICADA -&gt; {\n                }\n                TasksViewModel.TascaAction.ELIMINADA -&gt; {\n                }\n                TasksViewModel.TascaAction.NONE -&gt; {\n                    // No fer res\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#6-adapter","title":"6. Adapter","text":"<pre><code>// TasksAdapter.kt\npackage cat.ivha.sparklestask.adapter\n\nimport android.view.LayoutInflater\nimport android.view.View\nimport android.view.ViewGroup\nimport android.widget.TextView\nimport androidx.recyclerview.widget.RecyclerView\nimport cat.ivha.sparklestask.R\nimport cat.ivha.sparklestask.model.Task\n\nclass TasksAdapter(\n    private var itemsComplets: List&lt;Task&gt;\n) : RecyclerView.Adapter&lt;TasksAdapter.TaskViewHolder&gt;() {\n\n    class TaskViewHolder(view: View) : RecyclerView.ViewHolder(view) {\n        val tvTitle: TextView = view.findViewById(R.id.tvTitle)\n        val tvPoints: TextView = view.findViewById(R.id.tvPoints)\n    }\n\n    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): TaskViewHolder {\n        val view = LayoutInflater.from(parent.context)\n            .inflate(R.layout.item_task, parent, false)\n        return TaskViewHolder(view)\n    }\n\n    override fun onBindViewHolder(holder: TaskViewHolder, position: Int) {\n        val task = itemsComplets[position]\n\n        holder.tvTitle.text = task.title\n        holder.tvPoints.text = \"Points: ${task.points}\"\n    }\n\n    override fun getItemCount(): Int = itemsComplets.size\n\n    fun updateTasks(newTasks: List&lt;Task&gt;) {\n        itemsComplets = newTasks\n        notifyDataSetChanged()\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#7-layouts","title":"7. Layouts","text":""},{"location":"Android/Interficies/dialogfragmentviewmodel/#dialog_afegir_tascaxml","title":"dialog_afegir_tasca.xml","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:orientation=\"vertical\"\n    android:padding=\"24dp\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Afegir Nova Tasca\"\n        android:textSize=\"20sp\"\n        android:textStyle=\"bold\"\n        android:layout_marginBottom=\"16dp\"/&gt;\n\n    &lt;EditText\n        android:id=\"@+id/etNom\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Nom de la tasca\"\n        android:layout_marginBottom=\"12dp\"/&gt;\n\n    &lt;EditText\n        android:id=\"@+id/etPoints\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Points\"\n        android:inputType=\"number\"\n        android:layout_marginBottom=\"12dp\"/&gt;\n\n    &lt;EditText\n        android:id=\"@+id/etData\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Data (timestamp)\"\n        android:inputType=\"number\"\n        android:layout_marginBottom=\"16dp\"/&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"horizontal\"\n        android:gravity=\"end\"&gt;\n\n        &lt;Button\n            android:id=\"@+id/btnCancelar\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"Cancel\u00b7lar\"\n            style=\"@style/Widget.Material3.Button.TextButton\"\n            android:layout_marginEnd=\"8dp\"/&gt;\n\n        &lt;Button\n            android:id=\"@+id/btnGuardar\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"Guardar\"/&gt;\n    &lt;/LinearLayout&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre>"},{"location":"Android/Interficies/dialogfragmentviewmodel/#8-dependencies-buildgradle","title":"8. Depend\u00e8ncies (build.gradle)","text":"<pre><code>dependencies {\n    // ViewModel\n    implementation \"androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.2\"\n    implementation \"androidx.fragment:fragment-ktx:1.6.2\"\n\n    // LiveData\n    implementation \"androidx.lifecycle:lifecycle-livedata-ktx:2.6.2\"\n\n    // Material Design\n    implementation \"com.google.android.material:material:1.10.0\"\n}\n\n// Al principi del fitxer\nplugins {\n    id 'kotlin-parcelize'\n}\n</code></pre>"},{"location":"Android/Interficies/drawermenu/","title":"Navigation Drawer","text":""},{"location":"Android/Interficies/drawermenu/#1-drawer-menu","title":"1. Drawer Men\u00fa","text":"<p>Es presenta com un panell vertical que roman ocult i es fa visible lliscant-lo (normalment des de la vora esquerra de la pantalla, depenent de la configuraci\u00f3 de l'idioma) o prement la icona de men\u00fa/hamburguesa a la barra superior de l'aplicaci\u00f3.</p> <p>La seva funci\u00f3 principal \u00e9s estalviar espai a la pantalla i mantenir la interf\u00edcie neta, ja que agrupa les opcions de navegaci\u00f3 menys freq\u00fcentment utilitzades o que porten a pantalles de nivell superior, proporcionant un \u00fanic punt de salt a qualsevol secci\u00f3 principal de l'aplicaci\u00f3.</p>"},{"location":"Android/Interficies/drawermenu/#2-implementacio","title":"2. Implementaci\u00f3","text":""},{"location":"Android/Interficies/drawermenu/#recurs-de-menu-xml","title":"Recurs de Men\u00fa (XML)","text":"<p>Crea un nou fitxer de recurs de men\u00fa a res/menu/main_drawer_menu.xml. Aquest fitxer defineix els \u00edtems que es mostraran al panell lateral. <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;group android:checkableBehavior=\"single\"&gt;\n        &lt;item\n            android:id=\"@+id/nav_home\"\n            android:icon=\"@drawable/ic_home\"\n            android:title=\"Inici\" /&gt;\n        &lt;item\n            android:id=\"@+id/nav_gallery\"\n            android:icon=\"@drawable/ic_gallery\"\n            android:title=\"Galeria\" /&gt;\n        &lt;item\n            android:id=\"@+id/nav_settings\"\n            android:icon=\"@drawable/ic_settings\"\n            android:title=\"Configuraci\u00f3\" /&gt;\n    &lt;/group&gt;\n    &lt;item android:title=\"Comunicaci\u00f3\"&gt;\n        &lt;menu&gt;\n            &lt;item\n                android:id=\"@+id/nav_share\"\n                android:icon=\"@drawable/ic_share\"\n                android:title=\"Compartir\" /&gt;\n        &lt;/menu&gt;\n    &lt;/item&gt;\n&lt;/menu&gt;\n</code></pre></p>"},{"location":"Android/Interficies/drawermenu/#disseny-del-layout","title":"Disseny del Layout","text":"<p>El DrawerLayout \u00e9s el contenidor principal. Ha de contenir dos elements: el contingut principal de l'aplicaci\u00f3 i el panell de navegaci\u00f3.</p>"},{"location":"Android/Interficies/drawermenu/#21-activity_mainxml","title":"2.1 activity_main.xml","text":"<p><pre><code>&lt;androidx.drawerlayout.widget.DrawerLayout \n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:fitsSystemWindows=\"true\" \n    tools:openDrawer=\"start\"&gt;\n\n    &lt;include\n        layout=\"@layout/app_bar_main\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\" /&gt;\n\n    &lt;com.google.android.material.navigation.NavigationView\n        android:id=\"@+id/nav_view\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:layout_gravity=\"start\" \n        android:fitsSystemWindows=\"true\"\n        app:headerLayout=\"@layout/nav_header_main\" \n        app:menu=\"@menu/main_drawer_menu\" /&gt;\n\n&lt;/androidx.drawerlayout.widget.DrawerLayout&gt;\n</code></pre> - DrawerLayout: L'arrel.12android:layout_gravity=\"start\": Crucial. Indica al DrawerLayout que el NavigationView \u00e9s el panell lateral i ha d'apar\u00e8ixer des de la vora inicial (esquerra, en la majoria d'idiomes). - app:menu: Enlla\u00e7a amb el fitxer de men\u00fa XML creat anteriorment.</p>"},{"location":"Android/Interficies/drawermenu/#22-implementacio-de-la-logica","title":"2.2 Implementaci\u00f3 de la L\u00f2gica","text":"<p>La l\u00f2gica es realitza a la MainActivity.kt. </p> <p>Es centra a sincronitzar el Drawer amb la barra d'eines i gestionar els clics.</p> <p>Exemple: <pre><code>import androidx.appcompat.app.AppCompatActivity\nimport android.os.Bundle\nimport android.view.MenuItem\nimport android.widget.Toast\nimport androidx.appcompat.app.ActionBarDrawerToggle\nimport androidx.core.view.GravityCompat\nimport com.google.android.material.navigation.NavigationView\nimport androidx.drawerlayout.widget.DrawerLayout\n\nclass MainActivity : AppCompatActivity(), \n                     NavigationView.OnNavigationItemSelectedListener { // 1. Implementa el Listener\n\n    private lateinit var drawerLayout: DrawerLayout\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // 2. Obtenci\u00f3 de les vistes\n        drawerLayout = findViewById(R.id.drawer_layout)\n        val navView: NavigationView = findViewById(R.id.nav_view)\n\n        // La Toolbar (assumint que s'ha incl\u00f2s a app_bar_main i se li ha assignat un ID 'toolbar')\n        val toolbar: androidx.appcompat.widget.Toolbar = findViewById(R.id.toolbar)\n        setSupportActionBar(toolbar) // Opcional: Si vols usar la Toolbar com a ActionBar\n\n        // 3. Sincronitzaci\u00f3 amb la Barra d'Eines (Icona d'Hamburguesa)\n        val toggle = ActionBarDrawerToggle(\n            this, \n            drawerLayout, \n            toolbar, \n            R.string.navigation_drawer_open, // String de recurs: \"Open navigation drawer\"\n            R.string.navigation_drawer_close // String de recurs: \"Close navigation drawer\"\n        )\n        drawerLayout.addDrawerListener(toggle)\n        toggle.syncState() // Sincronitza l'estat inicial de la icona\n\n        // 4. Establir el Listener per als Clics al Men\u00fa\n        navView.setNavigationItemSelectedListener(this)\n    }\n\n    // 5. Gesti\u00f3 dels Clics al Men\u00fa (Implementaci\u00f3 del Listener)\n    override fun onNavigationItemSelected(item: MenuItem): Boolean {\n        when (item.itemId) {\n            R.id.nav_home -&gt; {\n                Toast.makeText(this, \"Inici seleccionat\", Toast.LENGTH_SHORT).show()\n                // Aqu\u00ed va la l\u00f2gica per canviar Fragment / Activity\n            }\n            R.id.nav_gallery -&gt; {\n                Toast.makeText(this, \"Galeria seleccionada\", Toast.LENGTH_SHORT).show()\n            }\n            R.id.nav_settings -&gt; {\n                Toast.makeText(this, \"Configuraci\u00f3 seleccionada\", Toast.LENGTH_SHORT).show()\n            }\n            R.id.nav_share -&gt; {\n                Toast.makeText(this, \"Compartir seleccionat\", Toast.LENGTH_SHORT).show()\n            }\n        }\n\n        // Tanca el Drawer un cop s'ha seleccionat l'\u00edtem\n        drawerLayout.closeDrawer(GravityCompat.START)\n        return true\n    }\n\n    // 6. Gesti\u00f3 del Bot\u00f3 Enrere\n    override fun onBackPressed() {\n        if (drawerLayout.isDrawerOpen(GravityCompat.START)) {\n            // Si el Drawer est\u00e0 obert, el tanquem\n            drawerLayout.closeDrawer(GravityCompat.START)\n        } else {\n            // Si el Drawer est\u00e0 tancat, es permet la funci\u00f3 normal del bot\u00f3 Enrere\n            super.onBackPressed()\n        }\n    }\n}\n</code></pre></p>"},{"location":"Android/Interficies/drawermenu/#3-resum-de-punts-clau","title":"3. Resum de Punts Clau","text":"Component Funci\u00f3 Notes Clau DrawerLayout Contenidor arrel que permet l'acci\u00f3 de lliscament. Ha de tenir dos fills: el contingut principal i el panell lateral. NavigationView El panell lateral amb el men\u00fa d'elements. Utilitza android:layout_gravity=\"start\" i app:menu. ActionBarDrawerToggle Classe que gestiona la interacci\u00f3 amb la Toolbar. S'encarrega de mostrar la icona d'hamburguesa i obrir/tancar el Drawer al clicar. onNavigationItemSelected M\u00e8tode del NavigationView. OnNavigationItemSelectedListener. On s'implementa la l\u00f2gica de navegaci\u00f3 real (Fragments, Activities). S'ha de tancar el Drawer despr\u00e9s de l'acci\u00f3. onBackPressed() M\u00e8tode de l'Activity. Es sobreescriu per interceptar el bot\u00f3 Enrere i tancar el Drawer abans de sortir de l'Activity."},{"location":"Android/Interficies/layoutactivities/","title":"Layout general de les activities.","text":"<p>Refer\u00e8ncia:https://developer.android.com/design/ui/mobile/guides/foundations/system-bars</p> <p>Llegui tamb\u00e9: https://developer.android.com/develop/ui/views/layout/edge-to-edge</p> <p>En un layout modern (API 24+), tenim tres elements principals que afecten el layout: el StatusBar, el contingut (View) i el NavigationBar (o Gesture bar). </p> <p>Totes dues es coneixen amb el nom de System bars</p> <p>Tant el SystemBar com el Navigationbar formen part del sistema operatiu. Es poden amagar (full screen), fer transparents o fer opacs, per\u00f2 no eliminar.</p> Layout normal amb EdgetoEdge() <p>Quan creem una nova activity, per defecte, s'executa una funci\u00f3 </p> <pre><code>enableEdgeToEdge() \n</code></pre> <p>que f\u00e0 que el contingut es posi per sota els systembars.</p> <p>Per evitar que el nostre contingut (View) es confongui amb les System bars, s'apliquen uns paddings amb la funci\u00f3:</p> <pre><code>/ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) { v, insets -&gt;\n    val systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())\n    v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)\n    insets\n}\n</code></pre>"},{"location":"Android/Interficies/layouts/","title":"Layouts","text":"<p>Per Fer!</p> <p>Documentaci\u00f3 oficial: https://developer.android.com/develop/ui/views/layout/declaring-layout</p>"},{"location":"Android/Interficies/layouts/#linear-layout","title":"Linear Layout","text":"<p>Per fer !</p>"},{"location":"Android/Interficies/layouts/#contraint-layout","title":"Contraint Layout","text":"<p>Per fer !</p>"},{"location":"Android/Interficies/layouts/#chains","title":"Chains","text":"<p>Per fer !</p>"},{"location":"Android/Interficies/menus/","title":"Men\u00fas","text":"<p>Per Fer!</p> <p>Documentaci\u00f3 oficial https://developer.android.com/develop/ui/views/components/menus</p>"},{"location":"Android/Interficies/recyclersearchview/","title":"RecyclerView amb searchview","text":""},{"location":"Android/Interficies/recyclersearchview/#com-aplicar-filtres-de-busqueda-a-un-recyclervew","title":"Com aplicar filtres de b\u00fasqueda a un RecyclerVew","text":"<p>A trav\u00e9s dels \u00edtems del men\u00fa i del ActioViewClass, podem posar directament una barra de b\u00fasqueda (SearchView en un element del men\u00fa)</p>"},{"location":"Android/Interficies/recyclersearchview/#en-el-menu","title":"En el men\u00fa","text":"<p>Al fitxer, per exemple, res/menu/menu_cerca.xml, afegeix un element  utilitzant l'atribut app:actionViewClass amb la classe androidx.appcompat.widget.SearchView. <p><pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt;\n    &lt;item\n        android:id=\"@+id/action_cerca\"\n        android:title=\"Cerca\"\n        android:icon=\"@drawable/ic_search\"\n        app:showAsAction=\"ifRoom|collapseActionView\"\n        app:actionViewClass=\"androidx.appcompat.widget.SearchView\" /&gt;\n&lt;/menu&gt;\n</code></pre> - android:icon: Utilitza una icona de cerca (p. ex., @android:drawable/ic_menu_search o una de Material Design). - app:showAsAction=\"ifRoom|collapseActionView\": Indica que es mostri com a icona a la barra si hi ha espai (ifRoom) i que es col\u00b7lapsi a una icona quan no s'utilitza (collapseActionView). - app:actionViewClass: Estableix el widget SearchView que apareixer\u00e0.</p>"},{"location":"Android/Interficies/recyclersearchview/#en-lactivity-fragment","title":"En l'activity (fragment)","text":"<p>Recuperem la refer\u00e8ncia al Searchview</p> <pre><code>class MainActivity : AppCompatActivity() {\n    //...\n    override fun onCreateOptionsMenu(menu: Menu?): Boolean {\n            // 1. Infla el men\u00fa definit a l'XML\n            menuInflater.inflate(R.menu.menu_cerca, menu)\n\n            // 2. Troba l'element de men\u00fa de cerca\n            val searchItem: MenuItem? = menu?.findItem(R.id.action_cerca)\n\n            // 3. Obt\u00e9 la refer\u00e8ncia al SearchView\n            // Si ens demana la llibreria, busquem la appcompat\n            // (coincideix amb el xml)\n            val searchView = searchItem?.actionView as? SearchView\n            //...\n</code></pre>"},{"location":"Android/Interficies/recyclersearchview/#i-programem-la-logica","title":"I programem la l\u00f2gica:","text":"<p>Continuant en el onCreateOptionsMenu...</p> <pre><code>            // 4. Posa el text d'ajuda (hint)\n            searchView.queryHint = \"Introdueix el text a cercar...\"\n\n            //5. Necessitem un objecte que implementi OnQueryTextListener:\n            val listener = object : SearchView.OnQueryTextListener {\n                override fun onQueryTextSubmit(query: String?): Boolean {\n                    Log.d(\"MainActivity\", \"Query submitted: $query\")\n                    return true\n                }\n\n                override fun onQueryTextChange(newText: String?): Boolean {\n                    Log.d(\"MainActivity\", \"Query changed: $newText\")\n                    return true\n                }\n            }\n\n            //6. Assignem aquest objecte al listener.\n            searchView.setOnQueryTextListener(listener)\n</code></pre> <p>Perqu\u00e8 creem un object, i no simplement li passem una funci\u00f3 lambda, com la majoria de listener?</p> <p>La resposta \u00e9s perque el OnQueryTextListener no demana nom\u00e9s una funci\u00f3, sino dues, i per tant, cal especificar quina o quines funcions implementem.</p> <p>En el cas dels botons, per exemple, nom\u00e9s hi ha una funci\u00f3, i kotlin es capa\u00e7 de decidir, que, si una interficie nom\u00e9s t\u00e9 un m\u00e9tode, (i \u00e9s una interficie de java), es pot passar directament una lambda. </p> <p>Aix\u00f3 s'anomena SAM conversion. </p> <p>Si es vol fer en kotlin, cal crear una functional interface, i el codi seria equivalent al de java.</p>"},{"location":"Android/Interficies/recyclerview/","title":"RecyclerView amb llista en mem\u00f2ria (Kotlin)","text":"<p>Documentaci\u00f3 oficial: https://developer.android.com/develop/ui/views/layout/recyclerview</p> <p>Exemple: https://github.com/davidfs-itic/RecyclerView</p>"},{"location":"Android/Interficies/recyclerview/#1-que-es-un-recyclerview","title":"1. Qu\u00e8 \u00e9s un RecyclerView?","text":"<p>Un RecyclerView \u00e9s un component que permet mostrar llistes (o graelles) d\u2019elements reciclant les vistes per millorar el rendiment. Substitueix l\u2019antic ListView i ofereix m\u00e9s flexibilitat (layout managers, animacions, etc.).</p> <p>Per utilitzar un RecyclerView cal:</p> <ul> <li>Una llista de dades (en mem\u00f2ria, en aquest exemple).</li> <li>Un layout XML per a la pantalla que cont\u00e9 el RecyclerView.</li> <li>Un layout XML per a cada fila (\u00edtem) de la llista.</li> <li>Un Adapter amb un ViewHolder per \u201cpintar\u201d les dades a cada fila.</li> </ul>"},{"location":"Android/Interficies/recyclerview/#2-model-de-dades-data-class-i-llista","title":"2. Model de dades (data class i llista)","text":""},{"location":"Android/Interficies/recyclerview/#data-class","title":"Data Class","text":"<p>Creem una classe senzilla per representar cada element de la llista.</p> <pre><code>// Fitxer: MyItem.kt\ndata class MyItem(\n    val title: String,\n    val subtitle: String\n)\n</code></pre>"},{"location":"Android/Interficies/recyclerview/#llista-de-dades-en-un-object-kotlin","title":"Llista de dades en un object (Kotlin)","text":""},{"location":"Android/Interficies/recyclerview/#que-es-un-object-a-kotlin","title":"Qu\u00e8 \u00e9s un object a Kotlin?","text":"<p>En Kotlin, un object \u00e9s una construcci\u00f3 que crea una \u00fanica inst\u00e0ncia (patr\u00f3 Singleton) de manera autom\u00e0tica. S\u2019utilitza quan es vol un \u00fanic punt d\u2019acc\u00e9s compartit, per exemple una llista de dades comuna per a diferents pantalles.</p>"},{"location":"Android/Interficies/recyclerview/#caracteristiques-principals","title":"Caracter\u00edstiques principals:","text":"<ul> <li>No cal fer new ni cridar cap constructor; s\u2019accedeix pel nom (DataSource.items).</li> <li>Es crea la inst\u00e0ncia la primera vegada que es fa servir.</li> <li>\u00c9s \u00fatil per guardar dades en mem\u00f2ria mentre l\u2019app est\u00e0 en execuci\u00f3.</li> </ul> <p>Objecte que cont\u00e9 la llista: DataSource</p> <p><pre><code>// Fitxer: DataSource.kt\n\n/**\n * Objecte singleton que proporciona dades en mem\u00f2ria\n * per ser utilitzades al RecyclerView.\n */\nobject DataSource {\n\n    // Llista de dades en mem\u00f2ria\n    val items: MutableList&lt;MyItem&gt; = listOf(\n        MyItem(\"Element 1\", \"Subt\u00edtol 1\"),\n        MyItem(\"Element 2\", \"Subt\u00edtol 2\"),\n        MyItem(\"Element 3\", \"Subt\u00edtol 3\"),\n        MyItem(\"Element 4\", \"Subt\u00edtol 4\")\n    )\n}\n</code></pre> Qu\u00e8 f\u00e0 aquest codi?</p> <p><pre><code>object DataSource\n</code></pre> - Declara un objecte \u00fanic anomenat DataSource. - No s\u2019instancia amb DataSource(), sin\u00f3 que s\u2019utilitza directament pel nom.</p> <p><pre><code>val items: List&lt;MyItem&gt;\n</code></pre> - \u00c9s una propietat p\u00fablica que cont\u00e9 la llista en mem\u00f2ria. - El tipus \u00e9s List, per tant \u00e9s immutable (no es poden afegir/eliminar elements). - Es pot canviar a MutableList si es vol modificar la llista durant l\u2019execuci\u00f3. <p>L\u2019objecte DataSource actua com un \u201cmini repositori de dades\u201d senzill, sense base de dades ni API.</p> <p>(Per a veure com s'ha de crear un repositori de dades, veure l'apartat repositori a Arquitectura)</p>"},{"location":"Android/Interficies/recyclerview/#3-layout-de-cada-element-item_rowxml","title":"3. Layout de cada element (item_row.xml)","text":"<p>Aquest layout defineix com es veu una fila de la llista.</p> <pre><code>&lt;!-- Fitxer: res/layout/item_row.xml --&gt;\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:orientation=\"vertical\"\n    android:padding=\"16dp\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tvTitle\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"T\u00edtol\"\n        android:textStyle=\"bold\"\n        android:textSize=\"18sp\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tvSubtitle\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Subt\u00edtol\"\n        android:textSize=\"14sp\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre>"},{"location":"Android/Interficies/recyclerview/#4-layout-amb-el-recyclerview-activity_mainxml","title":"4. Layout amb el RecyclerView (activity_main.xml)","text":"<p>Aquest layout cont\u00e9 el RecyclerView que ocupar\u00e0 tota la pantalla.</p> <pre><code>&lt;!-- Fitxer: res/layout/activity_main.xml --&gt;\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout \n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"&gt;\n\n    &lt;androidx.recyclerview.widget.RecyclerView\n        android:id=\"@+id/recyclerView\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre>"},{"location":"Android/Interficies/recyclerview/#5-adapter-i-viewholder-myadapterkt","title":"5. Adapter i ViewHolder (MyAdapter.kt)","text":"<p>En un RecyclerView aquestes classes sempre treballen juntes:</p>"},{"location":"Android/Interficies/recyclerview/#el-adapter-sap","title":"El Adapter sap:","text":"<ul> <li>Quantes files hi ha.</li> <li>Quin layout s\u2019utilitza per a cada fila.</li> <li>Quines dades s\u2019han de mostrar a cada posici\u00f3.</li> </ul>"},{"location":"Android/Interficies/recyclerview/#el-viewholder-sap","title":"El ViewHolder sap:","text":"<ul> <li>Quines vistes (TextView, ImageView, etc.) t\u00e9 una fila.</li> <li>On escriure les dades quan l\u2019Adapter li digui \u201cpinta l\u2019element X\u201d.</li> </ul> <p>Sense Adapter i ViewHolder, el RecyclerView no sap ni quantes files mostrar, ni com dibuixar-les.</p>"},{"location":"Android/Interficies/recyclerview/#exemple-codi-holder","title":"Exemple codi Holder","text":"<pre><code>// MyViewHolder.kt\nimport android.view.View\nimport android.widget.TextView\nimport androidx.recyclerview.widget.RecyclerView\n\n/**\n * ViewHolder responsable d'una fila del RecyclerView.\n * Encapsula la vista de la fila i sap com \"pintar-hi\" un MyItem.\n */\nclass MyViewHolder(\n    itemView: View,\n    private val onItemClick: (MyItem) -&gt; Unit\n) : RecyclerView.ViewHolder(itemView) {\n\n    private val tvTitle: TextView = itemView.findViewById(R.id.tvTitle)\n    private val tvSubtitle: TextView = itemView.findViewById(R.id.tvSubtitle)\n\n    /**\n     * Actualitza les vistes de la fila amb les dades de MyItem\n     * i configura els listeners d'esdeveniments.\n     */\n    fun bind(item: MyItem) {\n        tvTitle.text = item.title\n        tvSubtitle.text = item.subtitle\n\n        // Exemple de gesti\u00f3 de clic sobre tota la fila\n        itemView.setOnClickListener {\n            onItemClick(item)\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/recyclerview/#explicacio","title":"Explicaci\u00f3:","text":"<p>Classe</p> <p><pre><code>class MyViewHolder(... ) : RecyclerView.ViewHolder(itemView)\n</code></pre> Hereta de RecyclerView.ViewHolder i rep la vista de la fila (itemView) i una funci\u00f3 de clic (onItemClick).\u200b</p> <p>Propietats privades (tvTitle, tvSubtitle):</p> <p>El ViewHolder busca una sola vega*da les vistes del layout item_row.xml i s\u2019hi queda la refer\u00e8ncia.</p> <p>M\u00e8tode bind(item: MyItem):</p> <p>\u00c9s el punt \u00fanic per:  - Escriure dades a les vistes.  - Configurar listeners espec\u00edfics d\u2019aquesta fila (clic, long\u2011click\u2026).</p> <p>Aix\u00f2 treu responsabilitat de \u201cpintar dades\u201d de l\u2019Adapter i la concentra al ViewHolder.</p>"},{"location":"Android/Interficies/recyclerview/#exemple-codi-adapter","title":"Exemple codi Adapter","text":"<pre><code>// MyAdapter.kt\nimport android.view.LayoutInflater\nimport android.view.ViewGroup\nimport androidx.recyclerview.widget.RecyclerView\n\n/**\n * Adapter que crea ViewHolder (MyViewHolder),\n * indica quants elements hi ha i demana que es \"pintin\" amb bind().\n */\nclass MyAdapter(\n    private val items: List&lt;MyItem&gt;,\n    private val onItemClick: (MyItem) -&gt; Unit\n) : RecyclerView.Adapter&lt;MyViewHolder&gt;() {\n\n    /**\n     * Crea (infla) la vista de la fila i construeix el ViewHolder.\n     */\n    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {\n        val inflater = LayoutInflater.from(parent.context)\n        val view = inflater.inflate(R.layout.item_row, parent, false)\n        return MyViewHolder(view, onItemClick)\n    }\n\n    /**\n     * Retorna quants elements hi ha a la llista de dades.\n     */\n    override fun getItemCount(): Int = items.size\n\n    /**\n     * Demana al ViewHolder que mostri les dades de la posici\u00f3 donada.\n     */\n    override fun onBindViewHolder(holder: MyViewHolder, position: Int) {\n        val item = items[position]\n        holder.bind(item)\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/recyclerview/#explicacio_1","title":"Explicaci\u00f3:","text":"<p>L\u2019Adapter ja no sap com s\u2019actualitzen exactament les vistes; delega aquesta feina a holder.bind(item).</p> <p>Responsabilitats clares de cada m\u00e8tode (tal com recomana la documentaci\u00f3 oficial):\u200b</p> <ul> <li>onCreateViewHolder: infla el layout i crea el ViewHolder.</li> <li>getItemCount: diu al RecyclerView quantes files han de existir.</li> <li>onBindViewHolder: passa el model (MyItem) al ViewHolder perqu\u00e8 l\u2019actualitzi.</li> </ul>"},{"location":"Android/Interficies/recyclerview/#6-activity","title":"6. Activity","text":"<p>Exemple de codi en l'activity.  Els comentaris expliquen els passos que s'han de seguir.</p> <pre><code>// MainActivity.kt\nimport android.os.Bundle\nimport android.widget.Toast\nimport androidx.appcompat.app.AppCompatActivity\nimport androidx.recyclerview.widget.LinearLayoutManager\nimport androidx.recyclerview.widget.RecyclerView\n\nclass MainActivity : AppCompatActivity() {\n\n    private lateinit var recyclerView: RecyclerView\n    private lateinit var adapter: MyAdapter\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // 1. Obtenir refer\u00e8ncia al RecyclerView del layout\n        recyclerView = findViewById(R.id.recyclerView)\n\n        // 2. Configurar LayoutManager (com es col\u00b7loquen les files)\n        recyclerView.layoutManager = LinearLayoutManager(this)\n\n        // 3. Crear llista de dades (des de DataSource o directament)\n        val items = DataSource.items\n\n        // 4. Crear l'Adapter passant les dades + funci\u00f3 de callback per clics\n        adapter = MyAdapter(\n            items = items,\n            onItemClick = { item -&gt;\n                // AQU\u00cd gestionem el clic: mostrem un Toast amb el t\u00edtol\n                Toast.makeText(\n                    this,\n                    \"Has clicat: ${item.title}\",\n                    Toast.LENGTH_SHORT\n                ).show()\n            }\n        )\n\n        // 5. Assignar l'Adapter al RecyclerView\n        recyclerView.adapter = adapter\n    }\n}\n</code></pre> <p>Tot i que s'utilitza una funci\u00f3 (anomenada callback) per passar la l\u00f2gica de gesti\u00f3 del click en un \u00edtem (recodem que aix\u00f3 ho gestiona el ViewHolder), no \u00e9s una pr\u00e0ctica recomenada. Est\u00e0 aqu\u00ed per simplicitat.</p> <p>Veieu \"Exemple inversi\u00f3 de depend\u00e8ncies amb RecyclerView\" a l'apartat Arquitectura</p>"},{"location":"Android/Interficies/recyclerview/#7-resum","title":"7. Resum","text":""},{"location":"Android/Interficies/recyclerview/#idea-clau","title":"Idea clau:","text":"<p>En un RecyclerView, el ViewHolder encapsula la vista d\u2019una fila, en guarda les refer\u00e8ncies a les seves sub\u2011vistes i pot contenir la l\u00f2gica espec\u00edfica d\u2019aquesta fila (com ara actualitzar les dades o gestionar clics), mentre que l\u2019Adapter crea aquests ViewHolder, els recicla i els alimenta amb les dades correctes de la llista.</p> <ul> <li>onCreateViewHolder crea la vista i el ViewHolder.</li> <li>onBindViewHolder omple aquesta vista amb les dades de la posici\u00f3 concreta.</li> </ul>"},{"location":"Android/Interficies/recyclerview/#frase-resum-que-podeu-recordar","title":"Frase \u201cresum\u201d que podeu recordar:","text":"<p>L\u2019Adapter:</p> <ul> <li>Crea ViewHolder nous (onCreateViewHolder).</li> <li>Diu quantes files hi ha (getItemCount).</li> <li>Omple les vistes del ViewHolder amb dades (onBindViewHolder).</li> </ul> <p>El ViewHolder  - Guarda refer\u00e8ncies a les vistes de la fila (TextView, ImageView, etc.). - Encapsula la l\u00f2gica de \u201cbind\u201d: t\u00e9 una funci\u00f3 bind(item: MyItem) que rep el model i actualitza totes les vistes. - Gestiona esdeveniments de la fila: per exemple, configurar setOnClickListener sobre itemView o sobre algun bot\u00f3 concret, i notifica l\u2019Adapter o un listener extern.</p>"},{"location":"Android/Interficies/recyclerviewaddelete/","title":"Afegir i eliminar \u00edtems al RecyclerView","text":""},{"location":"Android/Interficies/recyclerviewaddelete/#1-afegir-un-item","title":"1. Afegir un \u00edtem","text":"<p>Per afegir un element nou a la llista i que es mostri al RecyclerView:</p> <pre><code>// A l'Activity o Fragment\n\n// 1. Crear el nou element\nval nouItem = MyItem(\"Nou element\", \"Subt\u00edtol nou\")\n\n// 2. Afegir-lo a la llista de dades\nDataSource.items.add(nouItem)\n\n// 3. Notificar l'adapter que s'ha inserit un element\nadapter.notifyItemInserted(DataSource.items.size - 1)\n</code></pre>"},{"location":"Android/Interficies/recyclerviewaddelete/#explicacio","title":"Explicaci\u00f3","text":"<ul> <li><code>DataSource.items.add(nouItem)</code> \u2192 afegeix l'element al final de la llista.</li> <li><code>notifyItemInserted(posici\u00f3)</code> \u2192 indica al RecyclerView que s'ha afegit un element a la posici\u00f3 indicada. Aix\u00f2 permet que el RecyclerView faci l'animaci\u00f3 d'inserci\u00f3.</li> </ul>"},{"location":"Android/Interficies/recyclerviewaddelete/#afegir-en-una-posicio-concreta","title":"Afegir en una posici\u00f3 concreta","text":"<pre><code>val nouItem = MyItem(\"Element inserit\", \"A la posici\u00f3 2\")\n\n// Inserir a la posici\u00f3 2 (\u00edndex comen\u00e7a a 0)\nDataSource.items.add(2, nouItem)\nadapter.notifyItemInserted(2)\n</code></pre>"},{"location":"Android/Interficies/recyclerviewaddelete/#2-eliminar-un-item","title":"2. Eliminar un \u00edtem","text":"<p>Per eliminar un element de la llista:</p> <pre><code>// A l'Activity o Fragment\n\n// Suposem que volem eliminar l'element a la posici\u00f3 'position'\nval position = 1  // per exemple, el segon element\n\n// 1. Eliminar de la llista de dades\nDataSource.items.removeAt(position)\n\n// 2. Notificar l'adapter que s'ha eliminat un element\nadapter.notifyItemRemoved(position)\n</code></pre>"},{"location":"Android/Interficies/recyclerviewaddelete/#eliminar-per-objecte","title":"Eliminar per objecte","text":"<p>Si tenim la refer\u00e8ncia a l'objecte que volem eliminar:</p> <pre><code>val itemAEliminar = DataSource.items[position]\n\n// Trobar la posici\u00f3 de l'element\nval index = DataSource.items.indexOf(itemAEliminar)\n\nif (index != -1) {\n    DataSource.items.removeAt(index)\n    adapter.notifyItemRemoved(index)\n}\n</code></pre>"},{"location":"Android/Interficies/recyclerviewaddelete/#3-exemple-complet-a-lactivity","title":"3. Exemple complet a l'Activity","text":"<p>Exemple d'una Activity amb dos botons: un per afegir i un per eliminar l'\u00faltim element.</p>"},{"location":"Android/Interficies/recyclerviewaddelete/#layout-activity_mainxml","title":"Layout (activity_main.xml)","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"horizontal\"\n        android:padding=\"8dp\"&gt;\n\n        &lt;Button\n            android:id=\"@+id/btnAfegir\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"1\"\n            android:text=\"Afegir\" /&gt;\n\n        &lt;Button\n            android:id=\"@+id/btnEliminar\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"1\"\n            android:text=\"Eliminar \u00faltim\" /&gt;\n\n    &lt;/LinearLayout&gt;\n\n    &lt;androidx.recyclerview.widget.RecyclerView\n        android:id=\"@+id/recyclerView\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"0dp\"\n        android:layout_weight=\"1\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre>"},{"location":"Android/Interficies/recyclerviewaddelete/#activity-mainactivitykt","title":"Activity (MainActivity.kt)","text":"<pre><code>// MainActivity.kt\nimport android.os.Bundle\nimport android.widget.Button\nimport android.widget.Toast\nimport androidx.appcompat.app.AppCompatActivity\nimport androidx.recyclerview.widget.LinearLayoutManager\nimport androidx.recyclerview.widget.RecyclerView\n\nclass MainActivity : AppCompatActivity() {\n\n    private lateinit var recyclerView: RecyclerView\n    private lateinit var adapter: MyAdapter\n\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        //....\n\n        // Bot\u00f3 per afegir\n        findViewById&lt;Button&gt;(R.id.btnAfegir).setOnClickListener {\n            afegirItem()\n        }\n\n        // Bot\u00f3 per eliminar\n        findViewById&lt;Button&gt;(R.id.btnEliminar).setOnClickListener {\n            eliminarUltimItem()\n        }\n    }\n\n    private fun afegirItem() {\n        val nouItem = MyItem(\"Element Nou\", \"Subt\u00edtol Nou\")\n\n        DataSource.items.add(nouItem)\n        adapter.notifyItemInserted(DataSource.items.size - 1)\n\n        // Fer scroll fins al nou element\n        recyclerView.scrollToPosition(DataSource.items.size - 1)\n    }\n\n    private fun eliminarUltimItem() {\n        if (DataSource.items.isNotEmpty()) {\n            val ultimaPosicio = DataSource.items.size - 1\n            DataSource.items.removeAt(ultimaPosicio)\n            adapter.notifyItemRemoved(ultimaPosicio)\n        } else {\n            Toast.makeText(this, \"La llista \u00e9s buida\", Toast.LENGTH_SHORT).show()\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/recyclerviewaddelete/#5-metodes-de-notificacio-de-ladapter","title":"5. M\u00e8todes de notificaci\u00f3 de l'Adapter","text":"<p>El <code>RecyclerView.Adapter</code> proporciona diversos m\u00e8todes per notificar canvis:</p> M\u00e8tode \u00das <code>notifyItemInserted(position)</code> S'ha afegit un element a la posici\u00f3 <code>notifyItemRemoved(position)</code> S'ha eliminat l'element de la posici\u00f3 <code>notifyItemChanged(position)</code> L'element a la posici\u00f3 s'ha modificat <code>notifyDataSetChanged()</code> Tota la llista ha canviat (menys eficient) <p>Recomanaci\u00f3: Utilitzeu els m\u00e8todes espec\u00edfics (<code>notifyItemInserted</code>, <code>notifyItemRemoved</code>) en lloc de <code>notifyDataSetChanged()</code>, ja que permeten animacions i s\u00f3n m\u00e9s eficients.</p>"},{"location":"Android/Interficies/recyclerviewaddelete/#6-resum","title":"6. Resum","text":"<ol> <li>Despr\u00e9s de modificar la llista, sempre notificar l'adapter.</li> <li>Utilitzar el m\u00e8tode de notificaci\u00f3 adequat per obtenir animacions.</li> <li>Adaptar el codi en cas que s'estigui utlitzant ViewModel. </li> </ol>"},{"location":"Android/Interficies/recyclerviewfilter/","title":"Recyclerview filtrat","text":""},{"location":"Android/Interficies/recyclerviewfilter/#com-aplicar-filtres-de-categoria-a-un-recyclervew","title":"Com aplicar filtres de categoria a un RecyclerVew","text":""},{"location":"Android/Interficies/recyclerviewfilter/#1-cal-fer-una-funcio-per-actualitzar-el-recyclerview","title":"1. Cal fer una funci\u00f3 per actualitzar el Recyclerview","text":"<p>```kotlin linenum=\"1\" class MyAdapter(     private val items: List,     private val onItemClick: (MyItem) -&gt; Unit ) : RecyclerView.Adapter() { <pre><code>override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {\n    val inflater = LayoutInflater.from(parent.context)\n    val view = inflater.inflate(R.layout.item_row, parent, false)\n    return MyViewHolder(view, onItemClick)\n}\n\noverride fun getItemCount(): Int = items.size\n\noverride fun onBindViewHolder(holder: MyViewHolder, position: Int) {\n    val item = items[position]\n    holder.bind(item)\n}\n\nfun updateList(newList: List&lt;MyItem&gt;) {\n    items = newList\n    notifyDataSetChanged()\n}\n</code></pre> <p>} ``` </p>"},{"location":"Android/Interficies/recyclerviewfilter/#2-des-de-la-activity","title":"2. Des de la Activity:","text":""},{"location":"Android/Interficies/recyclerviewfilter/#fem-un-menu-per-buscar-per-exemple-un-popup-per-categories","title":"Fem un men\u00fa per buscar (per exemple un PopUp per categories)","text":"<p><code>kotlin &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;     &lt;item         android:id=\"@+id/cat_totes\"         android:title=\"Totes les Categories\" /&gt;     &lt;item         android:id=\"@+id/cat_peliculas\"         android:title=\"Pel\u00b7l\u00edcules\" /&gt;     &lt;item         android:id=\"@+id/cat_llibres\"         android:title=\"Llibres\" /&gt;     &lt;item         android:id=\"@+id/cat_musica\"         android:title=\"M\u00fasica\" /&gt; &lt;/menu&gt;</code></p>"},{"location":"Android/Interficies/recyclerviewfilter/#creem-el-menu-a-partir-del-xml","title":"Creem el men\u00fa a partir del xml","text":"<p>En l'event on onCreateOptionsMenu.</p> <pre><code>override fun onCreateOptionsMenu(menu: Menu?): Boolean {\n\n        menuInflater.inflate(R.menu.menu_cerca, menu)\n\n       return true // Retorna 'true' per indicar que el men\u00fa s'ha mostrat\n    }\n</code></pre>"},{"location":"Android/Interficies/recyclerviewfilter/#sobrescrivim-el-onoptionsitemselected","title":"Sobrescrivim el onOptionsItemSelected","text":"<p>Per capturar quan l'usuari seleccioni el item del men\u00fa</p> <pre><code>override fun onOptionsItemSelected(item: MenuItem): Boolean {\n    return when (item.itemId) {\n        R.id.action_category_button -&gt; {\n            // 1. Mostrar el PopupMenu\n            showCategoryPopupMenu(findViewById(R.id.action_category_button))\n            true\n        }\n        else -&gt; super.onOptionsItemSelected(item)\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/recyclerviewfilter/#creem-el-popupmenu","title":"Creem el PopUpMen\u00fa:","text":"<p>```kotlin private fun showCategoryPopupMenu(view: View) {</p> <pre><code>    // Inicialitza el PopupMenu amb el context de l'Activitat i el view del men\u00fa\n    val popup = PopupMenu(this, view)\n\n    // Infla el men\u00fa definit a popup_categories.xml\n    popup.menuInflater.inflate(R.menu.popup_categories, popup.menu)\n\n    // Defineix el Listener per gestionar les seleccions\n    popup.setOnMenuItemClickListener { menuItem -&gt;\n        when (menuItem.itemId) {\n            R.id.cat_totes -&gt; {\n                applyCategoryFilter(\"Totes\")\n                true\n            }\n            R.id.cat_peliculas -&gt; {\n                applyCategoryFilter(\"Pel\u00b7l\u00edcules\")\n                true\n            }\n            R.id.cat_llibres -&gt; {\n                applyCategoryFilter(\"Llibres\")\n                true\n            }\n            R.id.cat_musica -&gt; {\n                applyCategoryFilter(\"M\u00fasica\")\n                true\n            }\n            else -&gt; false\n        }\n    }\n\n    // Mostrar el men\u00fa\n    popup.show()\n}\n\nprivate fun applyCategoryFilter(category: String) {\n    Toast.makeText(this, \"Filtrat per: $category\", Toast.LENGTH_SHORT).show()\n    // Aqu\u00ed s'aplica la l\u00f2gica de filtratge a la RecyclerView o Llista.\n}\n```\n</code></pre>"},{"location":"Android/Interficies/splashscreen/","title":"Realitzar una splash screen","text":"<p>Android proporciona una API de Splash Screen que facilita la implementaci\u00f3 i assegura que la pantalla de presentaci\u00f3 es mostri correctament a partir d'Android 12, tot i que funciona amb una biblioteca de retrocompatibilitat per a versions anteriors.</p>"},{"location":"Android/Interficies/splashscreen/#1-dependencies","title":"1. Depend\u00e8ncies:","text":"<p>Afegir la Depend\u00e8ncia: Afegir la biblioteca androidx.core:core-splashscreen al teu fitxer build.gradle (m\u00f2dul: app).</p> <pre><code>dependencies {\n    ...\n    implementation 'androidx.core:core-splashscreen:1.2.0' \n    ...\n</code></pre> <p>Android studio suggerir\u00e0 la versi\u00f3 i si utilitzem el format libs.versions.toml suggerir\u00e0 fer el canvi.</p>"},{"location":"Android/Interficies/splashscreen/#2-tema","title":"2. Tema","text":"<p>Definir el Tema del Splash Screen (en themes.xml): Crear un estil que hereti de Theme.SplashScreen i especificar l'icona animada i el tema de la seg\u00fcent activitat.</p> <pre><code>&lt;style name=\"Theme.App.SplashScreen\" parent=\"Theme.SplashScreen\"&gt;\n&lt;item name=\"windowSplashScreenBackground\"&gt;@color/dark_grey&lt;/item&gt;\n    &lt;item name=\"windowSplashScreenAnimatedIcon\"&gt;@drawable/logo_animat&lt;/item&gt;\n    &lt;item name=\"postSplashScreenTheme\"&gt;@style/Base.Theme.LaMeuaApp&lt;/item&gt;\n    &lt;item name=\"windowSplashScreenAnimationDuration\"&gt;1000&lt;/item&gt;\n&lt;/style&gt;\n</code></pre> <p>Per tenir una icona animada (windowSplashScreenAnimatedIcon), pots utilitzar un Animated Vector Drawable (AVD), que \u00e9s un XML que defineix com un Vector Drawable canvia al llarg del temps.</p>"},{"location":"Android/Interficies/splashscreen/#3-manifest","title":"3. Manifest","text":"<p>Configurar el Manifest: Establir l'estil creat com el tema de la teva MainActivity (o l'activitat inicial) a AndroidManifest.xml.</p> <pre><code>&lt;activity\n    android:name=\".MainActivity\"\n    android:theme=\"@style/Theme.App.SplashScreen\"\n    ...&gt;\n    &lt;/activity&gt;\n</code></pre>"},{"location":"Android/Interficies/splashscreen/#4-controlar-la-durada-en-mainactivitykt","title":"4. Controlar la Durada (en MainActivity.kt):","text":"<p>A la teva activitat principal, has de cridar installSplashScreen() i pots utilitzar setKeepOnScreenCondition per mantenir la pantalla de presentaci\u00f3 visible fins que l'animaci\u00f3 hagi acabat o les dades s'hagin carregat.</p> <pre><code>class MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        // Cridar abans de super.onCreate() i setContentView()\n        val splashScreen = installSplashScreen()\n\n        // Opcional: Per mantenir-lo a la pantalla durant m\u00e9s temps (p. ex. carregar dades)\n        splashScreen.setKeepOnScreenCondition { \n            // Retorna 'true' per mantenir el splash screen, 'false' per amagar-lo\n            // Aqu\u00ed hi aniria la teva l\u00f2gica de c\u00e0rrega\n            false \n        }\n\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        // ...\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/temes/","title":"Temes","text":"<p>Per Fer!</p> <p>Documentaci\u00f3  https://developer.android.com/develop/ui/views/theming/themes</p> <p>Codelab: https://developer.android.com/codelabs/basic-android-kotlin-training-change-app-theme?hl=es-419#0</p>"},{"location":"Android/Interficies/toolbar/","title":"Toolbar","text":""},{"location":"Android/Interficies/toolbar/#1-la-toolbar-com-a-appbar-fonaments","title":"1. La Toolbar com a AppBar (Fonaments)","text":""},{"location":"Android/Interficies/toolbar/#concepte-i-funcio","title":"Concepte i Funci\u00f3","text":"<p>L'AppBar (Barra d'Aplicacions) \u00e9s el component estructural m\u00e9s important a la part superior de qualsevol pantalla Android. </p> <p>El seu prop\u00f2sit \u00e9s: - Identitat: Mostrar el t\u00edtol de l'aplicaci\u00f3 o la pantalla actual. - Navegaci\u00f3: Allotjar el bot\u00f3 \"Up\" (fletxa enrere) o la icona del Navigation Drawer. - Accions: Contenir les accions m\u00e9s importants de la pantalla (men\u00fas).</p> <p>La Toolbar (proporcionada per la biblioteca AndroidX Material Components) \u00e9s la implementaci\u00f3 moderna i flexible de l'AppBar. A difer\u00e8ncia de l'antiga ActionBar nativa, la Toolbar pot ser personalitzada amb facilitat.</p> <p>La utilitzarem quan volguem personalitzar la appbar que apareix per defecte amb els temes.</p>"},{"location":"Android/Interficies/toolbar/#implementacio-basica","title":"Implementaci\u00f3 B\u00e0sica","text":"<p>Per utilitzar una Toolbar, primer s'ha d'afegir al fitxer XML del layout de l'Activity. Exemple: XML del Layout (activity_main.xml) <pre><code>&lt;LinearLayout \n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"&gt;\n\n    &lt;androidx.appcompat.widget.Toolbar\n        android:id=\"@+id/my_toolbar\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"?attr/actionBarSize\"\n        android:background=\"?attr/colorPrimary\"\n        android:theme=\"@style/ThemeOverlay.AppCompat.Dark.ActionBar\" /&gt; \n\n    &lt;TextView \n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"El contingut de l'Activity va aqu\u00ed\"\n        android:padding=\"16dp\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre> Despr\u00e9s, s'ha de configurar aquesta Toolbar com l'Action Bar de l'Activity en el codi Kotlin/Java, despr\u00e9s d'ocultar la barra nativa al tema de l'aplicaci\u00f3 (normalment, s'usa un tema NoActionBar), amb la funci\u00f3 setSupportActionBar</p> <p>Exemple: Configuraci\u00f3 a l'Activity (Kotlin) <pre><code>import androidx.appcompat.app.AppCompatActivity\n\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val toolbar = findViewById&lt;Toolbar&gt;(R.id.my_toolbar)\n        // 1. Configura la Toolbar com l'Action Bar del sistema\n        setSupportActionBar(toolbar) \n\n        // Opcional: Estableix un t\u00edtol\n        supportActionBar?.title = \"La Meva App\" \n    }\n}\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#2-afegir-menus-a-la-toolbar","title":"2. Afegir Men\u00fas a la Toolbar","text":""},{"location":"Android/Interficies/toolbar/#definicio-del-menu","title":"Definici\u00f3 del Men\u00fa","text":"<p>Els \u00edtems del men\u00fa es defineixen en un fitxer XML separat a res/menu/.</p> <p>Exemple: Recurs de Men\u00fa (res/menu/main_menu.xml) <pre><code>&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt;\n\n    &lt;item\n        android:id=\"@+id/action_cercar\"\n        android:icon=\"@drawable/ic_search\" \n        android:title=\"Cercar\"\n        app:showAsAction=\"ifRoom\" /&gt;\n\n    &lt;item\n        android:id=\"@+id/action_configuracio\"\n        android:title=\"Configuraci\u00f3\"\n        app:showAsAction=\"never\" /&gt;\n\n&lt;/menu&gt;\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#inflacio","title":"Inflaci\u00f3","text":"<p>El proc\u00e9s d'inflar (carregar) el men\u00fa XML a la Toolbar es fa sobreescrivint el m\u00e8tode onCreateOptionsMenu() de l'Activity. Exemple: Inflaci\u00f3 del Men\u00fa (Kotlin) <pre><code>class MainActivity : AppCompatActivity() {\n    // ... onCreate ...\n\n    override fun onCreateOptionsMenu(menu: Menu?): Boolean {\n        // 1. Carrega el recurs de men\u00fa a l'Activity\n        menuInflater.inflate(R.menu.main_menu, menu)\n        return true // Retorna true per mostrar el men\u00fa\n    }\n    // ...\n}\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#gestio-de-clics-i-prioritat","title":"Gesti\u00f3 de Clics i Prioritat","text":"<p>Per respondre a les interaccions de l'usuari amb els \u00edtems del men\u00fa, s'ha de sobreescriure el m\u00e8tode onOptionsItemSelected(). Exemple 2.3: Gesti\u00f3 de Clics (Kotlin) <pre><code>    // ...\n    override fun onOptionsItemSelected(item: MenuItem): Boolean {\n        return when (item.itemId) {\n            R.id.action_cercar -&gt; {\n                // L\u00f2gica per a l'acci\u00f3 de cercar\n                Toast.makeText(this, \"S'ha premut Cerca\", Toast.LENGTH_SHORT).show()\n                true\n            }\n            R.id.action_configuracio -&gt; {\n                // L\u00f2gica per anar a Configuraci\u00f3\n                Toast.makeText(this, \"Obrint Configuraci\u00f3...\", Toast.LENGTH_SHORT).show()\n                true\n            }\n            else -&gt; super.onOptionsItemSelected(item)\n        }\n    }\n}\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#3-gestio-de-la-navegacio-a-lappbar","title":"3. Gesti\u00f3 de la Navegaci\u00f3 a l'AppBar","text":""},{"location":"Android/Interficies/toolbar/#el-boto-up","title":"El Bot\u00f3 \"Up\"","text":"<p>El bot\u00f3 \"Up\" (representat t\u00edpicament per una fletxa cap a l'esquerra: $\\leftarrow$) \u00e9s una convenci\u00f3 de disseny que permet a l'usuari navegar cap amunt en la jerarquia l\u00f2gica de l'aplicaci\u00f3, fins a la pantalla pare. </p> <p>\u00c9s diferent del bot\u00f3 \"Enrere\" del sistema, que navega pel registre hist\u00f2ric (back stack).</p>"},{"location":"Android/Interficies/toolbar/#integracio-de-la-navegacio","title":"Integraci\u00f3 de la Navegaci\u00f3","text":"<p>Quan s'utilitza la Toolbar com a Action Bar, el sistema pot gestionar autom\u00e0ticament el comportament del bot\u00f3 \"Up\" basant-se en la definici\u00f3 de l'Activity al fitxer AndroidManifest.xml (especificant l'Activity pare amb android:parentActivityName).</p> <p>Si no s'utilitza la Navigation Library, es pot habilitar el bot\u00f3 manualment i gestionar el seu clic:</p> <p>Exemple: Habilitaci\u00f3 del Bot\u00f3 \"Up\" (Kotlin) <pre><code>class DetailActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        // ...\n\n        // Habilita el bot\u00f3 \"Up\" a la Toolbar\n        supportActionBar?.setDisplayHomeAsUpEnabled(true) \n    }\n\n    // Gesti\u00f3 manual del clic al bot\u00f3 \"Up\"\n    override fun onOptionsItemSelected(item: MenuItem): Boolean {\n        return when (item.itemId) {\n            android.R.id.home -&gt; {\n                // El m\u00e8tode navigateUpFromSameTask() de l'Activity Manager \n                // compleix la funci\u00f3 del bot\u00f3 \"Up\"\n                NavUtils.navigateUpFromSameTask(this) \n                true\n            }\n            else -&gt; super.onOptionsItemSelected(item)\n        }\n    }\n}\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#4-actualitzacio-dinamica-dels-menus","title":"4. Actualitzaci\u00f3 Din\u00e0mica dels Men\u00fas","text":"<p>De vegades, l'estat d'un \u00edtem de men\u00fa (p. ex., canviar una icona de \"No Favorit\" a \"Favorit\") ha de canviar mentre l'Activity est\u00e0 oberta.</p>"},{"location":"Android/Interficies/toolbar/#invalidacio-del-menu","title":"Invalidaci\u00f3 del Men\u00fa","text":"<p>Per for\u00e7ar que el sistema torni a cridar a onCreateOptionsMenu() i recre\u00ef completament el men\u00fa, s'utilitza invalidateOptionsMenu(). </p> <p>Aix\u00f2 \u00e9s \u00fatil si la visibilitat o el t\u00edtol d'alguns \u00edtems dep\u00e8n d'un estat global que acaba de canviar. Exemple: For\u00e7ar la Recreaci\u00f3 del Men\u00fa (Kotlin) <pre><code>// Despr\u00e9s d'un canvi d'estat a la nostra Activity...\nfun onDataUpdated() {\n    // ... \n    // Crida a invalidateOptionsMenu() per recrear el men\u00fa amb les noves dades\n    invalidateOptionsMenu() \n}\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#preparacio-del-menu","title":"Preparaci\u00f3 del Men\u00fa","text":"<p>El m\u00e8tode onPrepareOptionsMenu() es crida just abans que es mostri el men\u00fa. Aquest \u00e9s el lloc ideal per canviar la visibilitat o l'aparen\u00e7a dels \u00edtems de men\u00fa existents sense recrear tota l'estructura.</p> <p>Exemple: Preparaci\u00f3 Din\u00e0mica (Kotlin) <pre><code>// Variable d'estat a l'Activity\nprivate var isUserLoggedIn = false\n\noverride fun onPrepareOptionsMenu(menu: Menu?): Boolean {\n    val loginItem = menu?.findItem(R.id.action_login)\n    val logoutItem = menu?.findItem(R.id.action_logout)\n\n    // Mostra l'opci\u00f3 de login si l'usuari no est\u00e0 connectat, i viceversa\n    loginItem?.isVisible = !isUserLoggedIn\n    logoutItem?.isVisible = isUserLoggedIn\n\n    return super.onPrepareOptionsMenu(menu)\n}\n</code></pre></p>"},{"location":"Android/Interficies/toolbar/#5-action-views","title":"5. Action Views","text":"<p>Vegeu documentaci\u00f3 per a detalls: https://developer.android.com/develop/ui/views/components/appbar/action-views</p>"},{"location":"Android/Interficies/toolbar/#action-views","title":"Action Views","text":"<p>Un Action View \u00e9s un widget personalitzat (per exemple, un EditText, un SearchView, o un ProgressBar) que s'associa a un \u00edtem de men\u00fa. En lloc de mostrar la icona i el text habituals, l'\u00edtem de men\u00fa mostra el widget de l'Action View directament a la Toolbar. Caracter\u00edstiques: - Widget Incrustat: El SearchView \u00e9s l'exemple m\u00e9s com\u00fa. Quan l'usuari el selecciona, el widget s'expandeix a la barra d'aplicacions, permetent interaccions complexes (escriure, enviar) sense canviar d'Activity o mostrar un di\u00e0leg.</p> <ul> <li> <p>Implementaci\u00f3: Es defineix mitjan\u00e7ant l'atribut app:actionViewClass o android:actionLayout a l'XML del men\u00fa. Tamb\u00e9 es pot inflar manualment en el m\u00e8tode onCreateOptionsMenu().</p> </li> <li> <p>Gesti\u00f3 de Col\u00b7lapse: Quan l'Action View s'expandeix, altres accions de la Toolbar es poden col\u00b7lapsar (amagar). Pots implementar la interf\u00edcie MenuItem.OnActionExpandListener per gestionar esdeveniments quan l'acci\u00f3 s'expandeix o es col\u00b7lapsa.</p> </li> </ul> Searchview sense focus Searchview amb focus"},{"location":"Android/Interficies/toolbar/#resum-de-les-funcion","title":"Resum de les funcion:","text":"<ul> <li>onCreateOptionsMenu(): Inflar el men\u00fa</li> <li>onOptionsItemSelected(): Gestionar clics</li> <li>onPrepareOptionsMenu(): Actualitzar din\u00e0micament</li> <li>invalidateOptionsMenu(): For\u00e7ar recreaci\u00f3 del men\u00fa</li> </ul> <p>Utilitza AppBarLayout per a comportaments avan\u00e7ats (amagar/mostrar en scroll) (veure a continuaci\u00f3)</p>"},{"location":"Android/Interficies/toolbar/#6-estil-i-comportament-avancat-material-design","title":"6. Estil i Comportament Avan\u00e7at (Material Design)","text":""},{"location":"Android/Interficies/toolbar/#estil","title":"Estil","text":"<p>L'estil de l'AppBar (colors, fons, elevaci\u00f3) es controla principalment a trav\u00e9s del Tema de l'aplicaci\u00f3. Les propietats clau que afecten l'AppBar s\u00f3n:</p> <ul> <li> <p>colorPrimary: El color de fons principal de la barra.</p> </li> <li> <p>colorPrimaryVariant: S'utilitza sovint per a la Barra d'Estat (Status Bar).</p> </li> </ul>"},{"location":"Android/Interficies/toolbar/#comportament-avancat-amb-coordinatorlayout","title":"Comportament Avan\u00e7at amb CoordinatorLayout","text":"<p>Per a les aplicacions amb un disseny m\u00e9s sofisticat, la Toolbar s'integra amb un CoordinatorLayout i un AppBarLayout per crear efectes de despla\u00e7ament din\u00e0mics.</p>"},{"location":"Android/Interficies/toolbar/#exemple-defecte-de-desplacament","title":"Exemple d'Efecte de Despla\u00e7ament:","text":"<p>Si col\u00b7loques la Toolbar dins d'un AppBarLayout i el contingut despla\u00e7able (com un RecyclerView) tamb\u00e9 dins del CoordinatorLayout, pots utilitzar les scroll flags de l'AppBarLayout:</p> <pre><code>&lt;androidx.coordinatorlayout.widget.CoordinatorLayout&gt;\n    &lt;com.google.android.material.appbar.AppBarLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"&gt;\n        &lt;androidx.appcompat.widget.Toolbar\n            ...\n            app:layout_scrollFlags=\"scroll|enterAlways\" /&gt; &lt;/com.google.android.material.appbar.AppBarLayout&gt;\n\n    &lt;androidx.recyclerview.widget.RecyclerView\n        ...\n        app:layout_behavior=\"@string/appbar_scrolling_view_behavior\" /&gt;\n&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;\n</code></pre> <p>scroll: Fa que la barra es mogui fora de la pantalla quan l'usuari es despla\u00e7a cap avall.</p> <p>enterAlways:  Fa que la barra torni a apar\u00e8ixer tan aviat com l'usuari comen\u00e7a a despla\u00e7ar-se cap amunt, fins i tot lleugerament.</p>"},{"location":"Android/Interficies/viewbinding/","title":"Viewbinding","text":"<p>https://developer.android.com/topic/libraries/view-binding</p> <p>El viewbinding \u00e9s una caracter\u00edstica (feature) que ens permet accedir als objectes que hi ha en una vista, directament sense haver de buscar-lo amb el findviewbyid</p> <p>S'activa d'aquesta manera, en el build.grade de nivell de m\u00f2dul</p> <pre><code>android {\n    ...\n    buildFeatures {\n        viewBinding = true\n    }\n}\n</code></pre> <p>El que far\u00e0 aquesta caracter\u00edstica, \u00e9s generar, per cada layout, una classe amb el nom del layout+binding, per exemple  per al layout activity_main es far\u00e0 la classe ActivityMainBinding  Aquesta classe, contindr\u00e0 tantes properties com elements visuals hi hagi en el layout, per exemple botons, textboxes, etc.</p> <p>Tamb\u00e9 t\u00e9 un m\u00e9tode getRoot() (o en kotlin, directament root) que accedeix al layout principal que cont\u00e9 la resta de la vista (linear o constraint layout)</p> <p>Per utilitzar-la, cal:</p> <ul> <li>Crear una variable d'aquest tipus (amb lateinit)</li> <li>Crear la inst\u00e0ncia de la classe amb el m\u00e9tode static inflate() que crear\u00e0 l'objecte amb les properties necess\u00e0ries lligades als objectes que va creant del layout.</li> <li>Utilitzar el setContentView() per a que l'activity es renderitzi a partir dels objectes creats.</li> </ul> <p>Exemple</p> <pre><code>private lateinit var binding: ActivityMainBinding\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    binding = ActivityMainBinding.inflate(layoutInflater)\n    setContentView(binding.root)\n}\n</code></pre> <p>A partir d'aqu\u00ed, es pot accedir als elements de la UI directament sense el findviewbyId</p> <pre><code>binding.mainTxt.setText(\"Login\")\n\nbinding.btnLogin.setOnClickListener({\n    doLogin()\n})\n</code></pre>"},{"location":"Android/Interficies/viewbinding/#viewbinding-en-fragments","title":"Viewbinding en Fragments","text":"<p>En aquest cas cal crear la variable amb possibilitat de nuls, i que des de fora el fragment sigui readonly. Aix\u00f3 s'aconsegueix fent la variable nula, i creant un m\u00e9tode get:</p> <pre><code>// 1. Una variable privada i nul\u00b7lable per guardar la refer\u00e8ncia real\n    private var _binding: ResultProfileBinding? = null\n\n    // 2. Una propietat de nom\u00e9s lectura per no haver d'usar \"!!\" a tot arreu\n    private val binding get() = _binding!!\n</code></pre> <p>No es declara lateinit com en el cas de les activities, a causa del cicle de vida diferent dels fragments.</p> <p>La vista d'un Fragment pot ser destru\u00efda mentre el Fragment encara \u00e9s viu.</p> <p>Aix\u00f2 passa, per exemple, quan un usuari navega d'un Fragment A a un Fragment B. El Fragment A es queda a la backstack (est\u00e0 \"viu\"), per\u00f2 la seva interf\u00edcie gr\u00e0fica es destrueix per estalviar recursos.</p> <p>Si guardem una refer\u00e8ncia al binding i no la destru\u00efm, realment la vista no es podr\u00e0 destruir perque encara hi haur\u00e0 una refer\u00e8ncia a la vista.</p> <p>Aix\u00f3 f\u00e0 que haguem de destru\u00efr explicitament la variable en el onDestroy.</p> <p>Exemple de codi complert de viewbinding amb fragments:</p> <pre><code>class ProfileFragment : Fragment() {\n\n    private var _binding: ResultProfileBinding? = null\n\n    private val binding get() = _binding!!\n\n    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View {\n        _binding = ResultProfileBinding.inflate(inflater, container, false)\n        return binding.root\n    }\n\n    override fun onDestroyView() {\n        super.onDestroyView()\n        // 3. IMPORTANT: Netegem la refer\u00e8ncia per evitar memory leaks\n        _binding = null\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/voicerecognition/","title":"Voice Recognition","text":""},{"location":"Android/Interficies/voicerecognition/#us-de-speechrecognizer-api-nativa","title":"\u00das de SpeechRecognizer (API nativa)","text":"<p>Android ja porta el reconeixedor integrat i no cal cap SDK extern.</p> <p>Passos:</p>"},{"location":"Android/Interficies/voicerecognition/#1-permis-al-manifest","title":"1. Perm\u00eds al manifest","text":"<pre><code>&lt;uses-permission android:name=\"android.permission.RECORD_AUDIO\" /&gt;\n</code></pre>"},{"location":"Android/Interficies/voicerecognition/#2-crear-el-reconeixedor","title":"2. Crear el reconeixedor","text":"<p>private lateinit var recognizer: SpeechRecognizer</p>"},{"location":"Android/Interficies/voicerecognition/#3-inicialitzar-lo","title":"3. Inicialitzar-lo","text":"<pre><code>recognizer = SpeechRecognizer.createSpeechRecognizer(this)\n\nval recognizerIntent = Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH).apply {\n    putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, RecognizerIntent.LANGUAGE_MODEL_FREE_FORM)\n    putExtra(RecognizerIntent.EXTRA_LANGUAGE, \"ca-ES\") // o \"es-ES\"\n}\n</code></pre>"},{"location":"Android/Interficies/voicerecognition/#4-assignar-un-listener","title":"4. Assignar un listener","text":"<pre><code>recognizer.setRecognitionListener(object : RecognitionListener {\n    override fun onResults(results: Bundle?) {\n        val spokenText = results\n            ?.getStringArrayList(SpeechRecognizer.RESULTS_RECOGNITION)\n            ?.get(0)\n            ?.lowercase()\n\n        handleVoiceCommand(spokenText)\n    }\n\n    override fun onError(error: Int) {}\n    override fun onReadyForSpeech(params: Bundle?) {}\n    override fun onBeginningOfSpeech() {}\n    override fun onRmsChanged(rmsdB: Float) {}\n    override fun onBufferReceived(buffer: ByteArray?) {}\n    override fun onEndOfSpeech() {}\n    override fun onPartialResults(partialResults: Bundle?) {}\n    override fun onEvent(eventType: Int, params: Bundle?) {}\n})\n</code></pre>"},{"location":"Android/Interficies/voicerecognition/#5-interpretar-les-ordres","title":"5. Interpretar les ordres","text":"<pre><code>private fun handleVoiceCommand(command: String?) {\n    when {\n        command?.contains(\"endavant\") == true -&gt; {\n            // Obrir men\u00fa, navegar, etc.\n        }\n        command?.contains(\" enrere\") == true -&gt; {\n            onBackPressedDispatcher.onBackPressed()\n        }\n        command?.contains(\"acceptar\") == true -&gt; {\n            // Guardar dades, fer submit, etc.\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Interficies/voicerecognition/#6-per-activar-el-reconeixedor-quan-lusuari-parla","title":"6. Per activar el reconeixedor quan l\u2019usuari parla","text":"<p>alguna cosa com: <pre><code>buttonVoice.setOnClickListener {\n    recognizer.startListening(recognizerIntent)\n}\n</code></pre></p>"},{"location":"Android/Kotlin/","title":"Llenguatge Kotlin","text":"<p>Continguts:</p> <ul> <li>Variables i Constants: </li> <li>Funcions: </li> <li>Classes i Objectes:</li> <li>Null Safety: </li> <li>Funcions d'extensi\u00f3:</li> <li>LiveData: </li> <li>Coroutines:</li> <li>Anotadors:</li> </ul>"},{"location":"Android/Kotlin/#introduccio","title":"Introducci\u00f3","text":"<p>Kotlin \u00e9s un llenguatge de programaci\u00f3 modern creat per JetBrains i pensat, inicialment, per ser compatible amb Java. </p> <p>Avui en dia \u00e9s el llenguatge recomanat per Android i tamb\u00e9 s\u2019utilitza en molts altres \u00e0mbits. La seva filosofia principal \u00e9s ser un llenguatge m\u00e9s simple, segur i productiu que els que existien fins al moment, especialment comparat amb Java.</p> <p>Algunes caracter\u00edstiques generals:</p>"},{"location":"Android/Kotlin/#simplicitat-i-llegibilitat","title":"Simplicitat i llegibilitat","text":"<ul> <li>Kotlin busca reduir el codi que cal escriure. Moltes operacions que en altres llenguatges requereixen diverses l\u00ednies, en Kotlin es resolen de forma concisa.</li> <li>Aix\u00f2 facilita que el codi sigui m\u00e9s f\u00e0cil d\u2019entendre i mantenir.</li> </ul>"},{"location":"Android/Kotlin/#seguretat","title":"Seguretat","text":"<ul> <li>Kotlin incorpora mecanismes per evitar errors t\u00edpics, sobretot els relacionats amb valors nuls.</li> <li>Aquest tipus d\u2019error \u00e9s molt habitual en programaci\u00f3 i en Kotlin es controla de manera expl\u00edcita.</li> </ul>"},{"location":"Android/Kotlin/#compatibilitat-amb-java","title":"Compatibilitat amb Java","text":"<ul> <li>Kotlin funciona sobre la JVM (Java Virtual Machine), i un projecte pot barrejar fitxers Java i Kotlin sense problemes.</li> <li>A m\u00e9s, pot utilitzar totes les llibreries i frameworks que existeixen en Java.</li> </ul> <p>Aix\u00f2 permet migrar de Java a Kotlin de forma progressiva.</p>"},{"location":"Android/Kotlin/#versatilitat","title":"Versatilitat","text":"<p>Tot i que va n\u00e9ixer orientat a aplicacions Android, avui Kotlin s\u2019utilitza en molts camps:</p> <ul> <li>Aplicacions m\u00f2bils (Android)</li> <li>Backend (servidors) amb frameworks com Ktor o Spring Boot</li> <li>Aplicacions d'escriptori</li> <li>Desenvolupament web (Kotlin/JS)</li> <li>Multiplataforma (Kotlin Multiplatform), compartint codi entre Android, iOS i altres sistemes</li> </ul>"},{"location":"Android/Kotlin/#mes-eficient","title":"M\u00e9s eficient:","text":"<p>Alguns motius pels quals Kotlin ajuda a treballar de forma m\u00e9s eficient s\u00f3n:</p> <ul> <li>M\u00e9s facilitat per escriure codi que fa el mateix amb menys l\u00ednies</li> <li>Millor integraci\u00f3 amb l\u2019entorn Android Studio</li> <li>Sistema de tipus modern i m\u00e9s expressiu</li> <li>Funcions especials pensades per simplificar tasques habituals</li> </ul>"},{"location":"Android/Kotlin/anotadors/","title":"Anotadors","text":""},{"location":"Android/Kotlin/anotadors/#4-anotadors","title":"4. Anotadors","text":""},{"location":"Android/Kotlin/anotadors/#que-son","title":"Qu\u00e8 s\u00f3n","text":"<p>Els anotadors s\u00f3n una caracter\u00edstica del llenguatge Java (i Kotlin) que permeten afegir metadades al codi.</p> <p>Els anotadors (o Annotations) s\u00f3n una forma de metadada que es pot afegir al codi font.</p> <ol> <li> <p>Metadada, la clau La metadada \u00e9s \"data sobre data\". En programaci\u00f3, un anotador no cont\u00e9 l\u00f2gica ni executa cap acci\u00f3 per si mateix. Simplement etiqueta o descriu altres parts del codi, com classes, m\u00e8todes, variables o par\u00e0metres.</p> </li> <li> <p>Finalitat Principal El seu prop\u00f2sit principal \u00e9s ser llegits i processats per eines o frameworks en temps de compilaci\u00f3, en temps d'execuci\u00f3, o durant la generaci\u00f3 de documentaci\u00f3.</p> </li> <li> <p>Com Funcionen? Quan un anotador es posa sobre un element de codi, el framework que fa servir aquest codi pot:</p> <ul> <li> <p>Llegir-lo (Reflection): El framework (com Retrofit, Spring, o JUnit) inspecciona el codi durant l'execuci\u00f3 i detecta la pres\u00e8ncia i el valor dels anotadors.</p> </li> <li> <p>Modificar el Comportament: Basant-se en l'anotador, el framework canvia la manera com gestiona l'element.</p> </li> </ul> </li> </ol> <p>Exemples comuns en programaci\u00f3:</p> <ul> <li> <p>Retrofit: L'anotador @GET(\"ruta\") li diu a la llibreria que \"aquest m\u00e8tode ha de generar una petici\u00f3 HTTP GET a la ruta especificada.\"</p> </li> <li> <p>Testing (JUnit): L'anotador @Test li diu a l'eina de proves que \"aquest m\u00e8tode \u00e9s una prova i ha de ser executat.\"</p> </li> <li> <p>Android: L'anotador @Override li diu al compilador que \"aquest m\u00e8tode est\u00e0 substituint un m\u00e8tode de la classe pare, per la qual cosa s'ha de comprovar la signatura.\"</p> </li> </ul>"},{"location":"Android/Kotlin/anotadors/#anotadors-de-retrofit","title":"Anotadors de Retrofit","text":"<p>Es divideixen principalment en dues categories: els que defineixen el m\u00e8tode HTTP i la URL i els que defineixen els par\u00e0metres que s'envien amb aquesta petici\u00f3.</p>"},{"location":"Android/Kotlin/anotadors/#anotadors-de-metode-http-i-url-base","title":"Anotadors de M\u00e8tode HTTP i URL Base","text":"Anotador Categoria Funci\u00f3 Exemple d'\u00das @GET HTTP Sol\u00b7licita dades d'un recurs especificat. S'utilitza per obtenir (llegir) dades.    @GET(\"users/list\") @POST HTTP Envia dades a un recurs per crear-ne un de nou o processar-les. @POST(\"users/create\") @PUT HTTP S'utilitza per actualitzar (modificar completament) un recurs existent amb les dades proporcionades. @PUT(\"users/{id}\") @DELETE HTTP Sol\u00b7licita l'eliminaci\u00f3 d'un recurs especificat. @DELETE(\"users/{id}\") @PATCH HTTP S'utilitza per aplicar modificacions parcials a un recurs. @PATCH(\"users/{id}\") @HEAD HTTP Demana nom\u00e9s les cap\u00e7aleres de resposta sense el cos de la resposta. \u00datil per comprovar l'exist\u00e8ncia. @HEAD(\"health\") @HTTP HTTP M\u00e8tode m\u00e9s general per fer peticions HTTP sense els anotadors espec\u00edfics (@GET, @POST, etc.). Poc com\u00fa. @HTTP(method = \"DELETE\", path = \"users/{id}\", hasBody = false)"},{"location":"Android/Kotlin/anotadors/#anotadors-de-parametres-com-senvia-la-informacio","title":"Anotadors de Par\u00e0metres (Com s'Envia la Informaci\u00f3)","text":"<p>Per la URL</p> Anotador Funci\u00f3 Descripci\u00f3 Exemple @Path Ruta din\u00e0mica Substitueix un par\u00e0metre entre claus {} a la URL de la petici\u00f3. Obligatori per a rutes din\u00e0miques. @GET(\"items/{id}\") fun getItem(@Path(\"id\") itemId: Int) @Query Par\u00e0metre de consulta Afegeix un par\u00e0metre a la URL despr\u00e9s del signe d'interrogaci\u00f3 (?). \u00datil per a filtres i paginaci\u00f3. @GET(\"items\") fun filterItems(@Query(\"type\") type: String) Genera: /items?type=Electronics @QueryMap Consulta m\u00faltiple Permet enviar m\u00faltiples par\u00e0metres de consulta utilitzant un mapa de Kotlin (Map). fun getItems(@QueryMap options: Map) <p>Per al Cos de la Petici\u00f3 (Dades enviades) Anotador    | Funci\u00f3    | Descripci\u00f3    |Exemple :-----------|:----------|:--------------|:---------------- @Body|Cos de la petici\u00f3|\"Utilitzat en peticions @POST, @PUT o @PATCH. El par\u00e0metre de la funci\u00f3 (un objecte Kotlin) es serialitza (normalment a JSON) i s'envia com a cos de la petici\u00f3.\"|fun createItem(@Body item: ItemRequest) @FormUrlEncoded|Format de formulari|Utilitzat juntament amb @Field quan s'envien dades amb el format tradicional application/x-www-form-urlencoded.|Cal usar-lo a la funci\u00f3! @Field|Camp de formulari|S'utilitza nom\u00e9s en combinaci\u00f3 amb @FormUrlEncoded. Envia dades com a parelles clau-valor en el cos.|\"fun login(@Field(\"\"user\"\") u: String, @Field(\"\"pass\"\") p: String)\"</p> <p>Per a Cap\u00e7aleres (Metadata) Anotador    | Funci\u00f3    | Descripci\u00f3    |Exemple :-----------|:----------|:--------------|:---------------- @Header|Cap\u00e7alera din\u00e0mica|Permet afegir una cap\u00e7alera HTTP de manera din\u00e0mica (el seu valor prov\u00e9 d'un par\u00e0metre de la funci\u00f3). \u00datil per a tokens d'autenticaci\u00f3.|\"fun secureCall(@Header(\"\"Authorization\"\") token: String)\" @Headers|Cap\u00e7alera est\u00e0tica|Permet afegir cap\u00e7aleres HTTP fixes directament a la funci\u00f3 sense que depenguin d'un par\u00e0metre.|\"@Headers(\"\"Cache-Control: max-age=640000\"\") Cal usar-lo a la funci\u00f3!\"</p> <p>Per a Multipart (Fitxers) Anotador    | Funci\u00f3    | Descripci\u00f3    |Exemple :-----------|:----------|:--------------|:---------------- Anotador,Funci\u00f3,Descripci\u00f3,Exemple @Multipart|Fitxers m\u00faltiples|Indica que la petici\u00f3 \u00e9s de tipus multipart i s'utilitza per pujar fitxers amb dades addicionals.|Cal usar-lo a la funci\u00f3! @Part|Part de dades/fitxer|Defineix una part individual d'una petici\u00f3 multipart. Pot ser un camp de dades simple o un fitxer (utilitzant RequestBody).|fun uploadFile(@Part file: RequestBody)</p>"},{"location":"Android/Kotlin/classesobjectes/","title":"Classes i objectes en kotlin","text":""},{"location":"Android/Kotlin/classesobjectes/#classes","title":"Classes","text":"<ul> <li>Son finals per defecte</li> </ul>"},{"location":"Android/Kotlin/classesobjectes/#absencia-de-new","title":"Abs\u00e8ncia de New","text":"<p>No cal posar new</p> <pre><code>val persona = Persona(\"Joan\")\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#constructors-mes-simples","title":"Constructors m\u00e9s simples","text":"<p>Kotlin incorpora el constructor en la cap\u00e7alera:</p> <pre><code>class Persona(val nom: String, var edat: Int,x:Int)\n</code></pre> <p>Si no s'acompanya var o val, la variable nom\u00e9s s'utilitza en el constructor</p>"},{"location":"Android/Kotlin/classesobjectes/#a-kotlin-no-cal-escriure-getterssetters","title":"A Kotlin no cal escriure getters/setters:","text":"<p>Es generen autom\u00e0ticament segons val (nom\u00e9s lectura) o var (mutable).</p>"},{"location":"Android/Kotlin/classesobjectes/#constructor","title":"Constructor","text":"<p>Init executa el codi quan l'objecte es crea:</p> <p><pre><code>class Circle(i: Int) {  \n   init {\n        ... \n   }\n}\n</code></pre> \u00c9s t\u00e8cnicament el mateix que </p> <pre><code>class Circle {\n    constructor(i: Int) {\n        ...\n    }\n}\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#getters-i-setters","title":"Getters i Setters","text":"<p>Es poden sobreescriure els getters i setters per defecte:</p> <pre><code>class Person(val firstName: String, val lastName:String) {\n    val fullName:String\n        get() {\n            return \"$firstName $lastName\"\n        }\n}\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#herencia","title":"Her\u00e8ncia","text":"<ul> <li>Kotlin t\u00e9 her\u00e8ncia de classe amb un \u00fanic pare (single-parent class inheritance)</li> <li>Cada classe t\u00e9 exactament una classe pare, anomenada superclasse</li> <li>Cada subclasse hereta tots els membres de la seva superclasse, inclosos els que la superclasse mateixa ha heretat</li> </ul>"},{"location":"Android/Kotlin/classesobjectes/#classes-especials","title":"Classes especials","text":""},{"location":"Android/Kotlin/classesobjectes/#data-class","title":"Data class","text":"<p>Classe pensada per contenir dades</p> <p>Generen autom\u00e0ticament:</p> <p>\u2714 equals() \u2714 hashCode() \u2714 toString() \u2714 copy() \u2714 destructuring</p> <pre><code>data class Alumne(val nom: String, val edat: Int)\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#pair-i-triple-son-dataclasses-predefinides","title":"Pair i Triple son dataclasses predefinides:","text":"<p>Guarden un parell o tres valors</p> <p>Accedim a les seves propietat amb .first, .second, .third <pre><code>val bookAuthor = Pair(\"Harry Potter\", \"J.K. Rowling\")\nprintln(bookAuthor.first)\n</code></pre></p> <p>Pair t\u00e9 .to per ometre par\u00e8ntesis</p> <pre><code>val bookAuth1 = \"Harry Potter\".to(\"J. K. Rowling\")\nval bookAuth2 = \"Harry Potter\" to \"J. K. Rowling\"\nval map = mapOf(1 to \"x\", 2 to \"y\", 3 to \"zz\")\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#enum-class","title":"Enum class","text":"<p>Tipus de dada predefinit per a un conjunt de valors <pre><code>enum class Color(val r: Int, val g: Int, val b: Int) {\n   RED(255, 0, 0), GREEN(0, 255, 0), BLUE(0, 0, 255)\n}\nprintln(\"\" + Color.RED.r + \" \" + Color.RED.g + \" \" + Color.RED.b)\n</code></pre></p>"},{"location":"Android/Kotlin/classesobjectes/#sealed-class","title":"Sealed class","text":"<p>Caracter\u00edstiques:</p> <ul> <li>Sembla a una enum, per\u00f2 m\u00e9s avan\u00e7ada, amb dades i comportament.</li> <li>Una sealed class no es pot estendre fora del mateix fitxer on est\u00e0 definida.</li> <li>Aix\u00f2 vol dir que totes les subclasses possibles estan controlades i limitades.</li> </ul> <pre><code>sealed class Operacio {\n    class Suma(val a: Int, val b: Int) : Operacio()\n    class Resta(val a: Int, val b: Int) : Operacio()\n    class Quadrat(val a: Int) : Operacio()\n}\n</code></pre> <p>Les sealed classes serveixen per:</p> <ul> <li>Restringir el polimorfisme</li> <li>Garantir tractament complet a when</li> <li>Substituir enums quan es necessita informaci\u00f3</li> <li>Fer el codi m\u00e9s segur i expressiu</li> <li>Evitar errors inesperats en her\u00e8ncies</li> </ul> <p>S\u00f3n ideals quan sabem tots els casos possibles i no volem que ning\u00fa en defineixi de nous.</p> <p>El compilador ens avisaria si en el when: falta algun cas, o no els posem tots  <pre><code>fun calcula(op: Operacio): Int {\n    return when(op) {\n        is Operacio.Suma -&gt; op.a + op.b\n        is Operacio.Resta -&gt; op.a - op.b\n        is Operacio.Quadrat -&gt; op.a * op.a\n    }\n}\n</code></pre></p>"},{"location":"Android/Kotlin/classesobjectes/#interficies","title":"Interf\u00edcies","text":"<ul> <li>Proporcionen un contracte al qual les classes s'hi han d'adherir (han d'implementar els m\u00e9todes)</li> <li>Poden contenir implementaci\u00f3 per defecte (m\u00e9todes abstractes i implmenentats)</li> <li>Poden heredar d'altres interf\u00edcies</li> <li>Poden tenir propietats</li> <li>Permeten m\u00faltiples her\u00e8ncies</li> <li>Poden contenir membres est\u00e0tics en forma de companion objects</li> </ul> <pre><code>interface Shape {\n    val name:String\n    fun computeArea() : Double\n}\nclass Circle(val radius:Double) : Shape {\n    override fun computeArea() = Math.PI * radius * radius\n}\nval c = Circle(3.0)\nprintln(c.computeArea())\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#objectes-en-kotlin","title":"Objectes en Kotlin","text":"<p>La paraula object: declara singletons reals</p> <pre><code>object Configuracio {\n    val versio = \"1.0\"\n}\n</code></pre> <p>Equivalent al patr\u00f3 Singleton en Java, per\u00f2 autom\u00e0tic:</p> <ul> <li>inst\u00e0ncia \u00fanica</li> <li>inicialitzaci\u00f3 garantida</li> <li>accessible directament:</li> </ul> <pre><code>println(Configuracio.versio)\n</code></pre>"},{"location":"Android/Kotlin/classesobjectes/#object-expressions-objectes-anonims","title":"Object expressions (objectes an\u00f2nims)","text":"<p><pre><code>val listener = object : OnClickListener {\n    override fun onClick() {\n        println(\"Click!\")\n    }\n}\n</code></pre> -&gt; substitueix new Interface() de Java</p>"},{"location":"Android/Kotlin/classesobjectes/#companion-objects-equivalent-a-membres-estatics","title":"Companion objects (equivalent a membres est\u00e0tics)","text":"<p>A Kotlin no existeixen les variables est\u00e0tiques de classe (static). En lloc seu, s\u2019utilitza companion object:</p> <p><pre><code>class Persona {\n    companion object {\n        val MAX_EDAT = 120\n    }\n}\n\nprintln(Persona.MAX_EDAT)\n</code></pre> Equivalent aproximadament a:</p> <pre><code>public class Persona {\n    public static final int MAX_EDAT = 120;\n}\n</code></pre>"},{"location":"Android/Kotlin/coroutines/","title":"Corrutines","text":"<p>Les corrutines s\u00f3n una de les caracter\u00edstiques m\u00e9s potents i diferencials del llenguatge Kotlin. Serveixen per gestionar tasques as\u00edncrones i concurrents d\u2019una manera molt m\u00e9s senzilla, segura i llegible que amb fils (threads) tradicionals.</p> <ul> <li>https://www.youtube.com/watch?v=vQ0w4zAe68A&amp;t=943</li> <li>https://developer.android.com/kotlin/coroutines?hl=es-419</li> </ul>"},{"location":"Android/Kotlin/coroutines/#que-es-una-corrutina","title":"Qu\u00e8 \u00e9s una corrutina?","text":"<p>Una corrutina \u00e9s una unitat d'execuci\u00f3 lleugera que es pot pausar i reprendre sense bloquejar el fil principal del programa.</p> <ul> <li>Es podrien descriure com \u201cthreads lleugers\u201d</li> <li>Permeten fer processos costosos sense congelar la UI</li> <li>Fan el codi as\u00edncron m\u00e9s intu\u00eftiu i lineal</li> <li>Es poden cancelar autom\u00e0ticament</li> </ul>"},{"location":"Android/Kotlin/coroutines/#per-que-sutilitzen","title":"Per qu\u00e8 s\u2019utilitzen?","text":"<p>Quan programem, especialment en aplicacions Android, sovint tenim tasques com:</p> <ul> <li>Accedir a la base de dades</li> <li>Fer peticions HTTP (APIs)</li> <li>Llegir fitxers</li> <li>Fer c\u00e0lculs costosos</li> </ul> <p>Si aquestes tasques s'executessin al fil principal, bloquejaria la interf\u00edcie gr\u00e0fica.</p> <p>Les corrutines resolen aquest problema executant-se en un fil secundari i tornant el resultat quan est\u00e0 llest.</p>"},{"location":"Android/Kotlin/coroutines/#elements-principals-de-les-corrutines","title":"Elements principals de les corrutines","text":""},{"location":"Android/Kotlin/coroutines/#1-coroutinescope","title":"1. CoroutineScope","text":"<p>\u00c9s el \u201ccontext\u201d on viuen les corrutines.</p> <p>Exemples de scopes:</p> <p>Scope | \u00das |:----|:---- GlobalScope |corrutina global durant tota l'app MainScope   |vinculat a UI lifecycleScope  |Android \u2013 vinculat al cicle de vida viewModelScope  |Android \u2013 s\u2019atura quan el ViewModel mor</p>"},{"location":"Android/Kotlin/coroutines/#2-launch-vs-async","title":"2. launch vs async","text":""},{"location":"Android/Kotlin/coroutines/#launch","title":"launch","text":"<p>Executa una corrutina sense retornar resultat</p> <pre><code>lifecycleScope.launch {\n    println(\"Aix\u00f2 \u00e9s una tasca as\u00edncrona\")\n}\n</code></pre>"},{"location":"Android/Kotlin/coroutines/#async","title":"async","text":"<p>Retorna un objecte Deferred i es pot recollir el resultat amb await() <pre><code>val resultat = async {\n    10 + 20\n}.await()\nprintln(resultat)\n</code></pre>"},{"location":"Android/Kotlin/coroutines/#3-suspend-functions","title":"3. Suspend functions","text":"<p>Una funci\u00f3 marcada amb suspend pot ser pausada i continua en un altre moment.</p> <pre><code>suspend fun carregarDades(): String {\n    delay(2000) // simula temps d\u2019espera\n    return \"Dades carregades\"\n}\n</code></pre> <p>Nom\u00e9s es pot cridar des de:</p> <ul> <li>una corrutina</li> <li>una altra funci\u00f3 suspend</li> </ul>"},{"location":"Android/Kotlin/coroutines/#dispatchers-on-sexecuten","title":"Dispatchers (On s\u2019executen?)","text":"<p>Els dispatchers indiquen en quin fil s'executa la corrutina:</p> <p>Dispatcher|\u00das |:--------|:--- Dispatchers.Main    |tasques de UI Dispatchers.IO  |fitxers, base de dades, xarxa Dispatchers.Default |c\u00e0lculs pesats Dispatchers.Unconfined  |poc utilitzat</p> <p>Exemple:</p> <pre><code>launch(Dispatchers.IO) {\n    val dades = carregarDades()\n    withContext(Dispatchers.Main) {\n        // actualitzar UI\n        textView.text = dades\n    }\n}\n</code></pre>"},{"location":"Android/Kotlin/coroutines/#que-es-withcontext","title":"Qu\u00e8 \u00e9s withContext?","text":"<p>withContext \u00e9s una funci\u00f3 de suspensi\u00f3 (suspend) que permet canviar el dispatcher o context dins d\u2019una corrutina i executar un bloc de codi en aquest nou context, sense crear una nova corrutina.</p> <p>\u00c9s \u00fatil per fer tasques de fons (IO, c\u00e0lculs) i despr\u00e9s tornar a la UI per actualitzar-la.</p> <p>Retorna el resultat del bloc que executa.</p> <pre><code>val resultat = withContext(Dispatchers.IO) {\n    // codi que s'executa en un fil d'entrada/sortida (IO)\n    carregarDadesPesades()\n}\n</code></pre>"},{"location":"Android/Kotlin/coroutines/#diferencia-entre-withcontext-launch-i-async","title":"Difer\u00e8ncia entre withContext launch i async","text":"<p>Funci\u00f3| Quan usar-la|   Retorna resultat? |:----|:------------|:--------- launch  |Crear una corrutina nova   |No async   |Crear corrutina que retorna un resultat    |S\u00ed, Deferred.await() withContext |Canviar context dins d\u2019una corrutina existent  |S\u00ed, retorna el valor del bloc</p>"},{"location":"Android/Kotlin/fextensio/","title":"Funcions d'extensi\u00f3","text":""},{"location":"Android/Kotlin/fextensio/#1-que-son-les-funcions-dextensio","title":"1. Qu\u00e8 s\u00f3n les Funcions d'Extensi\u00f3?","text":"<p>Una funci\u00f3 d'extensi\u00f3 \u00e9s una funci\u00f3 que es declara fora d'una classe, per\u00f2 que es pot cridar com si fos un m\u00e8tode d'aquesta classe.</p> <p>Sintaxi: Es defineix prefixant el nom de la funci\u00f3 amb el tipus que s'est\u00e9n (el tipus receptor), seguit d'un punt (.) i el nom de la funci\u00f3.</p> <p>Acc\u00e9s: Dins de la funci\u00f3 d'extensi\u00f3, pots accedir a les propietats i m\u00e8todes p\u00fablics del tipus est\u00e8s mitjan\u00e7ant la paraula clau this, que es refereix a la inst\u00e0ncia del receptor.</p> <p>L'\u00fas principal \u00e9s fer el codi m\u00e9s llegible i conc\u00eds, evitant la necessitat de classes utilit\u00e0ries plenes de m\u00e8todes est\u00e0tics. S\u00f3n molt comunes a la llibreria est\u00e0ndard de Kotlin (per exemple, funcions com .map(), .filter(), o .joinToString() en col\u00b7leccions s\u00f3n funcions d'extensi\u00f3).</p>"},{"location":"Android/Kotlin/fextensio/#2-exemple-practic-funcio-dextensio","title":"2. Exemple Pr\u00e0ctic funci\u00f3 d'extensi\u00f3","text":"<p>Imagina que sovint necessites una funci\u00f3 per capitalitzar la primera lletra d'una cadena (String). En lloc de crear una classe utilit\u00e0ria, pots estendre directament la classe String.</p>"},{"location":"Android/Kotlin/fextensio/#codi-de-la-funcio-dextensio","title":"Codi de la Funci\u00f3 d'Extensi\u00f3","text":"<p>Definim una funci\u00f3 d'extensi\u00f3 anomenada capitalizeFirstLetter per al tipus String:</p> <pre><code>// Extensions.kt\nfun String.capitalizeFirstLetter(): String {\n    // Si la cadena est\u00e0 buida o \u00e9s null (tot i que String no pot ser null), \n    // retornem la cadena tal com est\u00e0 per seguretat.\n    if (this.isEmpty()) return this\n\n    // La paraula clau 'this' fa refer\u00e8ncia a la inst\u00e0ncia de String \n    // sobre la qual s'est\u00e0 cridant la funci\u00f3 (el receptor).\n    return this.substring(0, 1).uppercase() + this.substring(1)\n}\n</code></pre>"},{"location":"Android/Kotlin/fextensio/#com-sutiliza","title":"Com S'Utiliza","text":"<p>Ara, pots cridar aquesta funci\u00f3 directament sobre qualsevol inst\u00e0ncia de String, com si fos un m\u00e8tode propi de la classe:</p> <pre><code>fun main() {\n    val textNormal = \"hola m\u00f3n\"\n    val textCapitalitzat = textNormal.capitalizeFirstLetter()\n\n    println(\"Original: $textNormal\")\n    println(\"Capitalitzat: $textCapitalitzat\")\n    // Sortida: Original: hola m\u00f3n\n    // Sortida: Capitalitzat: Hola m\u00f3n\n\n    val altreText = \"kotlin\"\n    println(altreText.capitalizeFirstLetter()) // Sortida: Kotlin\n}\n</code></pre> <p>D'aquesta manera qualsevol variable del tipus de la classe extesa, pot utilitzar la funci\u00f3 en qualsevol part del codi.</p>"},{"location":"Android/Kotlin/fextensio/#3-que-son-les-propietats-dextensio","title":"3. Qu\u00e8 s\u00f3n les Propietats d'Extensi\u00f3?","text":"<p>Una propietat d'extensi\u00f3 \u00e9s essencialment un camp que pots llegir o modificar directament sobre la inst\u00e0ncia d'una classe, tot i que aquesta propietat no forma part de la definici\u00f3 original de la classe.</p> <ul> <li>No emmagatzemen estat: \u00c9s important entendre que les propietats d'extensi\u00f3 no poden inicialitzar-se amb un backing field (\u00e9s a dir, no poden emmagatzemar dades). </li> <li>Han de ser propietats calculades que nom\u00e9s tenen un getter i, opcionalment, un setter.</li> <li>Sintaxi: S'assembla molt a la definici\u00f3 d'una propietat normal, per\u00f2 prefixant-la amb el nom de la classe que s'est\u00e9n.</li> </ul>"},{"location":"Android/Kotlin/fextensio/#4-exemple-practic-propietat-calculada","title":"4. Exemple Pr\u00e0ctic: Propietat Calculada","text":"<p>Imagina que tens una classe String i vols una manera r\u00e0pida de comprovar si una cadena \u00e9s una adre\u00e7a de correu electr\u00f2nic molt simple sense haver d'escriure isEmail() cada cop.  Pots crear una propietat d'extensi\u00f3 anomenada isSimpleEmail.</p>"},{"location":"Android/Kotlin/fextensio/#codi-de-la-propietat-dextensio","title":"Codi de la Propietat d'Extensi\u00f3","text":"<p>Definim la propietat d'extensi\u00f3 isSimpleEmail per al tipus String. \u00c9s de tipus Boolean i nom\u00e9s t\u00e9 un getter (\u00e9s de nom\u00e9s lectura): <pre><code>// Extensions.kt\n// Definim una propietat de nom\u00e9s lectura (val) amb un getter personalitzat\nval String.isSimpleEmail: Boolean\n    get() {\n        // En una implementaci\u00f3 real, aquesta l\u00f2gica seria molt m\u00e9s complexa (p. ex., amb expressions regulars)\n        // Per\u00f2 per a l'exemple, simplement mirem si cont\u00e9 un '@' i un '.'\n        return this.contains('@') &amp;&amp; this.contains('.')\n    }\n</code></pre></p>"},{"location":"Android/Kotlin/fextensio/#com-sutilitza","title":"Com S'Utilitza","text":"<p>Ara, pots accedir a aquesta propietat directament sobre qualsevol String com si fos un camp definit a la classe:Kotlinfun main() {     val emailCorrecte = \"usuari@exemple.com\"     val textNormal = \"Aix\u00f2 no \u00e9s un correu\"</p> <pre><code>// Accedim-hi com una propietat, sense par\u00e8ntesis!\nprintln(\"'$emailCorrecte' \u00e9s un correu: ${emailCorrecte.isSimpleEmail}\") \n// Sortida: 'usuari@exemple.com' \u00e9s un correu: true\n\nprintln(\"'$textNormal' \u00e9s un correu: ${textNormal.isSimpleEmail}\")\n// Sortida: 'Aix\u00f2 no \u00e9s un correu' \u00e9s un correu: false\n</code></pre> <p>}</p>"},{"location":"Android/Kotlin/fextensio/#5-diferencies-entre-funcio-dextensio-i","title":"5. Difer\u00e8ncies entre funci\u00f3 d'extensi\u00f3 i","text":"<p>Observeu la difer\u00e8ncia amb la funci\u00f3 d'extensi\u00f3:</p> <ul> <li>Funci\u00f3 d'Extensi\u00f3: text.capitalizeFirstLetter() $\\rightarrow$ Necessita par\u00e8ntesis.</li> <li>Propietat d'Extensi\u00f3: text.isSimpleEmail $\\rightarrow$ No necessita par\u00e8ntesis, fent que el codi sigui molt m\u00e9s clar i semblant a la lectura d'un atribut.</li> </ul>"},{"location":"Android/Kotlin/funcions/","title":"Funcions","text":""},{"location":"Android/Kotlin/funcions/#funcions-en-kotlin","title":"Funcions en kotlin","text":"<p>A part de les caracter\u00edstiques que poden tenir les funcions, com el altres llenguatges com per exemple Java, (noms, par\u00e0metres, valors per defecte, etc), Kotlin t\u00e9 les seves particularitats:</p>"},{"location":"Android/Kotlin/funcions/#funcions-compactes-single-expression","title":"Funcions compactes (single-expression)","text":"<p>Serveixen per simplificar:</p> <p>Forma completa: <pre><code>fun double(x: Int): Int {\n    return x * 2\n}\n</code></pre></p> <p>Forma compacta:</p> <pre><code>fun double(x: Int): Int = x * 2\n</code></pre>"},{"location":"Android/Kotlin/funcions/#lambdes-i-funcions-dordre-superior","title":"Lambdes i funcions d\u2019ordre superior","text":"<p>Kotlin tracta les funcions com si fossin de \"primera classe\", o \"first class\": Aix\u00f3 vol dir que:</p> <ul> <li>es poden guardar en variables</li> <li>passar com a par\u00e0metres</li> <li>retornar-les des d'altres funcions</li> </ul>"},{"location":"Android/Kotlin/funcions/#lambda","title":"Lambda","text":"<p>Una funci\u00f3 sense nom \u00e9s una funci\u00f3 lambda, en aquest cas guardada com a variable:</p> <p><pre><code>val waterFilter : (Int) -&gt; Int = { level: Int -&gt; level / 2 }\nprintln(waterFilter(20))  // 10\n</code></pre> En aquest cas la definici\u00f3 de la variables segueix les normes:</p> <p><pre><code>val variable:tipus=valor\n</code></pre> Per\u00f2 en comptes d'un tipus simple o una classe, el tipus i el valor \u00e9s una funci\u00f3. En el tipus, una firma d'una funci\u00f3, i en el valor, la implementaci\u00f3 de la funci\u00f3.</p> <p>Si no especifiquem el par\u00e0metre en una funci\u00f3 lambda i nom\u00e9s t\u00e9 un par\u00e0metre, aquest per defecte ser\u00e0 \"it\", i podem ometre el par\u00e0metre i -&gt; :</p> <pre><code>val waterFilter : (Int) -&gt; Int = { it / 2 }\n</code></pre>"},{"location":"Android/Kotlin/funcions/#funcio-dordre-superior","title":"Funci\u00f3 d\u2019ordre superior","text":"<p>Les funcions d'ordre superior s\u00f3n aquelles que reben una funci\u00f3 com a argument:</p> <pre><code>fun encodeMsg(msg: String, encode: (String) -&gt; String): String {\n    return encode(msg)\n}\n\nval upper = { s: String -&gt; s.uppercase() }\nprintln(encodeMsg(\"abc\", upper))\n</code></pre>"},{"location":"Android/Kotlin/funcions/#passar-referencia-de-funcio","title":"Passar refer\u00e8ncia de funci\u00f3","text":"<p>Amb :: podem passar la refer\u00e8ncia a una funci\u00f3.</p> <pre><code>fun enc2(input:String): String = input.reversed()\nencodeMessage(\"abc\", ::enc2)\n</code></pre>"},{"location":"Android/Kotlin/funcions/#ultim-parametre-duna-funcio","title":"\u00daltim par\u00e0metre d'una funci\u00f3","text":"<p>En Kotlin \u00e9s preferible que si hi ha algun par\u00e0metre que sigui una funci\u00f3, aquest sigui l'ultim par\u00e0metre:</p> <pre><code>encodeMessage(\"acronym\", { input -&gt; input.toUpperCase() })\n</code></pre> <p>Si la funci\u00f3 nom\u00e9s t\u00e9 un par\u00e0metre, podem ometre:</p> <p>Els par\u00e8ntesi:</p> <pre><code>val ints = listOf(1, 2, 3)\nints.filter { n: Int -&gt; n &gt; 0 }\n</code></pre> <p>El nom del par\u00e0metre i la -&gt; si nom\u00e9s n'hi ha un (ser\u00e0 it): <pre><code>ints.filter { it &gt; 0 }\n</code></pre></p>"},{"location":"Android/Kotlin/livedata/","title":"LiveData (i ViewModel):","text":""},{"location":"Android/Kotlin/livedata/#1-conceptes-fonamentals-de-livedata","title":"1. Conceptes fonamentals de LiveData","text":""},{"location":"Android/Kotlin/livedata/#que-es-livedata-i-per-que-sutilitza","title":"Qu\u00e8 \u00e9s LiveData i per qu\u00e8 s'utilitza","text":"<p>LiveData \u00e9s una classe contenidora de dades observable que forma part d'Android Jetpack.  La seva funci\u00f3 principal \u00e9s mantenir i gestionar dades que la UI necessita observar.</p>"},{"location":"Android/Kotlin/livedata/#caracteristiques-principals","title":"Caracter\u00edstiques principals:","text":"<ul> <li>Observable: Notifica autom\u00e0ticament als observadors quan les dades canvien</li> <li>Lifecycle-aware: Respecta el cicle de vida dels components d'Android</li> <li>Prev\u00e9 memory leaks: S'eliminen autom\u00e0ticament les subscripcions quan el component es destrueix</li> <li>Actualitzacions autom\u00e0tiques: La UI sempre mostra les dades m\u00e9s recents</li> </ul>"},{"location":"Android/Kotlin/livedata/#per-que-utilitzar-livedata","title":"Per qu\u00e8 utilitzar LiveData:","text":"<ul> <li>Elimina la necessitat de gestionar manualment les subscripcions</li> <li>Garanteix que la UI nom\u00e9s s'actualitzi quan est\u00e0 activa (STARTED o RESUMED)</li> <li>Evita crashes per actualitzar la UI quan l'Activity/Fragment est\u00e0 destru\u00eft</li> <li>Facilita la comunicaci\u00f3 entre ViewModel i la capa de UI</li> </ul>"},{"location":"Android/Kotlin/livedata/#2-diferencies-entre-dades-normals-i-livedatadades-normals-variables-convencionals","title":"2. Difer\u00e8ncies entre dades normals i LiveDataDades normals (variables convencionals):","text":"<p><pre><code>class  ViewModel {\n    var contador: Int = 0  // Variable normal\n\n    fun incrementar() {\n        contador++\n        // Necessites notificar manualment la UI del canvi\n    }\n}\n</code></pre> Amb LiveData: <pre><code>ViewModel : ViewModel() {\n    private val _contador = MutableLiveData&lt;Int&gt;(0)\n    val contador: LiveData&lt;Int&gt; = _contador\n\n    fun incrementar() {\n        _contador.value = _contador.value?.plus(1)\n        // La UI s'actualitza autom\u00e0ticament (veure patro observer)\n    }\n}\n</code></pre></p>"},{"location":"Android/Kotlin/livedata/#3-el-patro-observer-aplicat-a-livedata","title":"3. El patr\u00f3 Observer aplicat a LiveData","text":"<p>LiveData implementa el patr\u00f3 de disseny Observer, on:</p> <p>Variable (LiveData): Cont\u00e9 les dades i mant\u00e9 una llista d'observadors Observer (UI component): S'subscriu per rebre notificacions dels canvis</p> <p>Funcionament:</p> <p>La UI s'subscriu al LiveData utilitzant observe() Quan les dades canvien, LiveData notifica autom\u00e0ticament tots els observadors actius Els observadors reben les noves dades i actualitzen la UI</p> <p>Exemple: <pre><code>// Al ViewModel\nclass ContadorViewModel : ViewModel() {\n    private val _contador = MutableLiveData&lt;Int&gt;(0)\n    val contador: LiveData&lt;Int&gt; = _contador\n\n    fun incrementar() {\n        _contador.value = (_contador.value ?: 0) + 1\n    }\n}\n\n// A l'Activity/Fragment\nviewModel.contador.observe(viewLifecycleOwner) { nouValor -&gt;\n    // Aquest codi s'executa autom\u00e0ticament cada vegada que canvia el valor\n    textViewContador.text = nouValor.toString()\n}\n</code></pre></p>"},{"location":"Android/Kotlin/livedata/#lifecycle-awareness","title":"Lifecycle awareness:","text":"<p>Una de les caracter\u00edstiques m\u00e9s potents de LiveData \u00e9s la seva consci\u00e8ncia del cicle de vida dels components d'Android.</p> <p>La funci\u00f3 observe nom\u00e9s s'executar\u00e0 si el fragment \u00e9s visible.</p>"},{"location":"Android/Kotlin/livedata/#escenaris-practics","title":"Escenaris pr\u00e0ctics:","text":"<ul> <li>App passa a background: LiveData deixa d'enviar actualitzacions</li> <li>App torna a foreground: LiveData envia l'\u00faltima dada disponible</li> <li>Rotaci\u00f3 de pantalla: El nou Activity/Fragment rep autom\u00e0ticament l'\u00faltima dada</li> <li>Fragment destru\u00eft: L'observador s'elimina autom\u00e0ticament, no hi ha memory leaks</li> </ul> <p>Beneficis:</p> <ul> <li>No cal fer removeObserver() manualment</li> <li>No hi ha crashes per actualitzar vistes que ja no existeixen</li> <li>No es processen actualitzacions quan la UI no \u00e9s visible</li> </ul>"},{"location":"Android/Kotlin/livedata/#4-tipus-de-livedata","title":"4. Tipus de LiveData","text":""},{"location":"Android/Kotlin/livedata/#livedata-immutable-nomes-lectura","title":"LiveData immutable (nom\u00e9s lectura)","text":"<p>LiveData \u00e9s la classe base que proporciona nom\u00e9s capacitats de lectura. Els observadors poden rebre dades per\u00f2 no modificar-les directament.</p> <p>Caracter\u00edstiques:</p> <ul> <li>No t\u00e9 m\u00e8todes p\u00fablics per modificar el valor</li> <li>S'utilitza per exposar dades a la UI</li> <li>Garanteix que la UI no pugui modificar les dades del ViewModel</li> </ul> <p>Declaraci\u00f3: <pre><code>val nomUsuari: LiveData&lt;String&gt;  // Nom\u00e9s lectura\n</code></pre></p>"},{"location":"Android/Kotlin/livedata/#mutablelivedata-lectura-i-escriptura","title":"MutableLiveData (lectura i escriptura)","text":"<p>MutableLiveData \u00e9s una subclasse de LiveData que afegeix els m\u00e8todes setValue() i postValue() per modificar el valor.</p> <p>Caracter\u00edstiques:</p> <ul> <li>Permet modificar el valor de les dades</li> <li>S'utilitza internament al ViewModel</li> <li>No s'hauria d'exposar directament a la UI</li> </ul>"},{"location":"Android/Kotlin/livedata/#declaracio","title":"Declaraci\u00f3:","text":"<pre><code>private val _nomUsuari = MutableLiveData&lt;String&gt;()  // Privat i mutable\nval nomUsuari: LiveData&lt;String&gt; = _nomUsuari  // P\u00fablic i immutable\n</code></pre>"},{"location":"Android/Kotlin/livedata/#5-integracio-livedata-amb-viewmodel","title":"5. Integraci\u00f3 LiveData amb ViewModel","text":""},{"location":"Android/Kotlin/livedata/#com-declarar-livedata-dins-del-viewmodel","title":"Com declarar LiveData dins del ViewModel","text":"<p>La declaraci\u00f3 correcta de LiveData al ViewModel segueix un patr\u00f3 espec\u00edfic que garanteix l'encapsulaci\u00f3 i la separaci\u00f3 de responsabilitats.</p> <p>Patr\u00f3 recomanat:</p> <p><pre><code>class ProducteViewModel : ViewModel() {\n    // 1. Declarar MutableLiveData PRIVAT\n    private val _producte = MutableLiveData&lt;Producte&gt;()\n\n    // 2. Exposar LiveData immutable P\u00daBLIC\n    val producte: LiveData&lt;Producte&gt; = _producte\n\n    // 3. Funcions per modificar les dades\n    fun carregarProducte(id: Int) {\n        _producte.value = repositori.obtenirProducte(id)\n    }\n}\n</code></pre> Amb valors inicials: <pre><code>class ContadorViewModel : ViewModel() {\n    private val _contador = MutableLiveData&lt;Int&gt;(0)  // Valor inicial: 0\n    val contador: LiveData&lt;Int&gt; = _contador\n\n    private val _nomUsuari = MutableLiveData&lt;String&gt;().apply {\n        value = \"Usuari desconegut\"  // Alternativa per valor inicial\n    }\n    val nomUsuari: LiveData&lt;String&gt; = _nomUsuari\n}\n</code></pre> Amb tipus complexos: <pre><code>data class EstatUI(\n    val carregant: Boolean = false,\n    val dades: List&lt;String&gt; = emptyList(),\n    val error: String? = null\n)\n\nclass DadesViewModel : ViewModel() {\n    private val _estat = MutableLiveData&lt;EstatUI&gt;(EstatUI())\n    val estat: LiveData&lt;EstatUI&gt; = _estat\n\n    fun carregarDades() {\n        _estat.value = EstatUI(carregant = true)\n        // ... l\u00f2gica de c\u00e0rrega\n    }\n}\n</code></pre></p> <p>Exposar LiveData immutable per\u00f2 mantenir MutableLiveData privat</p> <p>Aquest patr\u00f3 \u00e9s fonamental per mantenir l'encapsulaci\u00f3 i seguir els principis de disseny d'Android.</p> <p>Per qu\u00e8 \u00e9s important:</p> <ul> <li>Encapsulaci\u00f3: La UI no pot modificar directament les dades</li> <li>\u00danic punt de control: Nom\u00e9s el ViewModel pot canviar les dades</li> <li>Mantenibilitat: M\u00e9s f\u00e0cil de depurar i mantenir</li> <li>Testabilitat: Pots provar el ViewModel sense preocupar-te per modificacions externes</li> </ul>"},{"location":"Android/Kotlin/livedata/#6-exemple-complet-amb-multiples-livedata","title":"6. Exemple complet amb m\u00faltiples LiveData:","text":"<p><pre><code>class CarretCompraViewModel : ViewModel() {\n    // Articles del carret\n    private val _articles = MutableLiveData&lt;List&lt;Article&gt;&gt;(emptyList())\n    val articles: LiveData&lt;List&lt;Article&gt;&gt; = _articles\n\n    // Total del carret\n    private val _total = MutableLiveData&lt;Double&gt;(0.0)\n    val total: LiveData&lt;Double&gt; = _total\n\n    // Estat de c\u00e0rrega\n    private val _carregant = MutableLiveData&lt;Boolean&gt;(false)\n    val carregant: LiveData&lt;Boolean&gt; = _carregant\n\n    fun afegirArticle(article: Article) {\n        val llistaActual = _articles.value?.toMutableList() ?: mutableListOf()\n        llistaActual.add(article)\n        _articles.value = llistaActual\n        calcularTotal()\n    }\n\n    fun eliminarArticle(article: Article) {\n        val llistaActual = _articles.value?.toMutableList() ?: return\n        llistaActual.remove(article)\n        _articles.value = llistaActual\n        calcularTotal()\n    }\n\n    private fun calcularTotal() {\n        val articles = _articles.value ?: emptyList()\n        _total.value = articles.sumOf { it.preu }\n    }\n}\n</code></pre> \u00das a l'Activity/Fragment: <pre><code>class CarretActivity : AppCompatActivity() {\n    private val viewModel: CarretCompraViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        // La UI nom\u00e9s pot observar, no modificar\n        viewModel.articles.observe(this) { articles -&gt;\n            actualitzarLlistaUI(articles)\n        }\n\n        viewModel.total.observe(this) { total -&gt;\n            textViewTotal.text = \"Total: $total\u20ac\"\n        }\n\n        // Les modificacions es fan a trav\u00e9s del ViewModel\n        buttonAfegir.setOnClickListener {\n            viewModel.afegirArticle(articleSeleccionat)\n        }\n    }\n}\n</code></pre></p>"},{"location":"Android/Kotlin/livedata/#separacio-entre-logica-de-negoci-i-ui","title":"Separaci\u00f3 entre l\u00f2gica de negoci i UI","text":"<p>La separaci\u00f3 adequada entre l\u00f2gica de negoci (ViewModel) i UI (Activity/Fragment) \u00e9s essencial per mantenir un codi net i mantenible.</p> <p>Responsabilitats del ViewModel:</p> <ul> <li>Mantenir i gestionar les dades de la UI</li> <li>Implementar la l\u00f2gica de negoci</li> <li>Comunicar-se amb repositoris o fonts de dades</li> <li>Processar i transformar dades</li> <li>Gestionar l'estat de l'aplicaci\u00f3</li> </ul> <p>Responsabilitats de la UI:</p> <ul> <li>Observar les dades del ViewModel</li> <li>Mostrar les dades a l'usuari</li> <li>Capturar events de l'usuari</li> <li>Cridar funcions del ViewModel en resposta a events</li> <li>Gestionar elements visuals (animacions, di\u00e0legs, etc.)</li> </ul>"},{"location":"Android/Kotlin/livedata/#referencies","title":"Refer\u00e8ncies","text":"<p>Livedata (amb viewbinding) https://cursokotlin.com/mvvm-en-android-con-kotlin-livedata-y-view-binding-android-architecture-components/</p> <p>Video de Devexperto: https://www.youtube.com/watch?v=LHBbs6QXvic</p>"},{"location":"Android/Kotlin/livedata/#codelab","title":"Codelab","text":"<p>https://developer.android.com/codelabs/basic-android-kotlin-training-livedata?hl=es-419#0</p>"},{"location":"Android/Kotlin/nullsafety/","title":"Null Safety","text":""},{"location":"Android/Kotlin/nullsafety/#variables-i-seguretat-amb-valors-nuls","title":"Variables i seguretat amb valors nuls","text":"<p>Un dels trets m\u00e9s distintius \u00e9s com gestiona els valors nuls:</p> <ul> <li>Una variable normal no pot tenir null. <pre><code>val nom: String = \"David\"\n</code></pre></li> </ul> <p>Si volem permetre valors nuls, aquell mateix tipus es converteix en un tipus diferent.</p> <ul> <li> <p>Int? \u00e9s diferent de Int</p> </li> <li> <p>String? \u00e9s diferent de String</p> </li> </ul> <pre><code>val nom: String? = null\n</code></pre> <p>En Kotlin, si una variable pot ser null, el compilador obliga el programador a gestionar el cas null abans d\u2019utilitzar-la. Aquest sistema evita molts errors freq\u00fcents en llenguatges m\u00e9s antics.</p>"},{"location":"Android/Kotlin/nullsafety/#operadors-per-gestionar-nulabilitat-de-variables","title":"Operadors per gestionar nulabilitat de variables","text":""},{"location":"Android/Kotlin/nullsafety/#operador-dacces-segur","title":"Operador d\u2019acc\u00e9s segur ?.","text":"<p>Serveix per accedir a una propietat o funci\u00f3 nom\u00e9s quan el valor no \u00e9s null.</p> <pre><code>val nom: String? = \"David\"\nprintln(nom?.length)\n</code></pre> <p>Tamb\u00e9 el compilador sap si hem comprovat la nullabilitat: <pre><code>val nom: String? = \"David\"\nif (nom != null){\n    println(nom.length)\n}\n</code></pre> En aquest cas, no cal utilitzar l'operador ?.</p>"},{"location":"Android/Kotlin/nullsafety/#operador-elvis","title":"Operador Elvis ?:","text":"<p>Permet donar un valor alternatiu quan la variable \u00e9s null. <pre><code>val nom: String? = null\nval resultat = nom ?: \"Desconegut\"\nprintln(resultat)\n</code></pre></p>"},{"location":"Android/Kotlin/nullsafety/#operador-de-no-null-forcat","title":"Operador de no-null for\u00e7at !!","text":"<p>\u00c9s com dir: \"estic segur que no \u00e9s null\", (o capturar l'excepci\u00f3 si ho \u00e9s).</p> <pre><code>val nom: String? = null\nprintln(nom!!.length) // Error en execuci\u00f3!\n</code></pre> <ul> <li>Si la variable \u00e9s null \u2192 el programa falla.</li> <li>Nom\u00e9s s\u2019ha d\u2019utilitzar si es t\u00e9 la certesa que no ser\u00e0 null.</li> </ul>"},{"location":"Android/Kotlin/nullsafety/#funcio-let-combinada-amb","title":"Funci\u00f3 let combinada amb ?.","text":"<p>S\u2019executa el bloc nom\u00e9s si el valor no \u00e9s null. <pre><code>val nom: String? = \"David\"\nnom?.let {\n    println(\"El nom t\u00e9 ${it.length} lletres\")\n}\n</code></pre></p>"},{"location":"Android/Kotlin/variables/","title":"Variables i Constants","text":"<p>## Variebles en Kotlin</p> <p>Existeixen dues formes principals de declarar variables</p> <p>Kotlin diferencia clarament entre variables que poden canviar el seu contingut i variables que no.</p>"},{"location":"Android/Kotlin/variables/#declaracio","title":"Declaraci\u00f3","text":""},{"location":"Android/Kotlin/variables/#val-variables-inmutables","title":"val \u2013 Variables inmutables","text":"<ul> <li>Representen valors constants o no modificables.</li> <li>Un cop assignades, no es poden canviar.</li> <li>Equivaldria a una constant o a una variable final en altres llenguatges.</li> <li>S\u00f3n recomanades per defecte perqu\u00e8 fan el codi m\u00e9s segur i previsible.</li> </ul>"},{"location":"Android/Kotlin/variables/#var-variables-mutables","title":"var \u2013 Variables mutables","text":"<ul> <li>Es poden modificar despr\u00e9s de declarar-les.</li> <li>S\u2019utilitzen quan el valor realment ha de canviar amb el temps.</li> <li>L\u2019\u00fas de var \u00e9s \u00fatil, per\u00f2 no abusiu; Kotlin fomenta l\u2019immutabilitat sempre que sigui possible.</li> </ul>"},{"location":"Android/Kotlin/variables/#tipus-explicits-o-implicits","title":"Tipus expl\u00edcits o impl\u00edcits","text":"<p>Kotlin \u00e9s un llenguatge fortament tipat.</p> <p>Kotlin permet indicar el tipus de la variable, per\u00f2 no sempre \u00e9s necessari.</p> <p>Gr\u00e0cies a la infer\u00e8ncia de tipus, el compilador pot deduir quin tipus \u00e9s segons el valor assignat.</p> <p>Tot i aix\u00f2, els tipus existeixen i s\u00f3n importants: </p>"},{"location":"Android/Kotlin/variables/#condicionals-if-com-expressio","title":"Condicionals (if com expressi\u00f3)","text":"<p>les sentencies if, when poden retornar valors <pre><code>val edat = 20\nval missatge = if (edat &gt;= 18) \"Major d'edat\" else \"Menor d'edat\"\n\nprintln(missatge)\n</code></pre></p> <p>La variable missatge obt\u00e9 directament un resultat. </p> <p>No cal declarar primer la variable i despr\u00e9s assignar un valor.</p>"},{"location":"Android/Llibreries/","title":"Llibreries","text":""},{"location":"Android/Llibreries/#arxiu-gradle","title":"Arxiu Gradle","text":""},{"location":"Android/Llibreries/#format-toml","title":"Format toml","text":"<p>Continguts:</p> <ul> <li>Retrofit</li> </ul>"},{"location":"Android/Llibreries/mpandroidchart/","title":"Gr\u00e0fics amb MPAndroidChart","text":""},{"location":"Android/Llibreries/mpandroidchart/#1-que-es-mpandroidchart","title":"1. Qu\u00e8 \u00e9s MPAndroidChart?","text":"<p>MPAndroidChart \u00e9s una llibreria molt utilitzada per mostrar gr\u00e0fics estad\u00edstics en aplicacions Android, com ara: - Gr\u00e0fics de barres (BarChart) - Gr\u00e0fics de l\u00ednies (LineChart) - Gr\u00e0fics de sectors (PieChart)</p>"},{"location":"Android/Llibreries/mpandroidchart/#2-afegir-la-llibreria-al-projecte","title":"2. Afegir la llibreria al projecte","text":"<p>Al fitxer build.gradle (Module: app):</p> <pre><code>dependencies {\n    implementation(\"com.github.PhilJay:MPAndroidChart:v3.1.0\")\n}\n</code></pre> <p>Despr\u00e9s fes Sync Now.</p>"},{"location":"Android/Llibreries/mpandroidchart/#3-afegir-un-grafic-al-layout-xml","title":"3. Afegir un gr\u00e0fic al layout (XML)","text":"<p>Exemple d\u2019un LineChart a <code>activity_main.xml</code>:</p> <pre><code>&lt;com.github.mikephil.charting.charts.LineChart\n    android:id=\"@+id/lineChart\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"300dp\"\n    android:layout_margin=\"16dp\" /&gt;\n</code></pre> <p>Altres opcions habituals: - <code>BarChart</code> - <code>PieChart</code></p>"},{"location":"Android/Llibreries/mpandroidchart/#4-preparar-les-dades","title":"4. Preparar les dades","text":"<p>En un arxiu Datasource</p> <pre><code>object dades {\n    val entries = listOf&lt;Entry&gt;(\n    Entry(1f, 10f),\n    Entry(2f, 15f),\n    Entry(3f, 12f),\n    Entry(4f, 20f))\n}\n</code></pre> <p>\ud83d\udccc Cada <code>Entry(x, y)</code> representa un punt del gr\u00e0fic.</p>"},{"location":"Android/Llibreries/mpandroidchart/#5-crear-el-dataset-per-al-grafic","title":"5. Crear el DataSet per al gr\u00e0fic.","text":"<p>En l'activity <pre><code>val lineChart = findViewById&lt;LineChart&gt;(R.id.lineChart)\nval dataSet = LineDataSet(dades.entries, \"Vendes mensuals\")\ndataSet.color = Color.BLUE\ndataSet.setCircleColor(Color.RED)\ndataSet.valueTextSize = 12f\ndataSet.lineWidth = 2f\n</code></pre></p>"},{"location":"Android/Llibreries/mpandroidchart/#6-assignar-les-dades-al-grafic","title":"6. Assignar les dades al gr\u00e0fic.","text":"<pre><code>val data = LineData(dataSet)\nlineChart.data = data\nlineChart.description.text = \"Informe de vendes\"\nlineChart.invalidate()\n</code></pre>"},{"location":"Android/Llibreries/retrofit/","title":"\u00das de la llibreria Retrofit en Android (Kotlin)","text":""},{"location":"Android/Llibreries/retrofit/#1-introduccio","title":"1. Introducci\u00f3","text":"<p>En el desenvolupament d'aplicacions Android modernes \u00e9s molt habitual consumir dades des d'una API REST. Per facilitar aquesta tasca, una de les llibreries m\u00e9s utilitzades \u00e9s Retrofit, desenvolupada per Square.</p> <p>Retrofit permet: - Fer peticions HTTP de manera senzilla - Convertir autom\u00e0ticament les respostes JSON en objectes Kotlin - Integrar-se f\u00e0cilment amb RecyclerView, ViewModel i Coroutines</p> <p>Exemple retrofit. https://github.com/davidfs-itic/RecyclerView</p> <p>Explicaci\u00f3 pas a pas Retrofit: https://www.youtube.com/watch?v=2_DnhfQrwXQ</p>"},{"location":"Android/Llibreries/retrofit/#2-que-es-retrofit","title":"2. Qu\u00e8 \u00e9s Retrofit?","text":"<p>Retrofit \u00e9s una llibreria client HTTP que: - Defineix les crides a l'API mitjan\u00e7ant interf\u00edcies - Utilitza anotacions per indicar el tipus de petici\u00f3 (<code>@GET</code>, <code>@POST</code>, etc.) - Converteix les respostes (normalment JSON) en objectes Kotlin mitjan\u00e7ant convertidors com Gson</p> <p>Retrofit no \u00e9s una API REST, sin\u00f3 una eina per consumir-ne.</p>"},{"location":"Android/Llibreries/retrofit/#3-dependencies-necessaries","title":"3. Depend\u00e8ncies necess\u00e0ries","text":"<p>Cal acc\u00e9s a internet des de l'aplicaci\u00f3: (AndroidManifest.xml) <pre><code>&lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;\n</code></pre></p> <p>Afegir depend\u00e8ncies en el build.gradle (build.gradle Module)</p> <p>De forma tradicional, present en molta documentaci\u00f3: (ens demanar\u00e0 si volem transformar-la a format libs.version.toml)</p> <pre><code>dependencies {\n    // Retrofit Core\n    implementation(\"com.squareup.retrofit2:retrofit:2.9.0\")\n    // Converter per gestionar JSON (Generalment es fa servir GSON)\n    implementation(\"com.squareup.retrofit2:converter-gson:2.9.0\")\n    // (Opcional) Interceptor per poder veure els logs de les peticions (molt \u00fatil per a debug)\n    implementation(\"com.squareup.okhttp3:logging-interceptor:4.12.0\")\n}\n</code></pre> <p>Sincronitza el projecte despr\u00e9s d'afegir-les.</p>"},{"location":"Android/Llibreries/retrofit/#4-exemple-de-lapi","title":"4. Exemple de l'API","text":"<p>Suposem que la nostra API t\u00e9 aquest endpoint:</p> <pre><code>GET https://api.exemple.com/items\n</code></pre> <p>I retorna una resposta JSON similar a:</p> <pre><code>[\n  {\n    \"id\": 1,\n    \"nom\": \"Item 1\",\n    \"descripcio\": \"Descripci\u00f3 del primer item\"\n  },\n  {\n    \"id\": 2,\n    \"nom\": \"Item 2\",\n    \"descripcio\": \"Descripci\u00f3 del segon item\"\n  }\n]\n</code></pre>"},{"location":"Android/Llibreries/retrofit/#5-model-de-dades-item","title":"5. Model de dades (<code>Item</code>)","text":"<p>Creem una data class que representi l'objecte que retorna l'API:</p> <pre><code>data class Item(\n    val id: Int,\n    val nom: String,\n    val descripcio: String\n)\n</code></pre> <p>Els noms dels atributs han de coincidir amb els camps del JSON.</p>"},{"location":"Android/Llibreries/retrofit/#6-implementacio","title":"6. Implementaci\u00f3","text":""},{"location":"Android/Llibreries/retrofit/#61-interficie-itemsservice","title":"6.1 Interf\u00edcie <code>ItemsService</code>","text":"<pre><code>interface ItemsService {\n\n    @GET(\"items/\")\n    suspend fun llistaItems(): Response&lt;List&lt;Item&gt;&gt;\n\n    @GET(\"items/categoria/{idcategoria}\")\n    suspend fun llistaItemsPerCategoria(\n        @Path(\"idcategoria\") idcategoria: Int\n    ): Response&lt;List&lt;Item&gt;&gt;\n}\n</code></pre>"},{"location":"Android/Llibreries/retrofit/#explicacio-pas-a-pas","title":"Explicaci\u00f3 pas a pas","text":"<ul> <li><code>interface ItemsService</code></li> <li>Defineix el contracte de comunicaci\u00f3 amb l'API.</li> <li> <p>Retrofit crear\u00e0 autom\u00e0ticament la implementaci\u00f3.</p> </li> <li> <p><code>@GET(\"items/\")</code></p> </li> <li> <p>Indica una petici\u00f3 HTTP GET a l'endpoint <code>/items/</code>.</p> </li> <li> <p><code>suspend fun llistaItems()</code></p> </li> <li>\u00c9s una funci\u00f3 suspend, per tant s'ha d'executar dins d'una coroutine.</li> <li> <p>Permet fer la crida sense bloquejar el fil principal.</p> </li> <li> <p><code>Response&lt;List&lt;Item&gt;&gt;</code></p> </li> <li> <p>Cont\u00e9 tant les dades com la informaci\u00f3 HTTP (codi, error, etc.).</p> </li> <li> <p><code>@Path(\"idcategoria\")</code></p> </li> <li>Substitueix <code>{idcategoria}</code> per el valor rebut com a par\u00e0metre.</li> </ul>"},{"location":"Android/Llibreries/retrofit/#62-classe-itemapi-singleton","title":"6.2 Classe <code>ItemAPI</code> (Singleton)","text":"<pre><code>class ItemAPI {\n    companion object {\n        private var mItemAPI: ItemService? = null\n\n        @Synchronized\n        fun API(): ItemService {\n            if (mItemAPI == null) {\n\n                val gsondateformat = GsonBuilder()\n                    .setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\")\n                    .create()\n\n                mItemAPI = Retrofit.Builder()\n                    .addConverterFactory(GsonConverterFactory.create(gsondateformat))\n                    .baseUrl(\"https://oracleitic.mooo.com/\")\n                    .build()\n                    .create(ItemService::class.java)\n            }\n            return mItemAPI!!\n        }\n    }\n}\n</code></pre>"},{"location":"Android/Llibreries/retrofit/#que-fa-aquesta-classe","title":"Qu\u00e8 fa aquesta classe?","text":"<p>Aquesta classe s'encarrega de: - Crear una sola inst\u00e0ncia de Retrofit - Garantir que totes les crides utilitzen la mateixa configuraci\u00f3</p> <p>\u00c9s un patr\u00f3 Singleton.</p>"},{"location":"Android/Llibreries/retrofit/#63-explicacio-detallada","title":"6.3 Explicaci\u00f3 detallada","text":"<ul> <li><code>companion object</code></li> <li> <p>Permet accedir a la funci\u00f3 <code>API()</code> sense crear un objecte <code>ItemAPI</code>.</p> </li> <li> <p><code>private var mItemAPI</code></p> </li> <li> <p>Desa la inst\u00e0ncia del servei Retrofit.</p> </li> <li> <p><code>@Synchronized</code></p> </li> <li> <p>Evita que dos fils cre\u00efn l'objecte al mateix temps.</p> </li> <li> <p><code>GsonBuilder().setDateFormat(...)</code></p> </li> <li> <p>Permet convertir correctament dates en format ISO.</p> </li> <li> <p><code>baseUrl(...)</code></p> </li> <li>URL base del servidor.</li> <li> <p>Sempre ha d'acabar amb <code>/</code>.</p> </li> <li> <p><code>create(ItemService::class.java)</code></p> </li> <li>Retrofit genera la implementaci\u00f3 autom\u00e0ticament.</li> </ul>"},{"location":"Android/Llibreries/retrofit/#64-exemple-dus-en-un-viewmodel","title":"6.4 Exemple d'\u00fas en un ViewModel","text":"<pre><code>viewModelScope.launch {\n    try {\n        val response = ItemAPI.API().llistaItems()\n\n        if (response.isSuccessful) {\n            val items = response.body() ?: emptyList()\n        } else {\n            Log.e(\"API\", \"Error HTTP: ${response.code()}\")\n        }\n    } catch (e: Exception) {\n        Log.e(\"API\", \"Error de connexi\u00f3\")\n    }\n}\n</code></pre>"},{"location":"Android/Llibreries/retrofit/#explicacio","title":"Explicaci\u00f3","text":"<p><code>viewModelScope.launch { ... }</code></p> <ul> <li>Executa el codi dins d'una coroutine.</li> <li>viewModelScope est\u00e0 lligat al cicle de vida del ViewModel.</li> <li>Quan el ViewModel es destrueix, la coroutine es cancel\u00b7la autom\u00e0ticament.</li> <li>Evita fuites de mem\u00f2ria (memory leaks).</li> </ul> <p><code>try { ... } catch (e: Exception)</code></p> <ul> <li>Permet capturar errors de xarxa o connexi\u00f3.</li> <li>Retrofit llan\u00e7a excepcions en casos com:</li> <li>Sense connexi\u00f3 a internet</li> <li>Timeout</li> <li>Servidor inabastable</li> </ul> <p><code>val response = ItemAPI.API().llistaItems()</code></p> <ul> <li>Crida a l'API mitjan\u00e7ant Retrofit.</li> <li>Aquesta funci\u00f3 \u00e9s suspend, per tant:<ul> <li>No bloqueja el fil principal</li> <li>S'executa en segon pla</li> </ul> </li> <li>API() retorna la inst\u00e0ncia Singleton del servei.</li> </ul> <p><code>if (response.isSuccessful)</code></p> <ul> <li>Comprova si el servidor ha retornat un codi HTTP entre 200 i 299.</li> <li>Nom\u00e9s en aquest cas es considera una resposta correcta.</li> <li>val items = response.body() ?: emptyList()</li> <li>response.body() cont\u00e9 la llista d'Item rebuda.</li> <li>Pot ser null si el servidor no envia cos.</li> <li>L'operador ?: evita errors retornant una llista buida.</li> </ul> <p><code>else { Log.e(\"API\", \"Error HTTP: ${response.code()}\") }</code></p> <ul> <li>Gestiona errors HTTP com:</li> <li>404 \u2192 recurs no trobat</li> <li>500 \u2192 error del servidor</li> <li>response.code() retorna el codi HTTP.</li> </ul> <p><code>catch (e: Exception)</code></p> <ul> <li>Captura errors que no s\u00f3n HTTP.</li> <li>Errors t\u00edpics:</li> <li>Connexi\u00f3 fallida</li> <li>Tall de xarxa</li> <li>Error DNS</li> </ul>"},{"location":"Android/Llibreries/retrofit/#7-retrofit-sense-certificats-nomes-per-a-debug","title":"7. Retrofit sense certificats (NOMES PER A DEBUG)","text":"<p>Si utlitzem una APi, i aquesta no esta configurada amb cerficats v\u00e0lids, Retrofit no ens connectar\u00e0.</p> <p>Caldra afegir una llibreria: okhttp3</p> <pre><code>dependencies {\n    // altres depend\u00e8ncies    \n    implementation(\"com.squareup.okhttp3:okhttp:4.12.0\")\n}\n</code></pre> <p>Cal fer la seguent modificaci\u00f3 a la api:</p> <p><pre><code>class ItemAPI {\n    companion object {\n        private var mItemAPI: ItemService? = null\n\n        @Synchronized\n        fun API(): ItemService {\n            if (mItemAPI == null) {\n\n                val gsondateformat = GsonBuilder()\n                    .setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\")\n                    .create()\n\n                // Client HTTP insegur (nom\u00e9s per desenvolupament)\n                val unsafeOkHttpClient = getUnsafeOkHttpClient()\n\n                mItemAPI = Retrofit.Builder()\n                    .addConverterFactory(GsonConverterFactory.create(gsondateformat))\n                    .baseUrl(\"https://oracleitic.mooo.com/\")\n                    .client(unsafeOkHttpClient) // Afegeix el client\n                    .build()\n                    .create(ItemService::class.java)\n            }\n            return mItemAPI!!\n        }\n\n        private fun getUnsafeOkHttpClient(): OkHttpClient {\n            try {\n                // Crea un trust manager que NO valida certificats\n                val trustAllCerts = arrayOf&lt;TrustManager&gt;(\n                    object : X509TrustManager {\n                        override fun checkClientTrusted(chain: Array&lt;X509Certificate&gt;, authType: String) {}\n                        override fun checkServerTrusted(chain: Array&lt;X509Certificate&gt;, authType: String) {}\n                        override fun getAcceptedIssuers(): Array&lt;X509Certificate&gt; = arrayOf()\n                    }\n                )\n\n                // Instal\u00b7la el trust manager\n                val sslContext = SSLContext.getInstance(\"SSL\")\n                sslContext.init(null, trustAllCerts, java.security.SecureRandom())\n                val sslSocketFactory = sslContext.socketFactory\n\n                return OkHttpClient.Builder()\n                    .sslSocketFactory(sslSocketFactory, trustAllCerts[0] as X509TrustManager)\n                    .hostnameVerifier { _, _ -&gt; true } // Accepta qualsevol hostname\n                    .build()\n\n            } catch (e: Exception) {\n                throw RuntimeException(e)\n            }\n        }\n    }\n}\n</code></pre>  Amb els imports corresponents</p> <pre><code>import okhttp3.OkHttpClient\nimport java.security.cert.X509Certificate\nimport javax.net.ssl.SSLContext\nimport javax.net.ssl.TrustManager\nimport javax.net.ssl.X509TrustManager\n</code></pre>"},{"location":"Android/Llibreries/retrofit/#8-altra-informacio","title":"8. Altra informaci\u00f3","text":"<p>Veure Kotlin/Anotadors</p> <p>Veure Kotlin/Corrutines</p> <p>RETROFIT 2 AVANZADO en KOTLIN - (POST, GET, MULTIPART, HEADER...) - Android Studio 2022</p>"},{"location":"Arduino/","title":"Arduino","text":"<p>(!Per Fer)</p>"},{"location":"Exemples/","title":"Adreces de github amb exemples","text":""},{"location":"Exemples/#1-menus","title":"1. Men\u00fas","text":"<p>https://github.com/davidfs-itic/menus</p>"},{"location":"Exemples/#2-recycler-view","title":"2. Recycler view","text":"<p>https://github.com/davidfs-itic/RecyclerView</p>"},{"location":"Exemples/#3-desplegar-api-en-contenidor","title":"3. Desplegar api en contenidor","text":"<p>https://github.com/davidfs-itic/Projecte_API_Reserves</p>"},{"location":"Exemples/#4-rollingdiceclean","title":"4. RollingDiceClean","text":"<p>Cont\u00e9 tamb\u00e9 com utilitzar el ViewModel.</p> <p>https://github.com/davidfs-itic/RollingDiceClean</p>"},{"location":"Exemples/#5-springboot-amb-kotlin","title":"5. Springboot amb Kotlin","text":"<p>Projecte de prova que crea una api amb springboot i kotlin, i la desplega autom\u00e0ticament en un servidor AWS, mitjan\u00e7ant Github Actions.</p> <p>Note</p> <p>Vegeu l'arxiu que hi ha a .github/workflows per veure les instruccions de desplegament.</p> <p>https://github.com/davidfs-itic/firstspringboot</p>"},{"location":"IoT/","title":"IoT","text":"<ul> <li>Introduccio</li> <li>Arquitectura IoT</li> <li>Casos d'\u00fas</li> <li>M\u00f2dul Optatiu Iot</li> <li>IIoT</li> </ul>"},{"location":"IoT/#introduccio","title":"Introducci\u00f3","text":""},{"location":"IoT/#arquitectura","title":"Arquitectura","text":"<ul> <li>Las 4 capas del IoT</li> </ul>"},{"location":"IoT/#casos-dus","title":"Casos d'\u00fas","text":"<ul> <li>Agricultura</li> <li>Botiga Roba</li> </ul>"},{"location":"IoT/#modul-optatiu-iot","title":"Modul Optatiu Iot","text":"<p>Apunts sobre el m\u00f2dul optatiu IoT</p> <p>Programa: programa_iot.pdf</p>"},{"location":"IoT/#treball-amb-instancies-doracle","title":"Treball amb inst\u00e0ncies d'Oracle","text":"<p>Veure apartat IOT/Guia Oracle Cloud </p>"},{"location":"IoT/#documentacio-contenidors","title":"Documentaci\u00f3 Contenidors","text":"<p>Veure apartat Transversal/Docker</p>"},{"location":"IoT/#pila-de-contenidors","title":"Pila de Contenidors","text":"<ul> <li>Grafana</li> <li>Influxdb3</li> <li>Mqtt</li> <li>Node-Red</li> <li>Telegraf</li> <li>ThingsBoard</li> <li>ChirpStack</li> </ul>"},{"location":"IoT/#iiot","title":"IIot","text":"<p>Veure apartat corresponent a IIoT</p>"},{"location":"IoT/oracle/","title":"Oracle Cloud","text":"<p>Operacions amb la infraestrucutra d'Oracle:</p>"},{"location":"IoT/oracle/#registre","title":"Registre","text":"<p>Seguiu les instruccions que haureu rebut per email.</p> <p>[!warning] En cap cas poseu cap n\u00famero de tarja. Amb el compte educatiu no us ho ha de demanar!!</p>"},{"location":"IoT/oracle/#crear-una-instancia","title":"Crear una inst\u00e0ncia","text":"<p>Per crear una nova m\u00e0quina virtual (inst\u00e0ncia) heu d'anar al me\u0144u principal i buscar Compute-&gt;Instances </p>"},{"location":"IoT/oracle/#seleccio-del-tipus-dinstancia","title":"Selecci\u00f3 del tipus d'inst\u00e0ncia","text":"<p>Triar image: ampere i shape: ubuntu</p> <p></p>"},{"location":"IoT/oracle/#clau-publica-per-acceidr-a-la-instancia-per-ssh","title":"Clau p\u00fablica per acceidr a la inst\u00e0ncia per ssh","text":"<p>Per accedir per ssh, cal pujar una clau p\u00fablica en el moment de crear una inst\u00e0ncia. </p> <p>Podeu obrir una clau que ja tingueu amb un editor de text i fer copiar/pegar.</p> <p></p> <p>Si no teniu cap clau generada, o voleu crear-ne una espec\u00edficament per aquesta inst\u00e0ncia (o totes les de oracle, recomenat!!), podeu executar la seg\u00fcent comanda que us generar\u00e0 un parell clau p\u00fablica/clau privada:</p> <p>[!NOTE]     Executeu aquesta comanda en la carpeta .ssh del vostre home dir</p> <p>[!WARNING] Comproveu qu\u00e8 fan aquestes opcions de ssh-keygen <pre><code>ssh-keygen -t rsa -b 4096 -C \"oracle-key\" -f oracle.key -N \"\"\n</code></pre></p> <p>Aix\u00f3 crear\u00e0 un arxiu oracke.key, i un arxiu oracle.key.pub. Aquest \u00faltim \u00e9s el que s'ha de copiar i enganxar a la inst\u00e0ncia.</p>"},{"location":"IoT/oracle/#ip-publica-de-la-instancia","title":"Ip publica de la inst\u00e0ncia.","text":"<p>Per defecte s'hauria de crear una ip publica, per\u00f2 si no ho f\u00e0, caldr\u00e0 anar a:</p> <p>Inst\u00e0ncia-&gt;Networking-&gt;Vnic_instance</p> <p></p> <p>Fer click a la inst\u00e0ncia vnic i:</p> <p>IpAdministration-&gt;Edit</p> <p></p> <p>I ara s\u00ed, triar una ip Ephemereal public ip </p> <p>Refer\u00e8ncia: https://docs.oracle.com/es-ww/iaas/Content/Network/Tasks/assigning-ephemeral-public-existing-private-ip.htm</p>"},{"location":"IoT/oracle/#connexio-a-la-instancia","title":"Connexi\u00f3 a la inst\u00e0ncia","text":"<p>Preneu nota de quina \u00e9s la ip p\u00fablica que se us donar\u00e0 quan s'engegui la inst\u00e0ncia </p> <p>La connexi\u00f3 es realitza per ssh:</p> <pre><code>ssh ubuntu@ippublica -i oracle.key\n</code></pre>"},{"location":"IoT/oracle/#obir-ports-en-oracle-cloud","title":"Obir ports en Oracle Cloud","text":"<p>Per defecte les inst\u00e0ncies nom\u00e9s permeten el pas del protocol ssh al port 22.</p> <p>Si volem instal\u00b7lar un servei espec\u00edfic (com un servidor web), caldr\u00e0 obrir els ports corresponents, en la infraestructura de Oracle:</p> <p>Cada subnet a la qual estigui connectada una inst\u00e0ncia, tindr\u00e0 el seu firewall, o \"Security List\"</p> <p>Cal anar a la inst\u00e0ncia i buscar el seguent cam\u00ed: Netowrk-&gt;Subnet-&gt;Security-&gt;Security List-&gt;Security Rules-&gt;Add ingress rules</p> <p>I all\u00e0 afegir-ne una semblant a la del port 22.</p> <p></p> <pre><code>lkdsjflsf\nsdlkfjsdf\ndsklfsdf\n</code></pre>"},{"location":"IoT/IIoT/","title":"Resum IIoT","text":"<ul> <li>Arquitectura IIoT</li> <li>What is the Digital Factory</li> <li>Typical IIoT Infrastructure</li> </ul>"},{"location":"IoT/IIoT/#protocols","title":"Protocols","text":"<p>Resum dels principals protocols usats en ind\u00f9stria</p>"},{"location":"IoT/IIoT/ethernet-ip/","title":"EtherNet/IP - Llibreries i exemples","text":""},{"location":"IoT/IIoT/ethernet-ip/#introduccio","title":"Introducci\u00f3","text":"<p>EtherNet/IP (Industrial Protocol) \u00e9s un protocol industrial que utilitza CIP (Common Industrial Protocol) sobre TCP/IP i UDP/IP. \u00c9s el protocol natiu dels PLCs Allen-Bradley (Rockwell Automation) i tamb\u00e9 \u00e9s suportat per Omron Sysmac i altres fabricants.</p>"},{"location":"IoT/IIoT/ethernet-ip/#llibreries-disponibles","title":"Llibreries disponibles","text":"Llibreria Llenguatge PLCs suportats Llic\u00e8ncia pycomm3 Python Allen-Bradley (ControlLogix, CompactLogix, Micro800) MIT libplctag C, Python, .NET Allen-Bradley, Omron, Modbus LGPL/MPL ethernet-ip Node.js Allen-Bradley, gen\u00e8ric CIP MIT node-red-contrib-cip-ethernet-ip Node-RED Allen-Bradley MIT"},{"location":"IoT/IIoT/ethernet-ip/#python-pycomm3","title":"Python: pycomm3","text":"<p>La llibreria m\u00e9s popular i ben mantinguda per a Allen-Bradley en Python.</p>"},{"location":"IoT/IIoT/ethernet-ip/#installacio","title":"Instal\u00b7laci\u00f3","text":"<pre><code>pip install pycomm3\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#plcs-suportats","title":"PLCs suportats","text":"<ul> <li>ControlLogix (L6x, L7x, L8x)</li> <li>CompactLogix (L1x, L2x, L3x)</li> <li>Micro800 (810, 820, 830, 850)</li> </ul>"},{"location":"IoT/IIoT/ethernet-ip/#exemple-basic","title":"Exemple b\u00e0sic","text":"<pre><code>from pycomm3 import LogixDriver\n\n# Connexi\u00f3 a un ControlLogix/CompactLogix\nwith LogixDriver('192.168.1.100') as plc:\n    # Llegir un tag\n    result = plc.read('MyTag')\n    print(f\"Valor: {result.value}\")\n    print(f\"Tipus: {result.type}\")\n\n    # Escriure un valor\n    plc.write('MyTag', 1234)\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#llegir-i-escriure-multiples-tags","title":"Llegir i escriure m\u00faltiples tags","text":"<pre><code>from pycomm3 import LogixDriver\n\nwith LogixDriver('192.168.1.100') as plc:\n    # Llegir m\u00faltiples tags (m\u00e9s eficient que llegir un a un)\n    results = plc.read('Tag1', 'Tag2', 'Tag3')\n    for tag in results:\n        print(f\"{tag.tag}: {tag.value}\")\n\n    # Escriure m\u00faltiples tags\n    plc.write(('Tag1', 100), ('Tag2', 200), ('Tag3', 300))\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#treballar-amb-arrays","title":"Treballar amb arrays","text":"<pre><code>from pycomm3 import LogixDriver\n\nwith LogixDriver('192.168.1.100') as plc:\n    # Llegir un array complet\n    array_data = plc.read('MyArray')\n    print(array_data.value)  # Llista de valors\n\n    # Llegir una porci\u00f3 de l'array (10 elements des de l'\u00edndex 5)\n    partial = plc.read('MyArray[5]{10}')\n\n    # Escriure a un array\n    plc.write('MyArray', [1, 2, 3, 4, 5])\n\n    # Escriure a una posici\u00f3 espec\u00edfica\n    plc.write('MyArray[0]', 100)\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#treballar-amb-estructures-udt","title":"Treballar amb estructures (UDT)","text":"<pre><code>from pycomm3 import LogixDriver\n\nwith LogixDriver('192.168.1.100') as plc:\n    # Llegir una estructura completa\n    recipe = plc.read('Recipe1')\n    print(recipe.value)  # Retorna un diccionari amb tots els membres\n    # Exemple: {'Name': 'Recipe A', 'Temperature': 75.5, 'Time': 120}\n\n    # Llegir un membre espec\u00edfic\n    temp = plc.read('Recipe1.Temperature')\n    print(f\"Temperatura: {temp.value}\")\n\n    # Escriure a un membre de l'estructura\n    plc.write('Recipe1.Temperature', 80.0)\n\n    # Escriure estructura completa\n    plc.write('Recipe1', {'Name': 'Recipe B', 'Temperature': 85.0, 'Time': 150})\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#obtenir-llista-de-tags-del-plc","title":"Obtenir llista de tags del PLC","text":"<pre><code>from pycomm3 import LogixDriver\n\nwith LogixDriver('192.168.1.100') as plc:\n    # Obtenir tots els tags\n    tags = plc.get_tag_list()\n\n    for tag in tags:\n        print(f\"Nom: {tag['tag_name']}\")\n        print(f\"Tipus: {tag['data_type']}\")\n        print(f\"Dimensi\u00f3: {tag.get('dimensions', 'N/A')}\")\n        print(\"---\")\n\n    # Filtrar per programa\n    program_tags = plc.get_tag_list(program='MainProgram')\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#connexio-amb-slot-especific","title":"Connexi\u00f3 amb slot espec\u00edfic","text":"<pre><code>from pycomm3 import LogixDriver\n\n# Per defecte, slot 0\nwith LogixDriver('192.168.1.100') as plc:\n    pass\n\n# Especificar slot (per exemple, slot 2)\nwith LogixDriver('192.168.1.100/2') as plc:\n    pass\n\n# Ruta completa per a configuracions m\u00e9s complexes\nwith LogixDriver('192.168.1.100', path='1/0/2/192.168.2.100/0') as plc:\n    pass\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#gestio-derrors","title":"Gesti\u00f3 d'errors","text":"<pre><code>from pycomm3 import LogixDriver\nfrom pycomm3.exceptions import CommError, ResponseError\n\ntry:\n    with LogixDriver('192.168.1.100') as plc:\n        result = plc.read('TagQueNoExisteix')\n\n        if result.error:\n            print(f\"Error llegint tag: {result.error}\")\n        else:\n            print(f\"Valor: {result.value}\")\n\nexcept CommError as e:\n    print(f\"Error de comunicaci\u00f3: {e}\")\nexcept ResponseError as e:\n    print(f\"Error de resposta del PLC: {e}\")\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#python-libplctag","title":"Python: libplctag","text":"<p>Llibreria m\u00e9s gen\u00e8rica que suporta m\u00faltiples fabricants.</p>"},{"location":"IoT/IIoT/ethernet-ip/#installacio_1","title":"Instal\u00b7laci\u00f3","text":"<pre><code>pip install libplctag\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#exemple-basic_1","title":"Exemple b\u00e0sic","text":"<pre><code>from libplctag import Tag\n\n# Configuraci\u00f3 del tag\ntag_path = \"protocol=ab-eip&amp;gateway=192.168.1.100&amp;path=1,0&amp;cpu=LGX&amp;name=MyTag&amp;elem_type=DINT\"\n\n# Crear tag\ntag = Tag()\ntag.create(tag_path)\n\n# Llegir\ntag.read()\nvalue = tag.get_int32(0)\nprint(f\"Valor: {value}\")\n\n# Escriure\ntag.set_int32(0, 5678)\ntag.write()\n\n# Alliberar recursos\ntag.destroy()\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#tipus-de-cpu-suportats","title":"Tipus de CPU suportats","text":"Par\u00e0metre cpu Descripci\u00f3 <code>LGX</code> ControlLogix, CompactLogix <code>PLC5</code> PLC-5 <code>SLC</code> SLC 500 <code>MLGX</code> MicroLogix"},{"location":"IoT/IIoT/ethernet-ip/#exemple-per-omron","title":"Exemple per Omron","text":"<pre><code>from libplctag import Tag\n\n# Omron NJ/NX via EtherNet/IP\ntag_path = \"protocol=ab-eip&amp;gateway=192.168.1.100&amp;path=18,10.10.10.1,1,0&amp;cpu=omron-njnx&amp;name=MyVar\"\n\ntag = Tag()\ntag.create(tag_path)\ntag.read()\nvalue = tag.get_float32(0)\nprint(f\"Valor: {value}\")\ntag.destroy()\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#nodejs-ethernet-ip","title":"Node.js: ethernet-ip","text":""},{"location":"IoT/IIoT/ethernet-ip/#installacio_2","title":"Instal\u00b7laci\u00f3","text":"<pre><code>npm install ethernet-ip\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#exemple-basic_2","title":"Exemple b\u00e0sic","text":"<pre><code>const { Controller, Tag } = require('ethernet-ip');\n\nconst plc = new Controller();\n\n// Connexi\u00f3\nplc.connect('192.168.1.100', 0).then(() =&gt; {\n    console.log('Connectat al PLC');\n    console.log(`Nom: ${plc.properties.name}`);\n    console.log(`Slot: ${plc.properties.slot}`);\n\n    // Crear un tag\n    const myTag = new Tag('MyTag');\n\n    // Llegir\n    plc.readTag(myTag).then(() =&gt; {\n        console.log(`Valor: ${myTag.value}`);\n        console.log(`Tipus: ${myTag.type}`);\n    });\n\n}).catch(err =&gt; {\n    console.error('Error de connexi\u00f3:', err);\n});\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#llegir-i-escriure","title":"Llegir i escriure","text":"<pre><code>const { Controller, Tag } = require('ethernet-ip');\n\nasync function main() {\n    const plc = new Controller();\n\n    try {\n        await plc.connect('192.168.1.100', 0);\n\n        // Llegir\n        const tempTag = new Tag('Temperature');\n        await plc.readTag(tempTag);\n        console.log(`Temperatura actual: ${tempTag.value}`);\n\n        // Escriure\n        const setpointTag = new Tag('Setpoint');\n        setpointTag.value = 75.5;\n        await plc.writeTag(setpointTag);\n        console.log('Setpoint actualitzat');\n\n    } catch (err) {\n        console.error('Error:', err);\n    } finally {\n        plc.disconnect();\n    }\n}\n\nmain();\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#grups-de-tags","title":"Grups de tags","text":"<pre><code>const { Controller, Tag, TagGroup } = require('ethernet-ip');\n\nasync function main() {\n    const plc = new Controller();\n    await plc.connect('192.168.1.100', 0);\n\n    // Crear grup de tags per lectura/escriptura eficient\n    const group = new TagGroup();\n    group.add(new Tag('Temperature'));\n    group.add(new Tag('Pressure'));\n    group.add(new Tag('FlowRate'));\n\n    // Llegir tots els tags del grup (una sola petici\u00f3)\n    await plc.readTagGroup(group);\n\n    group.forEach(tag =&gt; {\n        console.log(`${tag.name}: ${tag.value}`);\n    });\n\n    // Modificar i escriure\n    group.forEach(tag =&gt; tag.value = 0);\n    await plc.writeTagGroup(group);\n\n    plc.disconnect();\n}\n\nmain();\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#subscripcio-a-canvis-polling","title":"Subscripci\u00f3 a canvis (polling)","text":"<pre><code>const { Controller, Tag } = require('ethernet-ip');\n\nconst plc = new Controller();\n\nplc.connect('192.168.1.100', 0).then(() =&gt; {\n    // Afegir tags a monitoritzar\n    plc.subscribe(new Tag('Temperature'));\n    plc.subscribe(new Tag('Pressure'));\n    plc.subscribe(new Tag('AlarmStatus'));\n\n    // Configurar interval de polling (ms)\n    plc.scan_rate = 500;\n\n    // Event quan un tag canvia de valor\n    plc.on('TagChanged', (tag, prevValue) =&gt; {\n        console.log(`${tag.name}: ${prevValue} -&gt; ${tag.value}`);\n    });\n\n    // Event d'error\n    plc.on('error', (err) =&gt; {\n        console.error('Error de comunicaci\u00f3:', err);\n    });\n});\n\n// Per aturar el polling\n// plc.scan_rate = 0;\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#typescript","title":"TypeScript","text":"<pre><code>import { Controller, Tag, TagGroup } from 'ethernet-ip';\n\ninterface ProcessData {\n    temperature: number;\n    pressure: number;\n    running: boolean;\n}\n\nasync function readProcessData(): Promise&lt;ProcessData&gt; {\n    const plc = new Controller();\n    await plc.connect('192.168.1.100', 0);\n\n    const tempTag = new Tag('Temperature');\n    const pressTag = new Tag('Pressure');\n    const runTag = new Tag('Running');\n\n    await plc.readTag(tempTag);\n    await plc.readTag(pressTag);\n    await plc.readTag(runTag);\n\n    plc.disconnect();\n\n    return {\n        temperature: tempTag.value as number,\n        pressure: pressTag.value as number,\n        running: runTag.value as boolean\n    };\n}\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#node-red","title":"Node-RED","text":"<p>Per a Node-RED existeix el paquet <code>node-red-contrib-cip-ethernet-ip</code>.</p>"},{"location":"IoT/IIoT/ethernet-ip/#installacio_3","title":"Instal\u00b7laci\u00f3","text":"<pre><code>cd ~/.node-red\nnpm install node-red-contrib-cip-ethernet-ip\n</code></pre>"},{"location":"IoT/IIoT/ethernet-ip/#nodes-disponibles","title":"Nodes disponibles","text":"<ul> <li>eth-ip-endpoint: Configuraci\u00f3 de connexi\u00f3 al PLC</li> <li>eth-ip-read: Llegir tags</li> <li>eth-ip-write: Escriure tags</li> </ul>"},{"location":"IoT/IIoT/ethernet-ip/#comparativa-de-llibreries","title":"Comparativa de llibreries","text":"Caracter\u00edstica pycomm3 libplctag ethernet-ip Llenguatge Python Multi Node.js Facilitat d'\u00fas Alta Mitjana Alta Suport UDT S\u00ed Parcial B\u00e0sic Multi-fabricant No (AB nom\u00e9s) S\u00ed No (AB nom\u00e9s) Async/await No No S\u00ed Documentaci\u00f3 Excel\u00b7lent Bona Bona Manteniment Actiu Actiu Actiu"},{"location":"IoT/IIoT/ethernet-ip/#recursos","title":"Recursos","text":"<ul> <li>pycomm3 GitHub</li> <li>pycomm3 Documentaci\u00f3</li> <li>libplctag GitHub</li> <li>ethernet-ip npm</li> <li>ODVA - EtherNet/IP</li> </ul>"},{"location":"IoT/IIoT/fins/","title":"FINS (Factory Interface Network Service) - Llibreries i exemples","text":""},{"location":"IoT/IIoT/fins/#introduccio","title":"Introducci\u00f3","text":"<p>FINS \u00e9s el protocol propietari d'Omron per comunicaci\u00f3 amb PLCs. Suporta tant UDP com TCP i permet accedir a les \u00e0rees de mem\u00f2ria del PLC de forma directa.</p>"},{"location":"IoT/IIoT/fins/#plcs-suportats","title":"PLCs suportats","text":"<ul> <li>S\u00e8rie CS/CJ</li> <li>S\u00e8rie CP</li> <li>S\u00e8rie NJ/NX (amb retrocompatibilitat)</li> <li>S\u00e8rie CV</li> </ul>"},{"location":"IoT/IIoT/fins/#llibreries-disponibles","title":"Llibreries disponibles","text":"Llibreria Llenguatge Llic\u00e8ncia Notes omron-fins Node.js MIT M\u00e9s popular per Node fins Python MIT Implementaci\u00f3 b\u00e0sica python-omron-fins Python MIT M\u00e9s completa Socket raw Qualsevol - Implementaci\u00f3 manual"},{"location":"IoT/IIoT/fins/#estructura-del-protocol-fins","title":"Estructura del protocol FINS","text":""},{"location":"IoT/IIoT/fins/#capcalera-fins-10-bytes","title":"Cap\u00e7alera FINS (10 bytes)","text":"<pre><code>| ICF | RSV | GCT | DNA | DA1 | DA2 | SNA | SA1 | SA2 | SID |\n</code></pre> Byte Camp Descripci\u00f3 ICF Information Control Field 0x80 = comanda, 0xC0 = resposta RSV Reserved Sempre 0x00 GCT Gateway Count Nombre de gateways (normalment 0x02) DNA Destination Network Address Xarxa dest\u00ed (0x00 = local) DA1 Destination Node Address Node dest\u00ed DA2 Destination Unit Address Unitat dest\u00ed (0x00 = CPU) SNA Source Network Address Xarxa origen SA1 Source Node Address Node origen SA2 Source Unit Address Unitat origen SID Service ID Identificador de sessi\u00f3"},{"location":"IoT/IIoT/fins/#arees-de-memoria","title":"\u00c0rees de mem\u00f2ria","text":"Codi \u00c0rea Descripci\u00f3 Acc\u00e9s 0x00 CIO Core I/O R/W 0x80 WR Work Area (bit) R/W 0x81 HR Holding Area (bit) R/W 0x82 DM Data Memory R/W 0xB0 WR Work Area (word) R/W 0xB1 HR Holding Area (word) R/W 0xB2 AR Auxiliary Area R 0x02 TIM/CNT Timers/Counters PV R/W"},{"location":"IoT/IIoT/fins/#comandes-principals","title":"Comandes principals","text":"Codi Nom Descripci\u00f3 0101 Memory Area Read Llegir \u00e0rea de mem\u00f2ria 0102 Memory Area Write Escriure \u00e0rea de mem\u00f2ria 0103 Memory Area Fill Omplir \u00e0rea amb un valor 0104 Multiple Memory Area Read Llegir m\u00faltiples \u00e0rees 0401 Run Posar PLC en RUN 0402 Stop Posar PLC en STOP 0501 Controller Data Read Llegir info del PLC 0601 Controller Status Read Llegir estat del PLC 0701 Cycle Time Read Llegir temps de cicle"},{"location":"IoT/IIoT/fins/#python-implementacio-amb-sockets","title":"Python: Implementaci\u00f3 amb sockets","text":""},{"location":"IoT/IIoT/fins/#client-basic-udp","title":"Client b\u00e0sic UDP","text":"<pre><code>import socket\nimport struct\n\nclass FinsClient:\n    def __init__(self, plc_ip, plc_port=9600):\n        self.plc_ip = plc_ip\n        self.plc_port = plc_port\n        self.sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n        self.sock.settimeout(2.0)\n        self.sid = 0\n\n    def _build_header(self, da1=0x00):\n        \"\"\"Construeix la cap\u00e7alera FINS\"\"\"\n        self.sid = (self.sid + 1) % 256\n        return bytes([\n            0x80,  # ICF: Command\n            0x00,  # RSV\n            0x02,  # GCT\n            0x00,  # DNA: Local network\n            da1,   # DA1: Destination node\n            0x00,  # DA2: CPU unit\n            0x00,  # SNA: Local network\n            0x01,  # SA1: Source node (PC)\n            0x00,  # SA2: Source unit\n            self.sid  # SID\n        ])\n\n    def _send_command(self, command, data=b''):\n        \"\"\"Envia una comanda FINS i retorna la resposta\"\"\"\n        header = self._build_header()\n        packet = header + command + data\n\n        self.sock.sendto(packet, (self.plc_ip, self.plc_port))\n        response, _ = self.sock.recvfrom(2048)\n\n        # Verificar codis d'error (bytes 12-13 de la resposta)\n        if len(response) &gt;= 14:\n            main_code = response[12]\n            sub_code = response[13]\n            if main_code != 0 or sub_code != 0:\n                raise Exception(f\"Error FINS: {main_code:02X}{sub_code:02X}\")\n\n        return response[14:]  # Retorna nom\u00e9s les dades\n\n    def read_dm(self, address, count):\n        \"\"\"Llegeix registres DM (Data Memory)\"\"\"\n        command = bytes([0x01, 0x01])  # Memory Area Read\n        # \u00c0rea DM (0x82), adre\u00e7a (2 bytes), bit (1 byte), quantitat (2 bytes)\n        data = struct.pack('&gt;BHBH', 0x82, address, 0x00, count)\n        response = self._send_command(command, data)\n        # Convertir a llista de valors\n        values = []\n        for i in range(0, len(response), 2):\n            values.append(struct.unpack('&gt;H', response[i:i+2])[0])\n        return values\n\n    def write_dm(self, address, values):\n        \"\"\"Escriu registres DM\"\"\"\n        command = bytes([0x01, 0x02])  # Memory Area Write\n        data = struct.pack('&gt;BHBH', 0x82, address, 0x00, len(values))\n        for v in values:\n            data += struct.pack('&gt;H', v)\n        self._send_command(command, data)\n\n    def read_cio(self, address, count):\n        \"\"\"Llegeix \u00e0rea CIO\"\"\"\n        command = bytes([0x01, 0x01])\n        data = struct.pack('&gt;BHBH', 0x00, address, 0x00, count)\n        response = self._send_command(command, data)\n        values = []\n        for i in range(0, len(response), 2):\n            values.append(struct.unpack('&gt;H', response[i:i+2])[0])\n        return values\n\n    def read_wr(self, address, count):\n        \"\"\"Llegeix Work Area\"\"\"\n        command = bytes([0x01, 0x01])\n        data = struct.pack('&gt;BHBH', 0xB0, address, 0x00, count)\n        response = self._send_command(command, data)\n        values = []\n        for i in range(0, len(response), 2):\n            values.append(struct.unpack('&gt;H', response[i:i+2])[0])\n        return values\n\n    def read_hr(self, address, count):\n        \"\"\"Llegeix Holding Area\"\"\"\n        command = bytes([0x01, 0x01])\n        data = struct.pack('&gt;BHBH', 0xB1, address, 0x00, count)\n        response = self._send_command(command, data)\n        values = []\n        for i in range(0, len(response), 2):\n            values.append(struct.unpack('&gt;H', response[i:i+2])[0])\n        return values\n\n    def get_controller_status(self):\n        \"\"\"Llegeix l'estat del controlador\"\"\"\n        command = bytes([0x06, 0x01])\n        response = self._send_command(command)\n        status = response[0] if response else 0\n        modes = {0x00: 'PROGRAM', 0x01: 'DEBUG', 0x02: 'MONITOR', 0x04: 'RUN'}\n        return modes.get(status, f'UNKNOWN ({status:02X})')\n\n    def get_controller_info(self):\n        \"\"\"Llegeix informaci\u00f3 del controlador\"\"\"\n        command = bytes([0x05, 0x01])\n        response = self._send_command(command)\n        if len(response) &gt;= 20:\n            model = response[0:20].decode('ascii').strip('\\x00')\n            return model\n        return None\n\n    def close(self):\n        self.sock.close()\n\n\n# Exemple d'\u00fas\nif __name__ == '__main__':\n    plc = FinsClient('192.168.1.100')\n\n    try:\n        # Llegir estat\n        status = plc.get_controller_status()\n        print(f\"Estat PLC: {status}\")\n\n        # Llegir 10 registres DM a partir de D0\n        values = plc.read_dm(0, 10)\n        print(f\"D0-D9: {values}\")\n\n        # Escriure valors a D100\n        plc.write_dm(100, [1234, 5678])\n        print(\"Escriptura completada\")\n\n    finally:\n        plc.close()\n</code></pre>"},{"location":"IoT/IIoT/fins/#client-tcp-amb-handshake","title":"Client TCP amb handshake","text":"<p>Per a FINS sobre TCP, cal fer un handshake inicial:</p> <pre><code>import socket\nimport struct\n\nclass FinsTcpClient:\n    def __init__(self, plc_ip, plc_port=9600):\n        self.plc_ip = plc_ip\n        self.plc_port = plc_port\n        self.sock = None\n        self.client_node = 0\n        self.server_node = 0\n        self.sid = 0\n\n    def connect(self):\n        \"\"\"Connecta i fa el handshake FINS/TCP\"\"\"\n        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        self.sock.settimeout(5.0)\n        self.sock.connect((self.plc_ip, self.plc_port))\n\n        # Enviar comanda de connexi\u00f3 FINS/TCP\n        # Header: FINS (4 bytes) + Length (4 bytes) + Command (4 bytes) + Error (4 bytes) + Client Node (4 bytes)\n        connect_cmd = b'FINS'  # Magic\n        connect_cmd += struct.pack('&gt;I', 12)  # Length\n        connect_cmd += struct.pack('&gt;I', 0)   # Command: Node Address Data Send\n        connect_cmd += struct.pack('&gt;I', 0)   # Error code\n        connect_cmd += struct.pack('&gt;I', 0)   # Client node (0 = auto-assign)\n\n        self.sock.send(connect_cmd)\n        response = self.sock.recv(24)\n\n        if response[:4] != b'FINS':\n            raise Exception(\"Resposta de handshake inv\u00e0lida\")\n\n        # Parsejar resposta\n        error_code = struct.unpack('&gt;I', response[12:16])[0]\n        if error_code != 0:\n            raise Exception(f\"Error de connexi\u00f3: {error_code}\")\n\n        self.client_node = struct.unpack('&gt;I', response[16:20])[0]\n        self.server_node = struct.unpack('&gt;I', response[20:24])[0]\n        print(f\"Connectat: client={self.client_node}, server={self.server_node}\")\n\n    def _build_header(self):\n        \"\"\"Construeix cap\u00e7alera FINS\"\"\"\n        self.sid = (self.sid + 1) % 256\n        return bytes([\n            0x80,  # ICF\n            0x00,  # RSV\n            0x02,  # GCT\n            0x00,  # DNA\n            self.server_node,  # DA1\n            0x00,  # DA2\n            0x00,  # SNA\n            self.client_node,  # SA1\n            0x00,  # SA2\n            self.sid  # SID\n        ])\n\n    def _send_command(self, command, data=b''):\n        \"\"\"Envia comanda FINS sobre TCP\"\"\"\n        fins_header = self._build_header()\n        fins_frame = fins_header + command + data\n\n        # TCP header\n        tcp_header = b'FINS'\n        tcp_header += struct.pack('&gt;I', len(fins_frame) + 8)  # Length\n        tcp_header += struct.pack('&gt;I', 2)  # Command: FINS Frame Send\n        tcp_header += struct.pack('&gt;I', 0)  # Error code\n\n        self.sock.send(tcp_header + fins_frame)\n\n        # Rebre resposta\n        response = self.sock.recv(2048)\n\n        # Saltar TCP header (16 bytes) + FINS header (10 bytes) + response codes (2 bytes)\n        return response[28:]\n\n    def read_dm(self, address, count):\n        \"\"\"Llegeix registres DM\"\"\"\n        command = bytes([0x01, 0x01])\n        data = struct.pack('&gt;BHBH', 0x82, address, 0x00, count)\n        response = self._send_command(command, data)\n        values = []\n        for i in range(0, len(response), 2):\n            if i + 2 &lt;= len(response):\n                values.append(struct.unpack('&gt;H', response[i:i+2])[0])\n        return values\n\n    def write_dm(self, address, values):\n        \"\"\"Escriu registres DM\"\"\"\n        command = bytes([0x01, 0x02])\n        data = struct.pack('&gt;BHBH', 0x82, address, 0x00, len(values))\n        for v in values:\n            data += struct.pack('&gt;H', v)\n        self._send_command(command, data)\n\n    def close(self):\n        if self.sock:\n            self.sock.close()\n\n\n# Exemple d'\u00fas\nif __name__ == '__main__':\n    plc = FinsTcpClient('192.168.1.100')\n\n    try:\n        plc.connect()\n        values = plc.read_dm(0, 10)\n        print(f\"D0-D9: {values}\")\n    finally:\n        plc.close()\n</code></pre>"},{"location":"IoT/IIoT/fins/#treballar-amb-tipus-de-dades","title":"Treballar amb tipus de dades","text":"<pre><code>import struct\n\ndef registers_to_float(reg1, reg2):\n    \"\"\"Converteix 2 registres a float32 (Big Endian)\"\"\"\n    data = struct.pack('&gt;HH', reg1, reg2)\n    return struct.unpack('&gt;f', data)[0]\n\ndef float_to_registers(value):\n    \"\"\"Converteix float32 a 2 registres\"\"\"\n    data = struct.pack('&gt;f', value)\n    return struct.unpack('&gt;HH', data)\n\ndef registers_to_int32(reg1, reg2):\n    \"\"\"Converteix 2 registres a int32\"\"\"\n    data = struct.pack('&gt;HH', reg1, reg2)\n    return struct.unpack('&gt;i', data)[0]\n\ndef int32_to_registers(value):\n    \"\"\"Converteix int32 a 2 registres\"\"\"\n    data = struct.pack('&gt;i', value)\n    return struct.unpack('&gt;HH', data)\n\ndef registers_to_string(registers):\n    \"\"\"Converteix registres a string ASCII\"\"\"\n    data = b''\n    for reg in registers:\n        data += struct.pack('&gt;H', reg)\n    return data.decode('ascii').strip('\\x00')\n\n\n# Exemple\nplc = FinsClient('192.168.1.100')\n\n# Llegir float (D0-D1)\nregs = plc.read_dm(0, 2)\nfloat_val = registers_to_float(regs[0], regs[1])\nprint(f\"Float: {float_val}\")\n\n# Escriure float a D10-D11\nregs = float_to_registers(3.14159)\nplc.write_dm(10, list(regs))\n\n# Llegir string (D100-D109, 20 car\u00e0cters)\nregs = plc.read_dm(100, 10)\nstring_val = registers_to_string(regs)\nprint(f\"String: {string_val}\")\n\nplc.close()\n</code></pre>"},{"location":"IoT/IIoT/fins/#nodejs-omron-fins","title":"Node.js: omron-fins","text":""},{"location":"IoT/IIoT/fins/#installacio","title":"Instal\u00b7laci\u00f3","text":"<pre><code>npm install omron-fins\n</code></pre>"},{"location":"IoT/IIoT/fins/#client-basic","title":"Client b\u00e0sic","text":"<pre><code>const fins = require('omron-fins');\n\n// Configuraci\u00f3\nconst client = fins.FinsClient(9600, '192.168.1.100');\n\n// Event de connexi\u00f3\nclient.on('reply', (msg) =&gt; {\n    if (msg.values) {\n        console.log('Valors:', msg.values);\n    }\n});\n\nclient.on('error', (err) =&gt; {\n    console.error('Error:', err);\n});\n\nclient.on('timeout', () =&gt; {\n    console.error('Timeout');\n});\n\n// Llegir 10 registres DM a partir de D0\nclient.read('D0', 10);\n\n// Escriure valors\nclient.write('D100', [1234, 5678, 9012]);\n\n// Llegir altres \u00e0rees\nclient.read('W0', 10);   // Work Area\nclient.read('H0', 10);   // Holding Area\nclient.read('CIO0', 10); // Core I/O\n</code></pre>"},{"location":"IoT/IIoT/fins/#classe-wrapper-amb-promises","title":"Classe wrapper amb Promises","text":"<pre><code>const fins = require('omron-fins');\n\nclass OmronPLC {\n    constructor(ip, port = 9600) {\n        this.client = fins.FinsClient(port, ip);\n        this.pending = new Map();\n        this.requestId = 0;\n\n        this.client.on('reply', (msg) =&gt; {\n            const resolve = this.pending.get(msg.sid);\n            if (resolve) {\n                this.pending.delete(msg.sid);\n                resolve(msg);\n            }\n        });\n\n        this.client.on('error', (err) =&gt; {\n            console.error('FINS Error:', err);\n        });\n    }\n\n    read(address, count) {\n        return new Promise((resolve, reject) =&gt; {\n            const sid = this.client.read(address, count);\n            this.pending.set(sid, resolve);\n\n            setTimeout(() =&gt; {\n                if (this.pending.has(sid)) {\n                    this.pending.delete(sid);\n                    reject(new Error('Timeout'));\n                }\n            }, 5000);\n        });\n    }\n\n    write(address, values) {\n        return new Promise((resolve, reject) =&gt; {\n            const sid = this.client.write(address, values);\n            this.pending.set(sid, resolve);\n\n            setTimeout(() =&gt; {\n                if (this.pending.has(sid)) {\n                    this.pending.delete(sid);\n                    reject(new Error('Timeout'));\n                }\n            }, 5000);\n        });\n    }\n}\n\n// \u00das amb async/await\nasync function main() {\n    const plc = new OmronPLC('192.168.1.100');\n\n    try {\n        // Llegir\n        const result = await plc.read('D0', 10);\n        console.log('D0-D9:', result.values);\n\n        // Escriure\n        await plc.write('D100', [100, 200, 300]);\n        console.log('Escriptura completada');\n\n    } catch (err) {\n        console.error('Error:', err.message);\n    }\n}\n\nmain();\n</code></pre>"},{"location":"IoT/IIoT/fins/#polling-continu","title":"Polling continu","text":"<pre><code>const fins = require('omron-fins');\n\nconst client = fins.FinsClient(9600, '192.168.1.100');\n\nlet lastValues = [];\n\nclient.on('reply', (msg) =&gt; {\n    if (msg.values) {\n        // Detectar canvis\n        for (let i = 0; i &lt; msg.values.length; i++) {\n            if (lastValues[i] !== msg.values[i]) {\n                console.log(`D${i} canviat: ${lastValues[i]} -&gt; ${msg.values[i]}`);\n            }\n        }\n        lastValues = [...msg.values];\n    }\n});\n\n// Polling cada 500ms\nsetInterval(() =&gt; {\n    client.read('D0', 10);\n}, 500);\n</code></pre>"},{"location":"IoT/IIoT/fins/#treballar-amb-floats","title":"Treballar amb floats","text":"<pre><code>const fins = require('omron-fins');\n\nconst client = fins.FinsClient(9600, '192.168.1.100');\n\n// Convertir 2 registres a float32\nfunction registersToFloat(reg1, reg2) {\n    const buffer = Buffer.alloc(4);\n    buffer.writeUInt16BE(reg1, 0);\n    buffer.writeUInt16BE(reg2, 2);\n    return buffer.readFloatBE(0);\n}\n\n// Convertir float32 a 2 registres\nfunction floatToRegisters(value) {\n    const buffer = Buffer.alloc(4);\n    buffer.writeFloatBE(value, 0);\n    return [buffer.readUInt16BE(0), buffer.readUInt16BE(2)];\n}\n\nclient.on('reply', (msg) =&gt; {\n    if (msg.values &amp;&amp; msg.values.length &gt;= 2) {\n        const floatVal = registersToFloat(msg.values[0], msg.values[1]);\n        console.log('Float value:', floatVal);\n    }\n});\n\n// Llegir float (D0-D1)\nclient.read('D0', 2);\n\n// Escriure float\nconst regs = floatToRegisters(3.14159);\nclient.write('D10', regs);\n</code></pre>"},{"location":"IoT/IIoT/fins/#codis-derror-fins","title":"Codis d'error FINS","text":""},{"location":"IoT/IIoT/fins/#codis-derror-principals","title":"Codis d'error principals","text":"Codi Descripci\u00f3 0000 Normal completion 0001 Service canceled 0101 Local node not in network 0102 Token timeout 0103 Retries failed 0104 Too many send frames 0105 Node address range error 0106 Node address duplication 0201 Destination node not in network 0202 Unit missing 0203 Third node missing 0204 Destination node busy 0205 Response timeout 0401 Command too long 0402 Command too short 0501 Destination CPU error 1001 Command not supported 1101 Area classification error 1102 Access size error 1103 Address range error 1104 Address range exceeded 2002 CPU protected 2003 PLC in program mode"},{"location":"IoT/IIoT/fins/#gestio-derrors-en-python","title":"Gesti\u00f3 d'errors en Python","text":"<pre><code>FINS_ERRORS = {\n    0x0000: \"Normal completion\",\n    0x0001: \"Service canceled\",\n    0x0101: \"Local node not in network\",\n    0x0201: \"Destination node not in network\",\n    0x0205: \"Response timeout\",\n    0x1001: \"Command not supported\",\n    0x1101: \"Area classification error\",\n    0x1103: \"Address range error\",\n    0x2002: \"CPU protected\",\n    0x2003: \"PLC in program mode\"\n}\n\ndef check_fins_error(response):\n    \"\"\"Verifica i interpreta errors FINS\"\"\"\n    if len(response) &gt;= 14:\n        main_code = response[12]\n        sub_code = response[13]\n        error_code = (main_code &lt;&lt; 8) | sub_code\n\n        if error_code != 0:\n            error_msg = FINS_ERRORS.get(error_code, f\"Unknown error\")\n            raise Exception(f\"FINS Error {error_code:04X}: {error_msg}\")\n</code></pre>"},{"location":"IoT/IIoT/fins/#eines-de-diagnostic","title":"Eines de diagn\u00f2stic","text":""},{"location":"IoT/IIoT/fins/#wireshark","title":"Wireshark","text":"<p>Wireshark t\u00e9 un dissector per FINS que permet veure les trames decodificades.</p> <p>Filtre: <code>omron</code></p>"},{"location":"IoT/IIoT/fins/#cx-programmer","title":"CX-Programmer","text":"<p>Eina oficial d'Omron per programar i monitoritzar PLCs. Permet veure l'estat de les \u00e0rees de mem\u00f2ria.</p>"},{"location":"IoT/IIoT/fins/#test-amb-netcat","title":"Test amb netcat","text":"<pre><code># Enviar paquet FINS b\u00e0sic (no recomanat per producci\u00f3)\necho -ne '\\x80\\x00\\x02\\x00\\x00\\x00\\x00\\x01\\x00\\x01\\x05\\x01' | nc -u 192.168.1.100 9600\n</code></pre>"},{"location":"IoT/IIoT/fins/#comparativa-udp-vs-tcp","title":"Comparativa UDP vs TCP","text":"Aspecte FINS/UDP FINS/TCP Port 9600 9600 Handshake No S\u00ed Fiabilitat Menor Major Lat\u00e8ncia Menor Major Firewalls M\u00e9s dif\u00edcil M\u00e9s f\u00e0cil Recomanat Xarxa local Xarxes complexes"},{"location":"IoT/IIoT/fins/#recursos","title":"Recursos","text":"<ul> <li>Omron FINS Protocol Reference (requereix compte)</li> <li>omron-fins npm</li> <li>FINS Protocol Wireshark Wiki</li> </ul>"},{"location":"IoT/IIoT/modbus-tcp/","title":"Modbus TCP - Llibreries i exemples","text":""},{"location":"IoT/IIoT/modbus-tcp/#introduccio","title":"Introducci\u00f3","text":"<p>Modbus TCP \u00e9s l'adaptaci\u00f3 del protocol Modbus sobre TCP/IP. \u00c9s un dels protocols industrials m\u00e9s utilitzats per la seva simplicitat i \u00e0mplia compatibilitat.</p>"},{"location":"IoT/IIoT/modbus-tcp/#llibreries-disponibles","title":"Llibreries disponibles","text":"Llibreria Llenguatge Rol Llic\u00e8ncia pymodbus Python Client i Server BSD modbus-serial Node.js Client ISC jsmodbus Node.js Client i Server MIT node-red-contrib-modbus Node-RED Client i Server BSD"},{"location":"IoT/IIoT/modbus-tcp/#python-pymodbus","title":"Python: pymodbus","text":"<p>La llibreria m\u00e9s completa per Modbus en Python. Suporta Modbus TCP, RTU i ASCII.</p>"},{"location":"IoT/IIoT/modbus-tcp/#installacio","title":"Instal\u00b7laci\u00f3","text":"<pre><code>pip install pymodbus\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#client-basic","title":"Client b\u00e0sic","text":"<pre><code>from pymodbus.client import ModbusTcpClient\n\n# Connexi\u00f3\nclient = ModbusTcpClient('192.168.1.100', port=502)\nclient.connect()\n\n# Llegir 10 holding registers a partir de l'adre\u00e7a 0\nresult = client.read_holding_registers(address=0, count=10, slave=1)\nif not result.isError():\n    print(f\"Registres: {result.registers}\")\n\n# Tancar connexi\u00f3\nclient.close()\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#funcions-de-lectura","title":"Funcions de lectura","text":"<pre><code>from pymodbus.client import ModbusTcpClient\n\nclient = ModbusTcpClient('192.168.1.100', port=502)\nclient.connect()\n\n# Funci\u00f3 01: Read Coils (sortides digitals)\ncoils = client.read_coils(address=0, count=16, slave=1)\nprint(f\"Coils: {coils.bits[:16]}\")\n\n# Funci\u00f3 02: Read Discrete Inputs (entrades digitals)\ninputs = client.read_discrete_inputs(address=0, count=16, slave=1)\nprint(f\"Inputs: {inputs.bits[:16]}\")\n\n# Funci\u00f3 03: Read Holding Registers (registres R/W)\nholding = client.read_holding_registers(address=0, count=10, slave=1)\nprint(f\"Holding: {holding.registers}\")\n\n# Funci\u00f3 04: Read Input Registers (registres nom\u00e9s lectura)\ninput_regs = client.read_input_registers(address=0, count=10, slave=1)\nprint(f\"Input Registers: {input_regs.registers}\")\n\nclient.close()\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#funcions-descriptura","title":"Funcions d'escriptura","text":"<pre><code>from pymodbus.client import ModbusTcpClient\n\nclient = ModbusTcpClient('192.168.1.100', port=502)\nclient.connect()\n\n# Funci\u00f3 05: Write Single Coil\nclient.write_coil(address=0, value=True, slave=1)\n\n# Funci\u00f3 06: Write Single Register\nclient.write_register(address=0, value=1234, slave=1)\n\n# Funci\u00f3 15: Write Multiple Coils\nclient.write_coils(address=0, values=[True, False, True, True], slave=1)\n\n# Funci\u00f3 16: Write Multiple Registers\nclient.write_registers(address=0, values=[100, 200, 300, 400], slave=1)\n\nclient.close()\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#treballar-amb-tipus-de-dades","title":"Treballar amb tipus de dades","text":"<p>Modbus nom\u00e9s treballa amb registres de 16 bits. Per a altres tipus cal combinar registres:</p> <pre><code>from pymodbus.client import ModbusTcpClient\nfrom pymodbus.payload import BinaryPayloadDecoder, BinaryPayloadBuilder\nfrom pymodbus.constants import Endian\n\nclient = ModbusTcpClient('192.168.1.100', port=502)\nclient.connect()\n\n# Llegir un valor float (32 bits = 2 registres)\nresult = client.read_holding_registers(address=0, count=2, slave=1)\ndecoder = BinaryPayloadDecoder.fromRegisters(\n    result.registers,\n    byteorder=Endian.BIG,\n    wordorder=Endian.BIG\n)\nfloat_value = decoder.decode_32bit_float()\nprint(f\"Float: {float_value}\")\n\n# Llegir un valor int32 (32 bits = 2 registres)\nresult = client.read_holding_registers(address=2, count=2, slave=1)\ndecoder = BinaryPayloadDecoder.fromRegisters(\n    result.registers,\n    byteorder=Endian.BIG,\n    wordorder=Endian.BIG\n)\nint32_value = decoder.decode_32bit_int()\nprint(f\"Int32: {int32_value}\")\n\n# Escriure un valor float\nbuilder = BinaryPayloadBuilder(byteorder=Endian.BIG, wordorder=Endian.BIG)\nbuilder.add_32bit_float(3.14159)\nregisters = builder.to_registers()\nclient.write_registers(address=0, values=registers, slave=1)\n\n# Escriure un valor int32\nbuilder = BinaryPayloadBuilder(byteorder=Endian.BIG, wordorder=Endian.BIG)\nbuilder.add_32bit_int(123456)\nregisters = builder.to_registers()\nclient.write_registers(address=2, values=registers, slave=1)\n\nclient.close()\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#llegir-strings","title":"Llegir strings","text":"<pre><code>from pymodbus.client import ModbusTcpClient\nfrom pymodbus.payload import BinaryPayloadDecoder\nfrom pymodbus.constants import Endian\n\nclient = ModbusTcpClient('192.168.1.100', port=502)\nclient.connect()\n\n# Llegir string (10 registres = 20 car\u00e0cters m\u00e0xim)\nresult = client.read_holding_registers(address=100, count=10, slave=1)\ndecoder = BinaryPayloadDecoder.fromRegisters(\n    result.registers,\n    byteorder=Endian.BIG,\n    wordorder=Endian.BIG\n)\nstring_value = decoder.decode_string(20).decode('utf-8').strip('\\x00')\nprint(f\"String: {string_value}\")\n\nclient.close()\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#client-asincron","title":"Client as\u00edncron","text":"<pre><code>import asyncio\nfrom pymodbus.client import AsyncModbusTcpClient\n\nasync def main():\n    client = AsyncModbusTcpClient('192.168.1.100', port=502)\n    await client.connect()\n\n    # Llegir registres\n    result = await client.read_holding_registers(address=0, count=10, slave=1)\n    print(f\"Registres: {result.registers}\")\n\n    # Escriure\n    await client.write_register(address=0, value=999, slave=1)\n\n    client.close()\n\nasyncio.run(main())\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#servidor-modbus-simulador","title":"Servidor Modbus (simulador)","text":"<pre><code>from pymodbus.server import StartTcpServer\nfrom pymodbus.datastore import ModbusSlaveContext, ModbusServerContext\nfrom pymodbus.datastore import ModbusSequentialDataBlock\n\n# Crear blocs de dades\n# Par\u00e0metres: adre\u00e7a inicial, valors inicials\nstore = ModbusSlaveContext(\n    di=ModbusSequentialDataBlock(0, [False] * 100),  # Discrete Inputs\n    co=ModbusSequentialDataBlock(0, [False] * 100),  # Coils\n    hr=ModbusSequentialDataBlock(0, [0] * 100),      # Holding Registers\n    ir=ModbusSequentialDataBlock(0, [0] * 100)       # Input Registers\n)\n\ncontext = ModbusServerContext(slaves=store, single=True)\n\n# Iniciar servidor\nprint(\"Servidor Modbus TCP iniciat a port 502...\")\nStartTcpServer(context=context, address=(\"0.0.0.0\", 502))\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#gestio-derrors","title":"Gesti\u00f3 d'errors","text":"<pre><code>from pymodbus.client import ModbusTcpClient\nfrom pymodbus.exceptions import ModbusException, ConnectionException\n\nclient = ModbusTcpClient('192.168.1.100', port=502, timeout=3)\n\ntry:\n    if not client.connect():\n        raise ConnectionException(\"No s'ha pogut connectar\")\n\n    result = client.read_holding_registers(address=0, count=10, slave=1)\n\n    if result.isError():\n        print(f\"Error Modbus: {result}\")\n    else:\n        print(f\"Registres: {result.registers}\")\n\nexcept ConnectionException as e:\n    print(f\"Error de connexi\u00f3: {e}\")\nexcept ModbusException as e:\n    print(f\"Error Modbus: {e}\")\nfinally:\n    client.close()\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#nodejs-modbus-serial","title":"Node.js: modbus-serial","text":"<p>Llibreria popular per a Node.js que suporta Modbus TCP i RTU.</p>"},{"location":"IoT/IIoT/modbus-tcp/#installacio_1","title":"Instal\u00b7laci\u00f3","text":"<pre><code>npm install modbus-serial\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#client-basic_1","title":"Client b\u00e0sic","text":"<pre><code>const ModbusRTU = require('modbus-serial');\n\nconst client = new ModbusRTU();\n\nasync function main() {\n    // Connexi\u00f3 TCP\n    await client.connectTCP('192.168.1.100', { port: 502 });\n    client.setID(1);  // Slave ID\n\n    // Llegir 10 holding registers\n    const data = await client.readHoldingRegisters(0, 10);\n    console.log('Registres:', data.data);\n\n    client.close();\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#funcions-de-lectura_1","title":"Funcions de lectura","text":"<pre><code>const ModbusRTU = require('modbus-serial');\n\nconst client = new ModbusRTU();\n\nasync function readAll() {\n    await client.connectTCP('192.168.1.100', { port: 502 });\n    client.setID(1);\n\n    // Funci\u00f3 01: Read Coils\n    const coils = await client.readCoils(0, 16);\n    console.log('Coils:', coils.data);\n\n    // Funci\u00f3 02: Read Discrete Inputs\n    const inputs = await client.readDiscreteInputs(0, 16);\n    console.log('Inputs:', inputs.data);\n\n    // Funci\u00f3 03: Read Holding Registers\n    const holding = await client.readHoldingRegisters(0, 10);\n    console.log('Holding:', holding.data);\n\n    // Funci\u00f3 04: Read Input Registers\n    const inputRegs = await client.readInputRegisters(0, 10);\n    console.log('Input Registers:', inputRegs.data);\n\n    client.close();\n}\n\nreadAll().catch(console.error);\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#funcions-descriptura_1","title":"Funcions d'escriptura","text":"<pre><code>const ModbusRTU = require('modbus-serial');\n\nconst client = new ModbusRTU();\n\nasync function writeData() {\n    await client.connectTCP('192.168.1.100', { port: 502 });\n    client.setID(1);\n\n    // Funci\u00f3 05: Write Single Coil\n    await client.writeCoil(0, true);\n\n    // Funci\u00f3 06: Write Single Register\n    await client.writeRegister(0, 1234);\n\n    // Funci\u00f3 15: Write Multiple Coils\n    await client.writeCoils(0, [true, false, true, true]);\n\n    // Funci\u00f3 16: Write Multiple Registers\n    await client.writeRegisters(0, [100, 200, 300, 400]);\n\n    console.log('Escriptura completada');\n    client.close();\n}\n\nwriteData().catch(console.error);\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#treballar-amb-floats","title":"Treballar amb floats","text":"<pre><code>const ModbusRTU = require('modbus-serial');\n\nconst client = new ModbusRTU();\n\n// Funci\u00f3 per convertir 2 registres a float32\nfunction registersToFloat(reg1, reg2) {\n    const buffer = Buffer.alloc(4);\n    buffer.writeUInt16BE(reg1, 0);\n    buffer.writeUInt16BE(reg2, 2);\n    return buffer.readFloatBE(0);\n}\n\n// Funci\u00f3 per convertir float32 a 2 registres\nfunction floatToRegisters(value) {\n    const buffer = Buffer.alloc(4);\n    buffer.writeFloatBE(value, 0);\n    return [buffer.readUInt16BE(0), buffer.readUInt16BE(2)];\n}\n\nasync function main() {\n    await client.connectTCP('192.168.1.100', { port: 502 });\n    client.setID(1);\n\n    // Llegir float (2 registres)\n    const data = await client.readHoldingRegisters(0, 2);\n    const floatValue = registersToFloat(data.data[0], data.data[1]);\n    console.log('Float:', floatValue);\n\n    // Escriure float\n    const registers = floatToRegisters(3.14159);\n    await client.writeRegisters(0, registers);\n\n    client.close();\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#polling-continu","title":"Polling continu","text":"<pre><code>const ModbusRTU = require('modbus-serial');\n\nconst client = new ModbusRTU();\nlet isConnected = false;\n\nasync function connect() {\n    try {\n        await client.connectTCP('192.168.1.100', { port: 502 });\n        client.setID(1);\n        client.setTimeout(2000);\n        isConnected = true;\n        console.log('Connectat');\n    } catch (err) {\n        console.error('Error de connexi\u00f3:', err.message);\n        isConnected = false;\n    }\n}\n\nasync function poll() {\n    if (!isConnected) {\n        await connect();\n        return;\n    }\n\n    try {\n        const data = await client.readHoldingRegisters(0, 10);\n        console.log('Dades:', data.data);\n    } catch (err) {\n        console.error('Error de lectura:', err.message);\n        isConnected = false;\n    }\n}\n\n// Polling cada 500ms\nconnect().then(() =&gt; {\n    setInterval(poll, 500);\n});\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#gestio-derrors-amb-reconnexio","title":"Gesti\u00f3 d'errors amb reconnexi\u00f3","text":"<pre><code>const ModbusRTU = require('modbus-serial');\n\nclass ModbusClient {\n    constructor(ip, port = 502, slaveId = 1) {\n        this.ip = ip;\n        this.port = port;\n        this.slaveId = slaveId;\n        this.client = new ModbusRTU();\n        this.connected = false;\n    }\n\n    async connect() {\n        try {\n            await this.client.connectTCP(this.ip, { port: this.port });\n            this.client.setID(this.slaveId);\n            this.client.setTimeout(3000);\n            this.connected = true;\n            console.log(`Connectat a ${this.ip}:${this.port}`);\n        } catch (err) {\n            this.connected = false;\n            throw err;\n        }\n    }\n\n    async ensureConnected() {\n        if (!this.connected) {\n            await this.connect();\n        }\n    }\n\n    async readRegisters(address, count) {\n        await this.ensureConnected();\n        try {\n            return await this.client.readHoldingRegisters(address, count);\n        } catch (err) {\n            this.connected = false;\n            throw err;\n        }\n    }\n\n    async writeRegister(address, value) {\n        await this.ensureConnected();\n        try {\n            return await this.client.writeRegister(address, value);\n        } catch (err) {\n            this.connected = false;\n            throw err;\n        }\n    }\n\n    close() {\n        this.client.close();\n        this.connected = false;\n    }\n}\n\n// \u00das\nconst plc = new ModbusClient('192.168.1.100');\n\nasync function main() {\n    const data = await plc.readRegisters(0, 10);\n    console.log(data.data);\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#nodejs-jsmodbus","title":"Node.js: jsmodbus","text":"<p>Alternativa amb suport per servidor.</p>"},{"location":"IoT/IIoT/modbus-tcp/#installacio_2","title":"Instal\u00b7laci\u00f3","text":"<pre><code>npm install jsmodbus\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#client","title":"Client","text":"<pre><code>const Modbus = require('jsmodbus');\nconst net = require('net');\n\nconst socket = new net.Socket();\nconst client = new Modbus.client.TCP(socket, 1);  // unit ID = 1\n\nsocket.on('connect', async () =&gt; {\n    try {\n        // Llegir holding registers\n        const resp = await client.readHoldingRegisters(0, 10);\n        console.log('Registres:', resp.response.body.values);\n\n        // Escriure un registre\n        await client.writeSingleRegister(0, 1234);\n\n        socket.end();\n    } catch (err) {\n        console.error(err);\n    }\n});\n\nsocket.on('error', console.error);\nsocket.connect({ host: '192.168.1.100', port: 502 });\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#servidor","title":"Servidor","text":"<pre><code>const Modbus = require('jsmodbus');\nconst net = require('net');\n\nconst server = new net.Server();\nconst modbusServer = new Modbus.server.TCP(server);\n\n// Configurar dades inicials\nmodbusServer.holding.writeUInt16BE(100, 0);  // Registre 0 = 100\nmodbusServer.holding.writeUInt16BE(200, 2);  // Registre 1 = 200\n\nserver.listen(502, '0.0.0.0', () =&gt; {\n    console.log('Servidor Modbus TCP escoltant a port 502');\n});\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#node-red","title":"Node-RED","text":""},{"location":"IoT/IIoT/modbus-tcp/#installacio_3","title":"Instal\u00b7laci\u00f3","text":"<pre><code>cd ~/.node-red\nnpm install node-red-contrib-modbus\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#nodes-disponibles","title":"Nodes disponibles","text":"<ul> <li>modbus-client: Configuraci\u00f3 de connexi\u00f3</li> <li>modbus-read: Llegir registres</li> <li>modbus-write: Escriure registres</li> <li>modbus-getter: Llegir sota demanda</li> <li>modbus-flex-getter: Lectura flexible</li> <li>modbus-server: Servidor Modbus</li> </ul>"},{"location":"IoT/IIoT/modbus-tcp/#eines-de-diagnostic","title":"Eines de diagn\u00f2stic","text":""},{"location":"IoT/IIoT/modbus-tcp/#modbus-poll-windows","title":"Modbus Poll (Windows)","text":"<p>Client Modbus amb interf\u00edcie gr\u00e0fica per testejar dispositius.</p>"},{"location":"IoT/IIoT/modbus-tcp/#mbpoll-linux","title":"mbpoll (Linux)","text":"<pre><code># Instal\u00b7laci\u00f3\nsudo apt install mbpoll\n\n# Llegir 10 holding registers\nmbpoll -a 1 -r 0 -c 10 192.168.1.100\n\n# Escriure un valor\nmbpoll -a 1 -r 0 192.168.1.100 1234\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#pymodbusconsole","title":"pymodbus.console","text":"<pre><code># Instal\u00b7lar\npip install pymodbus[repl]\n\n# Iniciar consola\npymodbus.console tcp --host 192.168.1.100 --port 502\n\n# Dins la consola:\n&gt; client.read_holding_registers 0 10 1\n</code></pre>"},{"location":"IoT/IIoT/modbus-tcp/#mapa-de-registres-tipic","title":"Mapa de registres t\u00edpic","text":"<p>Exemple d'organitzaci\u00f3 de registres en un dispositiu:</p> Adre\u00e7a Tipus Descripci\u00f3 0-9 Holding Setpoints 10-19 Holding Par\u00e0metres configuraci\u00f3 100-109 Input Valors de proc\u00e9s 110-119 Input Estat dels sensors 0-15 Coil Sortides digitals 0-15 Discrete Entrades digitals"},{"location":"IoT/IIoT/modbus-tcp/#recursos","title":"Recursos","text":"<ul> <li>pymodbus GitHub</li> <li>pymodbus Documentaci\u00f3</li> <li>modbus-serial npm</li> <li>jsmodbus npm</li> <li>Modbus Organization</li> <li>Especificaci\u00f3 Modbus TCP</li> </ul>"},{"location":"IoT/IIoT/protocols/","title":"Protocols de Comunicacions Industrials","text":""},{"location":"IoT/IIoT/protocols/#introduccio","title":"Introducci\u00f3","text":""},{"location":"IoT/IIoT/protocols/#que-son-els-protocols-industrials","title":"Qu\u00e8 s\u00f3n els protocols industrials?","text":"<p>Un protocol de comunicaci\u00f3 industrial \u00e9s un conjunt de regles que defineixen com els dispositius d'un sistema d'automatitzaci\u00f3 (PLCs, sensors, actuadors, HMIs, SCADA) intercanvien informaci\u00f3. A difer\u00e8ncia dels protocols IT convencionals, els protocols industrials han de garantir:</p> <ul> <li>Determinisme: Les dades han d'arribar en un temps que es pugui predir.</li> <li>Fiabilitat: Toler\u00e0ncia a soroll el\u00e8ctric i condicions adverses.</li> <li>Temps real: Resposta dins de terminis estrictes (mil\u00b7lisegons o microsegons)</li> <li>Disponibilitat: Funcionament continu 24/7</li> </ul>"},{"location":"IoT/IIoT/protocols/#evolucio-historica","title":"Evoluci\u00f3 hist\u00f2rica","text":"<pre><code>1970s          1980s-90s           2000s              2010s-Actualitat\n  \u2502               \u2502                  \u2502                      \u2502\n  \u25bc               \u25bc                  \u25bc                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502S\u00e8rie\u2502  \u2192   \u2502Fieldbus \u2502  \u2192   \u2502 Ethernet   \u2502  \u2192   \u2502 IIoT / Ind\u00fastria\u2502\n\u2502RS232\u2502      \u2502Profibus \u2502      \u2502 Industrial \u2502      \u2502      4.0        \u2502\n\u2502RS485\u2502      \u2502DeviceNet\u2502      \u2502EtherNet/IP \u2502      \u2502   OPC UA + TSN  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2518      \u2502Modbus   \u2502      \u2502PROFINET    \u2502      \u2502   MQTT + Cloud  \u2502\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Comunicaci\u00f3 s\u00e8rie (1970s): Connexions punt a punt amb RS-232/RS-485. Simples per\u00f2 limitades en dist\u00e0ncia i nombre de dispositius.</p> <p>Fieldbus (1980s-90s): Xarxes industrials dedicades (Profibus, DeviceNet, Modbus RTU). Permetien connectar m\u00faltiples dispositius en un bus compartit.</p> <p>Ethernet Industrial (2000s): Adaptaci\u00f3 d'Ethernet est\u00e0ndard per entorns industrials. Aprofita infraestructura IT existent i permet velocitats m\u00e9s altes.</p> <p>IIoT i Ind\u00fastria 4.0 (2010s-actualitat): Converg\u00e8ncia IT/OT, connectivitat al n\u00favol, i est\u00e0ndards com OPC UA amb TSN per temps real sobre Ethernet est\u00e0ndard.</p>"},{"location":"IoT/IIoT/protocols/#model-de-capes-en-protocols-industrials","title":"Model de capes en protocols industrials","text":"<p>Els protocols industrials s'organitzen sobre el model OSI, per\u00f2 amb adaptacions espec\u00edfiques:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Capa 7 - Aplicaci\u00f3                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Modbus  \u2502 \u2502  FINS   \u2502 \u2502 CIP  \u2502 \u2502 OPC UA \u2502 \u2502 S7 (Siemens)   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Capa 4 - Transport                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502  \u2502        TCP          \u2502  \u2502        UDP          \u2502               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Capa 3 - Xarxa                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502  \u2502                    IP                       \u2502                \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Capa 2 - Enlla\u00e7                                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502  \u2502  Ethernet est\u00e0ndard \u2502  \u2502  PROFINET IRT/TSN   \u2502               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Capa 1 - F\u00edsica                                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 100BASE-TX\u2502 \u25021000BASE-T \u2502 \u2502   Fibra   \u2502 \u2502 Industrial (M12) \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"IoT/IIoT/protocols/#diferencies-entre-it-i-ot","title":"Difer\u00e8ncies entre IT i OT","text":"Aspecte IT (Tecnologies Informaci\u00f3) OT (Tecnologies Operaci\u00f3) Prioritat Confidencialitat Disponibilitat Lat\u00e8ncia Tolerable (ms-s) Cr\u00edtica (\u00b5s-ms) Cicle de vida 3-5 anys 15-20 anys Actualitzacions Freq\u00fcents Poc freq\u00fcents Fallades Reinici acceptable Inacceptable (seguretat) Protocols HTTP, SQL, REST Modbus, OPC UA, PROFINET"},{"location":"IoT/IIoT/protocols/#conceptes-clau","title":"Conceptes clau","text":""},{"location":"IoT/IIoT/protocols/#temps-real-vs-determinisme","title":"Temps real vs Determinisme","text":"<p>Aquests dos conceptes estan molt relacionats per\u00f2 no s\u00f3n sin\u00f2nims:</p> Concepte Definici\u00f3 Pregunta clau Temps real El sistema respon dins d'un termini definit (deadline) Quan ha d'arribar la resposta? Determinisme El comportament del sistema \u00e9s predictible i repetible Com de predictible \u00e9s el temps de resposta? <p>Temps real no significa \"molt r\u00e0pid\". Un sistema pot tenir un deadline d'1 segon i ser temps real si sempre compleix aquest termini. El que importa \u00e9s la garantia de complir el termini, no la velocitat absoluta.</p> <p>Determinisme \u00e9s la propietat que permet aconseguir temps real. Un sistema determinista t\u00e9 un temps de resposta amb variaci\u00f3 m\u00ednima (baixa jitter). Sense determinisme, no pots garantir deadlines.</p> <pre><code>              Temps de resposta (lat\u00e8ncia)\n\nNo determinista (Ethernet est\u00e0ndard):\n    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n    \u2502    \u25cb      \u25cb  \u25cb       \u25cb           \u25cb    \u25cb        \u25cb\n    \u2502  (variaci\u00f3 alta - no pots garantir deadline)\n\nDeterminista (PROFINET IRT, EtherCAT):\n    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n    \u2502         \u25cb\u25cb\u25cb\u25cb\u25cb\u25cb\u25cb\u25cb\n    \u2502       (variaci\u00f3 m\u00ednima - pots garantir deadline)\n              \u25b2\n              \u2514\u2500\u2500 Lat\u00e8ncia consistent\n</code></pre> <p>Relaci\u00f3 pr\u00e0ctica:</p> <ul> <li>Per tenir temps real, necessites determinisme</li> <li>Pots tenir determinisme sense requisits de temps real (sistema predictible per\u00f2 sense deadlines estrictes)</li> <li>Ethernet est\u00e0ndard no \u00e9s determinista perqu\u00e8 el temps d'acc\u00e9s al medi varia (col\u00b7lisions, congesti\u00f3)</li> </ul>"},{"location":"IoT/IIoT/protocols/#tipus-de-temps-real","title":"Tipus de temps real","text":"Tipus Comportament si falla el deadline Exemple Hard Real-Time Fallada catastr\u00f2fica del sistema Control de moviment, airbag Firm Real-Time El resultat ja no \u00e9s \u00fatil, per\u00f2 no \u00e9s catastr\u00f2fic V\u00eddeo en streaming Soft Real-Time Degradaci\u00f3 acceptable de qualitat Monitoritzaci\u00f3 SCADA"},{"location":"IoT/IIoT/protocols/#com-saconsegueix-determinisme-en-ethernet","title":"Com s'aconsegueix determinisme en Ethernet?","text":"<p>Ethernet est\u00e0ndard no \u00e9s determinista. Les solucions industrials modifiquen el comportament:</p> Tecnologia M\u00e8tode Capa OSI PROFINET IRT Reserves de temps (time slots) a capa 2 Capa 2 EtherCAT Processament \"on the fly\" sense store-and-forward Capa 2 TSN IEEE 802.1 - Prioritats, time-aware shaping Capa 2 EtherNet/IP amb CIP Sync Sincronitzaci\u00f3 de rellotges (IEEE 1588 PTP) Capa 3-4"},{"location":"IoT/IIoT/protocols/#piramide-dautomatitzacio-i-protocols","title":"Pir\u00e0mide d'automatitzaci\u00f3 i protocols","text":"<pre><code>                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         Nivell 4   \u2502   ERP/MES     \u2502  \u2500\u2500 HTTP, REST, SQL\n                    \u2502   (Gesti\u00f3)    \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502 OPC UA, MQTT\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         Nivell 3   \u2502    SCADA      \u2502  \u2500\u2500 OPC UA, Modbus TCP\n                    \u2502  (Supervisi\u00f3) \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502 EtherNet/IP, PROFINET\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         Nivell 2   \u2502  PLC / DCS    \u2502  \u2500\u2500 PROFINET, EtherNet/IP\n                    \u2502   (Control)   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502 PROFINET, EtherCAT, IO-Link\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         Nivell 1   \u2502   I/O remota  \u2502  \u2500\u2500 Fieldbus, IO-Link\n                    \u2502  (Dispositius)\u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502 Senyals el\u00e8ctrics\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         Nivell 0   \u2502Sensors/Actuad.\u2502  \u2500\u2500 4-20mA, 0-10V, Digital\n                    \u2502   (Camp)      \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"IoT/IIoT/protocols/#comparativa-rapida","title":"Comparativa r\u00e0pida","text":"Protocol Capa Port Temps real Seguretat Complexitat Modbus TCP Aplicaci\u00f3/TCP 502 No Baixa Baixa EtherNet/IP Aplicaci\u00f3/TCP-UDP 44818, 2222 S\u00ed (CIP Sync) Mitjana Mitjana FINS Aplicaci\u00f3/TCP-UDP 9600 No Baixa Baixa OPC UA Aplicaci\u00f3/TCP 4840 S\u00ed (TSN) Alta Alta PROFINET Capa 2 + TCP/IP - S\u00ed (IRT) Mitjana Alta"},{"location":"IoT/IIoT/protocols/#modbus-tcp","title":"Modbus TCP","text":"<p>Protocol obert basat en l'arquitectura client/servidor. \u00c9s l'evoluci\u00f3 del Modbus RTU (s\u00e8rie) cap a Ethernet.</p>"},{"location":"IoT/IIoT/protocols/#caracteristiques","title":"Caracter\u00edstiques","text":"<ul> <li>Port: 502 (TCP)</li> <li>Model: Client (Master) / Servidor (Slave)</li> <li>Adre\u00e7ament: Unit ID (0-255) + Registres (0-65535)</li> <li>Format dades: Big-endian</li> </ul>"},{"location":"IoT/IIoT/protocols/#funcions-principals","title":"Funcions principals","text":"Codi Funci\u00f3 Descripci\u00f3 01 Read Coils Llegir sortides digitals 02 Read Discrete Inputs Llegir entrades digitals 03 Read Holding Registers Llegir registres de 16 bits 04 Read Input Registers Llegir registres d'entrada 05 Write Single Coil Escriure una sortida 06 Write Single Register Escriure un registre 15 Write Multiple Coils Escriure m\u00faltiples sortides 16 Write Multiple Registers Escriure m\u00faltiples registres"},{"location":"IoT/IIoT/protocols/#llibreries-disponibles","title":"Llibreries disponibles","text":"Llibreria Llenguatge Rol Llic\u00e8ncia pymodbus Python Client i Server BSD modbus-serial Node.js Client ISC jsmodbus Node.js Client i Server MIT <p>Exemples complets amb Python i Node.js</p>"},{"location":"IoT/IIoT/protocols/#avantatges-i-inconvenients","title":"Avantatges i inconvenients","text":"<ul> <li>Simple d'implementar</li> <li>\u00c0mpliament suportat</li> <li>Obert i sense llic\u00e8ncies</li> <li>Sense seguretat integrada</li> <li>No \u00e9s temps real</li> <li>Limitat a 65536 registres per tipus</li> </ul>"},{"location":"IoT/IIoT/protocols/#ethernetip-cip","title":"EtherNet/IP (CIP)","text":"<p>Protocol industrial desenvolupat per ODVA. Utilitza CIP (Common Industrial Protocol) sobre TCP/IP i UDP/IP.</p>"},{"location":"IoT/IIoT/protocols/#caracteristiques_1","title":"Caracter\u00edstiques","text":"<ul> <li>Ports: 44818 (TCP), 2222 (UDP per I/O impl\u00edcit)</li> <li>Model: Productor/Consumidor i Client/Servidor</li> <li>Suport: Allen-Bradley (Rockwell), Omron Sysmac, altres</li> </ul>"},{"location":"IoT/IIoT/protocols/#tipus-de-comunicacio","title":"Tipus de comunicaci\u00f3","text":"<ol> <li>Explicit Messaging (TCP): Peticions tipus request/response per configuraci\u00f3 i diagn\u00f2stic</li> <li>Implicit Messaging (UDP): Comunicaci\u00f3 c\u00edclica en temps real per I/O</li> </ol>"},{"location":"IoT/IIoT/protocols/#conceptes-clau_1","title":"Conceptes clau","text":"<ul> <li>Tag-based: Acc\u00e9s per nom de variable, no per adre\u00e7a de mem\u00f2ria</li> <li>Assemblies: Agrupacions de dades per comunicaci\u00f3 eficient</li> <li>CIP Objects: Model orientat a objectes (Identity, Connection Manager, etc.)</li> </ul>"},{"location":"IoT/IIoT/protocols/#llibreries-disponibles_1","title":"Llibreries disponibles","text":"Llibreria Llenguatge PLCs suportats Llic\u00e8ncia pycomm3 Python Allen-Bradley MIT libplctag C, Python, .NET Allen-Bradley, Omron LGPL/MPL ethernet-ip Node.js Allen-Bradley MIT Kepware Multi Multi-fabricant Comercial <p>Exemples complets amb Python i Node.js</p>"},{"location":"IoT/IIoT/protocols/#fins-factory-interface-network-service","title":"FINS (Factory Interface Network Service)","text":"<p>Protocol propietari d'Omron per comunicaci\u00f3 amb PLCs de la s\u00e8rie CS, CJ, CP i NX/NJ.</p>"},{"location":"IoT/IIoT/protocols/#caracteristiques_2","title":"Caracter\u00edstiques","text":"<ul> <li>Ports: 9600 (TCP/UDP)</li> <li>Model: Client/Servidor</li> <li>Adre\u00e7ament: \u00c0rees de mem\u00f2ria (D, W, H, A, E, etc.)</li> </ul>"},{"location":"IoT/IIoT/protocols/#comandes-principals","title":"Comandes principals","text":"Codi Descripci\u00f3 0101 Memory Area Read 0102 Memory Area Write 0501 Controller Data Read 0601 Controller Status Read 0401 Run/Stop"},{"location":"IoT/IIoT/protocols/#arees-de-memoria-omron","title":"\u00c0rees de mem\u00f2ria Omron","text":"Codi \u00c0rea Descripci\u00f3 82 D Data Memory B0 W Work Area B1 H Holding Area 00 CIO Core I/O"},{"location":"IoT/IIoT/protocols/#llibreries-disponibles_2","title":"Llibreries disponibles","text":"Llibreria Llenguatge Llic\u00e8ncia omron-fins Node.js MIT Socket raw Python - <p>\ud83d\udcd6 Exemples complets amb Python i Node.js</p>"},{"location":"IoT/IIoT/protocols/#opc-ua-unified-architecture","title":"OPC UA (Unified Architecture)","text":"<p>Est\u00e0ndard internacional (IEC 62541) per interoperabilitat industrial. Successor d'OPC Classic (COM/DCOM).</p>"},{"location":"IoT/IIoT/protocols/#caracteristiques_3","title":"Caracter\u00edstiques","text":"<ul> <li>Port: 4840 (per defecte)</li> <li>Model: Client/Servidor i Pub/Sub</li> <li>Seguretat: Certificats X.509, xifrat, autenticaci\u00f3</li> </ul>"},{"location":"IoT/IIoT/protocols/#arquitectura","title":"Arquitectura","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           OPC UA Application            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502     Information Model (Address Space)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Services (Read, Write, Subscribe...)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   Security (Authentication, Encryption) \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502        Transport (TCP, HTTPS, WSS)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"IoT/IIoT/protocols/#address-space","title":"Address Space","text":"<p>Els nodes s'organitzen en un espai d'adreces jer\u00e0rquic:</p> <ul> <li>Objects: Contenidors de variables i m\u00e8todes</li> <li>Variables: Valors llegibles/escrivibles</li> <li>Methods: Funcions executables</li> <li>Views: Vistes filtrades de l'espai d'adreces</li> </ul>"},{"location":"IoT/IIoT/protocols/#nodeid","title":"NodeId","text":"<p>Identificador \u00fanic de cada node:</p> <pre><code>ns=2;s=MyDevice.Temperature    (String)\nns=2;i=1234                     (Numeric)\n</code></pre>"},{"location":"IoT/IIoT/protocols/#exemple-amb-python-opcua-asyncio","title":"Exemple amb Python (opcua-asyncio)","text":"<pre><code>from asyncua import Client\nimport asyncio\n\nasync def main():\n    async with Client(\"opc.tcp://192.168.1.100:4840\") as client:\n        # Llegir un node\n        node = client.get_node(\"ns=2;s=Temperature\")\n        value = await node.read_value()\n        print(f\"Temperatura: {value}\")\n\n        # Subscripci\u00f3 a canvis\n        handler = SubHandler()\n        sub = await client.create_subscription(500, handler)\n        await sub.subscribe_data_change(node)\n\n        await asyncio.sleep(60)\n\nclass SubHandler:\n    def datachange_notification(self, node, val, data):\n        print(f\"Canvi: {node} = {val}\")\n\nasyncio.run(main())\n</code></pre>"},{"location":"IoT/IIoT/protocols/#eines-utils","title":"Eines \u00fatils","text":"<ul> <li>UaExpert - Client gr\u00e0fic gratu\u00eft per explorar servidors</li> <li>opcua-asyncio - Llibreria Python</li> <li>node-opcua - Llibreria Node.js</li> <li>open62541 - Implementaci\u00f3 C open source</li> </ul>"},{"location":"IoT/IIoT/protocols/#avantatges-i-inconvenients_1","title":"Avantatges i inconvenients","text":"<ul> <li>Seguretat integrada (certificats, xifrat)</li> <li>Interoperabilitat multi-fabricant</li> <li>Model de dades ric i extensible</li> <li>Companion Specifications per sectors</li> <li>Major complexitat d'implementaci\u00f3</li> <li>Requereix m\u00e9s recursos computacionals</li> </ul>"},{"location":"IoT/IIoT/protocols/#profinet","title":"PROFINET","text":"<p>Protocol de Siemens basat en Ethernet industrial. Est\u00e0ndard IEC 61158/61784.</p>"},{"location":"IoT/IIoT/protocols/#classes-de-comunicacio","title":"Classes de comunicaci\u00f3","text":"Classe Nom Cicle \u00das CC-A RT 10-100 ms Automatitzaci\u00f3 est\u00e0ndard CC-B RT 1-10 ms Aplicacions r\u00e0pides CC-C IRT &lt; 1 ms Motion control, sincronitzaci\u00f3"},{"location":"IoT/IIoT/protocols/#caracteristiques_4","title":"Caracter\u00edstiques","text":"<ul> <li>Capa 2 (IRT): Acc\u00e9s directe a Ethernet per temps real</li> <li>TCP/IP (RT): Compatible amb infraestructura IT est\u00e0ndard</li> <li>GSD/GSDML: Fitxers de descripci\u00f3 de dispositius</li> </ul>"},{"location":"IoT/IIoT/protocols/#diferencies-amb-ethernetip","title":"Difer\u00e8ncies amb EtherNet/IP","text":"Aspecte PROFINET EtherNet/IP Origen Siemens Rockwell/ODVA Temps real IRT (Capa 2) CIP Sync Configuraci\u00f3 GSDML (XML) EDS Adopci\u00f3 Europa Am\u00e8rica"},{"location":"IoT/IIoT/protocols/#altres-protocols","title":"Altres protocols","text":""},{"location":"IoT/IIoT/protocols/#bacnetip","title":"BACnet/IP","text":"<p>Protocol per automatitzaci\u00f3 d'edificis (HVAC, il\u00b7luminaci\u00f3). - Port UDP 47808</p>"},{"location":"IoT/IIoT/protocols/#dnp3","title":"DNP3","text":"<p>Protocol per sistemes SCADA en utilities (electricitat, aigua). - Port TCP 20000</p>"},{"location":"IoT/IIoT/protocols/#mqtt","title":"MQTT","text":"<p>Protocol lleuger pub/sub per IoT. Molt usat per connectar dispositius industrials amb el n\u00favol. - Port TCP 1883 (sense TLS), 8883 (amb TLS)</p>"},{"location":"IoT/IIoT/protocols/#coap","title":"CoAP","text":"<p>Protocol REST-like per dispositius amb recursos limitats. - Port UDP 5683</p>"},{"location":"IoT/IIoT/protocols/#seguretat-en-protocols-industrials","title":"Seguretat en protocols industrials","text":""},{"location":"IoT/IIoT/protocols/#consideracions","title":"Consideracions","text":"<ol> <li>Segmentaci\u00f3 de xarxa: Separar OT de IT amb firewalls i DMZ</li> <li>Xifratge: Utilitzar TLS quan sigui possible (OPC UA, MQTT)</li> <li>Autenticaci\u00f3: Implementar control d'acc\u00e9s</li> <li>Monitoritzaci\u00f3: Detectar anomalies en el tr\u00e0fic</li> <li>Actualitzacions: Mantenir firmware i software actualitzats</li> </ol>"},{"location":"IoT/IIoT/protocols/#protocols-i-seguretat-nativa","title":"Protocols i seguretat nativa","text":"Protocol Xifratge Autenticaci\u00f3 Modbus TCP No No EtherNet/IP CIP Security Opcional FINS No No OPC UA TLS Certificats PROFINET Classe 4 Opcional"},{"location":"IoT/IIoT/protocols/#referencies","title":"Refer\u00e8ncies","text":"<ul> <li>Modbus Organization</li> <li>ODVA - EtherNet/IP</li> <li>OPC Foundation</li> <li>PROFIBUS &amp; PROFINET International</li> <li>libplctag</li> <li>opcua-asyncio</li> </ul>"},{"location":"IoT/contenidors/chirpstack/","title":"ChirpStack","text":""},{"location":"IoT/contenidors/chirpstack/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>ChirpStack \u00e9s una plataforma open source per a xarxes LoRaWAN. Proporciona tots els components necessaris per desplegar i gestionar una xarxa LoRaWAN privada.</p>"},{"location":"IoT/contenidors/chirpstack/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>Network Server LoRaWAN complet</li> <li>Gesti\u00f3 de gateways i dispositius</li> <li>Suport per LoRaWAN 1.0.x i 1.1.x</li> <li>Integraci\u00f3 amb m\u00faltiples backends (MQTT, HTTP, InfluxDB, etc.)</li> <li>API REST i gRPC</li> <li>Interf\u00edcie web d'administraci\u00f3</li> </ul>"},{"location":"IoT/contenidors/chirpstack/#components","title":"Components","text":"<ul> <li>ChirpStack: Server principal (v4 unifica tots els components anteriors)</li> <li>ChirpStack Gateway Bridge: Connecta gateways amb ChirpStack</li> </ul>"},{"location":"IoT/contenidors/chirpstack/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/chirpstack/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/chirpstack/#2-crear-carpetes","title":"2. Crear carpetes","text":"<pre><code>mkdir -p /opt/docker/chirpstack/config\nmkdir -p /opt/docker/chirpstack/postgres\nmkdir -p /opt/docker/chirpstack/redis\n</code></pre>"},{"location":"IoT/contenidors/chirpstack/#3-crear-fitxer-de-configuracio","title":"3. Crear fitxer de configuraci\u00f3","text":"<p>Crear <code>/opt/docker/chirpstack/config/chirpstack.toml</code>:</p> <pre><code>[logging]\nlevel = \"info\"\n\n[postgresql]\ndsn = \"postgres://chirpstack:chirpstack@postgres/chirpstack?sslmode=disable\"\nmax_open_connections = 10\n\n[redis]\nservers = [\"redis://redis/\"]\n\n[network]\nnet_id = \"000000\"\nenabled_regions = [\"eu868\"]\n\n[gateway]\n  [gateway.backend]\n    [gateway.backend.mqtt]\n    server = \"tcp://mqtt:1883\"\n    username = \"\"\n    password = \"\"\n\n[integration]\n  [integration.mqtt]\n  server = \"tcp://mqtt:1883\"\n  username = \"\"\n  password = \"\"\n</code></pre>"},{"location":"IoT/contenidors/chirpstack/#4-docker-compose","title":"4. Docker Compose","text":"<pre><code>services:\n  chirpstack:\n    image: chirpstack/chirpstack:4\n    container_name: chirpstack\n    restart: unless-stopped\n    command: -c /etc/chirpstack\n    ports:\n      - \"8080:8080\"   # Web UI i API\n    volumes:\n      - /opt/docker/chirpstack/config:/etc/chirpstack\n    depends_on:\n      - postgres\n      - redis\n      - mqtt\n    networks:\n      - xarxa_IOT\n\n  chirpstack-gateway-bridge:\n    image: chirpstack/chirpstack-gateway-bridge:4\n    container_name: chirpstack-gateway-bridge\n    restart: unless-stopped\n    ports:\n      - \"1700:1700/udp\"   # Semtech UDP\n    environment:\n      - INTEGRATION__MQTT__EVENT_TOPIC_TEMPLATE=eu868/gateway/{{ .GatewayID }}/event/{{ .EventType }}\n      - INTEGRATION__MQTT__STATE_TOPIC_TEMPLATE=eu868/gateway/{{ .GatewayID }}/state/{{ .StateType }}\n      - INTEGRATION__MQTT__COMMAND_TOPIC_TEMPLATE=eu868/gateway/{{ .GatewayID }}/command/#\n      - INTEGRATION__MQTT__AUTH__GENERIC__SERVERS=tcp://mqtt:1883\n    depends_on:\n      - mqtt\n    networks:\n      - xarxa_IOT\n\n  postgres:\n    image: postgres:14-alpine\n    container_name: chirpstack-postgres\n    restart: unless-stopped\n    environment:\n      - POSTGRES_DB=chirpstack\n      - POSTGRES_USER=chirpstack\n      - POSTGRES_PASSWORD=chirpstack\n    volumes:\n      - /opt/docker/chirpstack/postgres:/var/lib/postgresql/data\n    networks:\n      - xarxa_IOT\n\n  redis:\n    image: redis:7-alpine\n    container_name: chirpstack-redis\n    restart: unless-stopped\n    volumes:\n      - /opt/docker/chirpstack/redis:/data\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre> <p>Nota: Aquest docker-compose assumeix que ja tens un broker MQTT (<code>mqtt</code>) a la xarxa. Si no, afegeix el servei MQTT.</p>"},{"location":"IoT/contenidors/chirpstack/#5-iniciar-els-serveis","title":"5. Iniciar els serveis","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"IoT/contenidors/chirpstack/#acces","title":"Acc\u00e9s","text":"<ul> <li>URL: <code>http://localhost:8080</code></li> <li>Usuari: admin</li> <li>Password: admin</li> </ul>"},{"location":"IoT/contenidors/chirpstack/#configuracio-inicial","title":"Configuraci\u00f3 inicial","text":""},{"location":"IoT/contenidors/chirpstack/#1-canviar-password","title":"1. Canviar password","text":"<p>Despr\u00e9s del primer login, canviar el password de l'administrador.</p>"},{"location":"IoT/contenidors/chirpstack/#2-crear-un-device-profile","title":"2. Crear un Device Profile","text":"<ol> <li>Anar a Device profiles \u2192 Add device profile</li> <li>Configurar:</li> <li>Name: Nom del perfil</li> <li>Region: EU868</li> <li>MAC version: LoRaWAN 1.0.3 (o la versi\u00f3 del dispositiu)</li> <li>Regional parameters revision: A o B</li> </ol>"},{"location":"IoT/contenidors/chirpstack/#3-crear-una-application","title":"3. Crear una Application","text":"<ol> <li>Anar a Applications \u2192 Add application</li> <li>Donar un nom a l'aplicaci\u00f3</li> </ol>"},{"location":"IoT/contenidors/chirpstack/#4-afegir-un-dispositiu","title":"4. Afegir un dispositiu","text":"<ol> <li>Dins de l'aplicaci\u00f3, anar a Devices \u2192 Add device</li> <li>Configurar:</li> <li>Name: Nom del dispositiu</li> <li>Device EUI: EUI del dispositiu (16 car\u00e0cters hex)</li> <li>Device profile: Seleccionar el perfil creat</li> </ol>"},{"location":"IoT/contenidors/chirpstack/#5-configurar-claus-otaaabp","title":"5. Configurar claus OTAA/ABP","text":"<p>Segons el mode d'activaci\u00f3 del dispositiu, configurar les claus corresponents.</p>"},{"location":"IoT/contenidors/chirpstack/#integracio-mqtt","title":"Integraci\u00f3 MQTT","text":"<p>ChirpStack publica els events dels dispositius a topics MQTT:</p> <pre><code>application/APPLICATION_ID/device/DEV_EUI/event/up\napplication/APPLICATION_ID/device/DEV_EUI/event/join\napplication/APPLICATION_ID/device/DEV_EUI/event/status\n</code></pre> <p>Per subscriure's a tots els events:</p> <pre><code>mosquitto_sub -h localhost -t \"application/#\" -v\n</code></pre>"},{"location":"IoT/contenidors/chirpstack/#configuracio-de-gateway","title":"Configuraci\u00f3 de Gateway","text":""},{"location":"IoT/contenidors/chirpstack/#configurar-el-gateway-lora","title":"Configurar el gateway LoRa","text":"<p>El gateway s'ha de configurar per enviar dades al Gateway Bridge:</p> <ul> <li>Server: IP del servidor ChirpStack</li> <li>Port: 1700 (UDP)</li> </ul>"},{"location":"IoT/contenidors/chirpstack/#ports","title":"Ports","text":"Port Protocol Descripci\u00f3 8080 HTTP Web UI i API 1700 UDP Semtech UDP (gateways)"},{"location":"IoT/contenidors/chirpstack/#recursos","title":"Recursos","text":"<ul> <li>Documentaci\u00f3 oficial</li> <li>GitHub</li> </ul>"},{"location":"IoT/contenidors/grafana/","title":"Grafana","text":""},{"location":"IoT/contenidors/grafana/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>Grafana \u00e9s una plataforma open source per a visualitzaci\u00f3 i monitoritzaci\u00f3 de dades. Permet crear dashboards interactius amb gr\u00e0fics, alertes i panells personalitzats.</p>"},{"location":"IoT/contenidors/grafana/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>Suport per m\u00faltiples fonts de dades (InfluxDB, Prometheus, MySQL, PostgreSQL, etc.)</li> <li>Dashboards interactius i personalitzables</li> <li>Sistema d'alertes</li> </ul>"},{"location":"IoT/contenidors/grafana/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/grafana/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/grafana/#2-crear-carpetes","title":"2. Crear carpetes","text":"<pre><code>mkdir -p /opt/docker/grafana/data\nchown 472:472 /opt/docker/grafana/data\n</code></pre> <p>L'usuari 472 \u00e9s l'usuari <code>grafana</code> dins del contenidor.</p>"},{"location":"IoT/contenidors/grafana/#3-docker-compose","title":"3. Docker Compose","text":"<pre><code>services:\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    restart: unless-stopped\n    ports:\n      - \"3000:3000\"\n    environment:\n      - GF_SECURITY_ADMIN_USER=admin\n      - GF_SECURITY_ADMIN_PASSWORD=admin\n      - GF_USERS_ALLOW_SIGN_UP=false\n    volumes:\n      - /opt/docker/grafana/data:/var/lib/grafana\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre>"},{"location":"IoT/contenidors/grafana/#4-iniciar-el-servei","title":"4. Iniciar el servei","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"IoT/contenidors/grafana/#acces","title":"Acc\u00e9s","text":"<ul> <li>URL: <code>http://localhost:3000</code></li> <li>Usuari: admin</li> <li>Password: admin (canviar al primer acc\u00e9s)</li> </ul>"},{"location":"IoT/contenidors/grafana/#configurar-font-de-dades-influxdb","title":"Configurar font de dades (InfluxDB)","text":"<ol> <li>Anar a Configuration \u2192 Data Sources</li> <li>Clicar Add data source</li> <li>Seleccionar InfluxDB</li> <li>Configurar:</li> <li>URL: <code>http://influxdb:8086</code> (o <code>http://influxdb3:8181</code> per InfluxDB3)</li> <li>Organization: El nom de l'organitzaci\u00f3</li> <li>Token: El token d'API</li> <li>Default Bucket: El bucket per defecte</li> </ol>"},{"location":"IoT/contenidors/grafana/#variables-dentorn-utils","title":"Variables d'entorn \u00fatils","text":"Variable Descripci\u00f3 Valor per defecte <code>GF_SECURITY_ADMIN_USER</code> Usuari administrador admin <code>GF_SECURITY_ADMIN_PASSWORD</code> Password administrador admin <code>GF_USERS_ALLOW_SIGN_UP</code> Permetre registre true <code>GF_SERVER_ROOT_URL</code> URL base http://localhost:3000 <code>GF_SMTP_ENABLED</code> Habilitar SMTP per alertes false"},{"location":"IoT/contenidors/grafana/#ports","title":"Ports","text":"Port Descripci\u00f3 3000 Interf\u00edcie web"},{"location":"IoT/contenidors/influxdb3/","title":"InfluxDB 3 i InfluxDB3-UI","text":""},{"location":"IoT/contenidors/influxdb3/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>InfluxDB \u00e9s una base de dades de s\u00e8ries temporals (time-series database) optimitzada per a emmagatzemar i consultar dades amb timestamps, ideal per a IoT, monitoritzaci\u00f3 i m\u00e8triques.</p> <p>InfluxDB 3 \u00e9s la nova versi\u00f3 que utilitza Apache Arrow i DataFusion per a un rendiment molt superior. Suporta tant InfluxQL com SQL.</p> <p>InfluxDB3-UI \u00e9s una interf\u00edcie web per gestionar i visualitzar les dades d'InfluxDB 3.</p>"},{"location":"IoT/contenidors/influxdb3/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>Optimitzada per a dades de s\u00e8ries temporals</li> <li>Suport per SQL i InfluxQL</li> <li>Alta compressi\u00f3 de dades</li> <li>Escriptura d'alt rendiment</li> </ul>"},{"location":"IoT/contenidors/influxdb3/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/influxdb3/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#2-crear-carpetes","title":"2. Crear carpetes","text":"<pre><code># Directoris per InfluxDB3\nsudo mkdir -p /opt/docker/influxdb3/data\nsudo mkdir -p /opt/docker/influxdb3/plugins\n\n# Directoris per la UI\nmkdir -p /opt/docker/influxdb3/ui/db\nmkdir -p /opt/docker/influxdb3/ui/config\nmkdir -p /opt/docker/influxdb3/ui/ssl\n\n# Permisos\nsudo chown -R 1000:1000 /opt/docker/influxdb3/\nsudo chown -R 1500:1500 /opt/docker/influxdb3/data\nsudo chmod -R 755 /opt/docker/influxdb3/\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#3-generar-secret-per-la-ui","title":"3. Generar secret per la UI","text":"<pre><code>echo \"SESSION_SECRET_KEY=$(openssl rand -base64 32)\" &gt; /opt/docker/influxdb3/.env\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#4-docker-compose","title":"4. Docker Compose","text":"<pre><code>services:\n  influxdb3:\n    image: influxdb:3-core\n    container_name: influxdb3\n    restart: unless-stopped\n    ports:\n      - \"8181:8181\"\n    volumes:\n      - /opt/docker/influxdb3/data:/var/lib/influxdb3\n      - /opt/docker/influxdb3/plugins:/plugins\n    environment:\n      - INFLUXDB3_NODE_IDENTIFER_PREFIX=iot-node\n    networks:\n      - xarxa_IOT\n\n  influxdb3-ui:\n    image: influxdata/influxdb3-ui:latest\n    container_name: influxdb3-ui\n    restart: unless-stopped\n    ports:\n      - \"8888:8888\"\n    volumes:\n      - /opt/docker/influxdb3/ui/db:/app/db\n      - /opt/docker/influxdb3/ui/config:/app/config\n      - /opt/docker/influxdb3/ui/ssl:/app/ssl\n    env_file:\n      - /opt/docker/influxdb3/.env\n    depends_on:\n      - influxdb3\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#5-iniciar-el-servei","title":"5. Iniciar el servei","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#configuracio-post-installacio","title":"Configuraci\u00f3 post-instal\u00b7laci\u00f3","text":""},{"location":"IoT/contenidors/influxdb3/#generar-token-dadministrador","title":"Generar token d'administrador","text":"<pre><code>docker exec -it influxdb3 influxdb3 create token --admin\n</code></pre> <p>Guardar el token generat (format <code>apiv3_xxxx</code>).</p>"},{"location":"IoT/contenidors/influxdb3/#crear-configuracio-de-la-ui","title":"Crear configuraci\u00f3 de la UI","text":"<p>Crear l'arxiu <code>/opt/docker/influxdb3/ui/config/config.json</code>:</p> <pre><code>{\n  \"DEFAULT_INFLUX_SERVER\": \"http://influxdb3:8181\",\n  \"DEFAULT_INFLUX_DATABASE\": \"\",\n  \"DEFAULT_API_TOKEN\": \"apiv3_EL_TEU_TOKEN\",\n  \"DEFAULT_SERVER_NAME\": \"\"\n}\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#crear-base-de-dades","title":"Crear base de dades","text":"<pre><code>docker exec -it influxdb3 influxdb3 create database IoT --token apiv3_EL_TEU_TOKEN\n</code></pre> <p>Nota: La versi\u00f3 Core (no Enterprise) nom\u00e9s suporta admin tokens.</p>"},{"location":"IoT/contenidors/influxdb3/#acces","title":"Acc\u00e9s","text":"Servei URL Descripci\u00f3 InfluxDB3 API <code>http://localhost:8181</code> API HTTP InfluxDB3-UI <code>http://localhost:8888</code> Interf\u00edcie web"},{"location":"IoT/contenidors/influxdb3/#comandes-utils","title":"Comandes \u00fatils","text":"<pre><code># Llistar bases de dades\ndocker exec -it influxdb3 influxdb3 show databases --token apiv3_TOKEN\n\n# Crear base de dades\ndocker exec -it influxdb3 influxdb3 create database NOM_DB --token apiv3_TOKEN\n\n# Eliminar base de dades\ndocker exec -it influxdb3 influxdb3 delete database NOM_DB --token apiv3_TOKEN\n</code></pre>"},{"location":"IoT/contenidors/influxdb3/#ports","title":"Ports","text":"Port Servei Descripci\u00f3 8181 InfluxDB3 API HTTP 8888 InfluxDB3-UI Interf\u00edcie web"},{"location":"IoT/contenidors/mqtt/","title":"MQTT (Mosquitto)","text":""},{"location":"IoT/contenidors/mqtt/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>MQTT (Message Queuing Telemetry Transport) \u00e9s un protocol de missatgeria lleuger dissenyat per a dispositius amb recursos limitats i xarxes amb ample de banda redu\u00eft. \u00c9s el protocol m\u00e9s utilitzat en IoT.</p> <p>Mosquitto \u00e9s un broker MQTT open source que implementa les versions 5.0, 3.1.1 i 3.1 del protocol.</p>"},{"location":"IoT/contenidors/mqtt/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>Protocol publish/subscribe</li> <li>Lleuger i eficient</li> <li>Suport per a QoS (Quality of Service) nivells 0, 1 i 2</li> <li>Retenci\u00f3 de missatges</li> <li>Last Will and Testament (LWT)</li> <li>Suport per WebSockets</li> </ul>"},{"location":"IoT/contenidors/mqtt/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/mqtt/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/mqtt/#2-crear-carpetes","title":"2. Crear carpetes","text":"<pre><code>mkdir -p /opt/docker/mqtt/data\nmkdir -p /opt/docker/mqtt/config\nchown 1883:1883 /opt/docker/mqtt/config /opt/docker/mqtt/data\n</code></pre>"},{"location":"IoT/contenidors/mqtt/#3-crear-fitxer-de-configuracio","title":"3. Crear fitxer de configuraci\u00f3","text":"<p>Crear l'arxiu <code>/opt/docker/mqtt/config/mosquitto.conf</code>:</p> <pre><code># Fitxer de passwords\npassword_file /mosquitto/config/pwd_usuaris\n\n# MQTT Default listener (port est\u00e0ndard)\nlistener 1883 0.0.0.0\n\n# MQTT over WebSockets\nlistener 9001 0.0.0.0\nprotocol websockets\n\n# Persist\u00e8ncia\npersistence true\npersistence_location /mosquitto/data/\n\n# Logs\nlog_dest file /mosquitto/log/mosquitto.log\nlog_dest stdout\n</code></pre>"},{"location":"IoT/contenidors/mqtt/#4-docker-compose","title":"4. Docker Compose","text":"<pre><code>services:\n  mqtt:\n    image: eclipse-mosquitto:latest\n    container_name: mqtt\n    restart: unless-stopped\n    ports:\n      - \"1883:1883\"   # MQTT\n      - \"9001:9001\"   # WebSockets\n    volumes:\n      - /opt/docker/mqtt/config:/mosquitto/config\n      - /opt/docker/mqtt/data:/mosquitto/data\n      - /opt/docker/mqtt/log:/mosquitto/log\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre>"},{"location":"IoT/contenidors/mqtt/#5-crear-usuaris","title":"5. Crear usuaris","text":"<p>Un cop el contenidor estigui en marxa, crear usuaris amb:</p> <pre><code># Crear primer usuari (opci\u00f3 -c crea el fitxer)\ndocker exec -it mqtt mosquitto_passwd -c /mosquitto/config/pwd_usuaris usuari1\n\n# Afegir m\u00e9s usuaris (sense -c)\ndocker exec -it mqtt mosquitto_passwd /mosquitto/config/pwd_usuaris usuari2\n</code></pre> <p>Reiniciar el contenidor per aplicar els canvis:</p> <pre><code>docker restart mqtt\n</code></pre>"},{"location":"IoT/contenidors/mqtt/#testejar-la-connexio","title":"Testejar la connexi\u00f3","text":""},{"location":"IoT/contenidors/mqtt/#amb-mosquitto_sub-i-mosquitto_pub","title":"Amb mosquitto_sub i mosquitto_pub","text":"<pre><code># Subscriure's a un topic\ndocker exec -it mqtt mosquitto_sub -h localhost -u usuari1 -P password -t \"test/topic\"\n\n# Publicar un missatge (en una altra terminal)\ndocker exec -it mqtt mosquitto_pub -h localhost -u usuari1 -P password -t \"test/topic\" -m \"Hola MQTT!\"\n</code></pre>"},{"location":"IoT/contenidors/mqtt/#ports","title":"Ports","text":"Port Protocol Descripci\u00f3 1883 TCP MQTT est\u00e0ndard 8883 TCP MQTT amb TLS 9001 TCP MQTT sobre WebSockets"},{"location":"IoT/contenidors/nodered/","title":"Node-RED","text":""},{"location":"IoT/contenidors/nodered/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>Node-RED \u00e9s una eina de programaci\u00f3 visual basada en flux (flow-based programming) constru\u00efda sobre Node.js. Permet connectar dispositius, APIs i serveis de manera senzilla mitjan\u00e7ant una interf\u00edcie de drag-and-drop al navegador.</p>"},{"location":"IoT/contenidors/nodered/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>Programaci\u00f3 visual amb nodes</li> <li>Extensa biblioteca de nodes (palettes)</li> <li>Integraci\u00f3 nativa amb MQTT, HTTP, WebSocket</li> <li>F\u00e0cil integraci\u00f3 amb serveis IoT</li> <li>Exportaci\u00f3/importaci\u00f3 de fluxos en format JSON</li> </ul> <p>Refer\u00e8ncia oficial: Node-RED Docker</p>"},{"location":"IoT/contenidors/nodered/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/nodered/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/nodered/#2-crear-carpetes","title":"2. Crear carpetes","text":"<pre><code>sudo mkdir -p /opt/docker/node-red/data/\nchown 1000:1000 /opt/docker/node-red/data/\nchmod 750 /opt/docker/node-red/data/\n</code></pre> <p>L'usuari 1000 \u00e9s l'usuari <code>node-red</code> dins del contenidor.</p>"},{"location":"IoT/contenidors/nodered/#3-docker-compose","title":"3. Docker Compose","text":"<pre><code>services:\n  nodered:\n    image: nodered/node-red:latest\n    container_name: nodered\n    restart: unless-stopped\n    ports:\n      - \"1880:1880\"\n    environment:\n      - TZ=Europe/Madrid\n    volumes:\n      - /opt/docker/node-red/data:/data\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre>"},{"location":"IoT/contenidors/nodered/#4-iniciar-el-servei","title":"4. Iniciar el servei","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"IoT/contenidors/nodered/#acces","title":"Acc\u00e9s","text":"<ul> <li>URL: <code>http://localhost:1880</code></li> </ul>"},{"location":"IoT/contenidors/nodered/#configurar-autenticacio","title":"Configurar autenticaci\u00f3","text":"<p>Per defecte, Node-RED no requereix autenticaci\u00f3. Per habilitar-la:</p>"},{"location":"IoT/contenidors/nodered/#1-generar-hash-de-password","title":"1. Generar hash de password","text":"<pre><code>docker exec -it nodered node-red admin hash-pw\n</code></pre> <p>Introduir el password i copiar el hash generat (format <code>$2b$...</code>).</p>"},{"location":"IoT/contenidors/nodered/#2-editar-settingsjs","title":"2. Editar settings.js","text":"<p>Editar l'arxiu <code>/opt/docker/node-red/data/settings.js</code> i afegir:</p> <pre><code>adminAuth: {\n    type: \"credentials\",\n    users: [{\n        username: \"admin\",\n        password: \"$2b$08$HASH_GENERAT\",\n        permissions: \"*\"\n    },\n    {\n        username: \"viewer\",\n        password: \"$2b$08$ALTRE_HASH\",\n        permissions: \"read\"\n    }]\n},\n</code></pre>"},{"location":"IoT/contenidors/nodered/#3-reiniciar-el-contenidor","title":"3. Reiniciar el contenidor","text":"<pre><code>docker restart nodered\n</code></pre>"},{"location":"IoT/contenidors/nodered/#installar-nodes-addicionals","title":"Instal\u00b7lar nodes addicionals","text":""},{"location":"IoT/contenidors/nodered/#des-de-la-interficie-web","title":"Des de la interf\u00edcie web","text":"<ol> <li>Anar a Menu (\u2261) \u2192 Manage palette</li> <li>Pestanya Install</li> <li>Cercar el node desitjat i clicar Install</li> </ol>"},{"location":"IoT/contenidors/nodered/#des-de-la-linia-de-comandes","title":"Des de la l\u00ednia de comandes","text":"<pre><code>docker exec -it nodered npm install node-red-contrib-influxdb\ndocker restart nodered\n</code></pre>"},{"location":"IoT/contenidors/nodered/#nodes-utils-per-iot","title":"Nodes \u00fatils per IoT","text":"Node Descripci\u00f3 <code>node-red-contrib-influxdb</code> Connexi\u00f3 amb InfluxDB <code>node-red-contrib-modbus</code> Comunicaci\u00f3 Modbus <code>node-red-dashboard</code> Crear dashboards web <code>node-red-contrib-opcua</code> Comunicaci\u00f3 OPC-UA <code>node-red-contrib-telegrambot</code> Integraci\u00f3 amb Telegram"},{"location":"IoT/contenidors/nodered/#exemple-rebre-dades-mqtt-i-enviar-a-influxdb","title":"Exemple: Rebre dades MQTT i enviar a InfluxDB","text":"<ol> <li>Afegir node mqtt in i configurar:</li> <li>Server: <code>mqtt:1883</code></li> <li> <p>Topic: <code>sensors/#</code></p> </li> <li> <p>Afegir node json per parsejar el missatge</p> </li> <li> <p>Afegir node influxdb out i configurar:</p> </li> <li>Server: <code>http://influxdb3:8181</code></li> <li> <p>Database: <code>IoT</code></p> </li> <li> <p>Connectar els nodes i fer Deploy</p> </li> </ol>"},{"location":"IoT/contenidors/nodered/#ports","title":"Ports","text":"Port Descripci\u00f3 1880 Interf\u00edcie web i API"},{"location":"IoT/contenidors/telegraf/","title":"Telegraf","text":""},{"location":"IoT/contenidors/telegraf/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>Telegraf \u00e9s un agent de col\u00b7lecci\u00f3 de m\u00e8triques open source, part de l'stack TICK (Telegraf, InfluxDB, Chronograf, Kapacitor). Permet recollir, processar i enviar m\u00e8triques a diverses destinacions.</p>"},{"location":"IoT/contenidors/telegraf/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>M\u00e9s de 300 plugins d'entrada (inputs)</li> <li>M\u00faltiples sortides (outputs): InfluxDB, Prometheus, Kafka, etc.</li> <li>Baix consum de recursos</li> <li>Configuraci\u00f3 basada en fitxers TOML</li> <li>Suport per MQTT, SNMP, HTTP, i molts altres protocols</li> </ul>"},{"location":"IoT/contenidors/telegraf/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/telegraf/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#2-crear-carpetes-i-configuracio-base","title":"2. Crear carpetes i configuraci\u00f3 base","text":"<pre><code>mkdir -p /opt/docker/telegraf/conf/telegraf.d\n\n# Generar configuraci\u00f3 per defecte\ndocker run --rm telegraf telegraf config &gt; /opt/docker/telegraf/conf/telegraf.conf\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#3-configurar-sortida-a-influxdb","title":"3. Configurar sortida a InfluxDB","text":"<p>Editar <code>/opt/docker/telegraf/conf/telegraf.conf</code> i afegir/modificar la secci\u00f3 <code>outputs.influxdb_v2</code>:</p> <pre><code>[[outputs.influxdb_v2]]\n  urls = [\"http://influxdb:8086\"]\n\n  ## Token d'autenticaci\u00f3\n  token = \"EL_TEU_TOKEN\"\n\n  ## Organitzaci\u00f3 (ha d'existir)\n  organization = \"La_Teva_Org\"\n\n  ## Bucket de destinaci\u00f3\n  bucket = \"telegraf\"\n</code></pre> <p>Per a InfluxDB 3, utilitzar:</p> <pre><code>[[outputs.influxdb_v2]]\n  urls = [\"http://influxdb3:8181\"]\n  token = \"apiv3_EL_TEU_TOKEN\"\n  organization = \"\"\n  bucket = \"IoT\"\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#4-configurar-entrada-mqtt-opcional","title":"4. Configurar entrada MQTT (opcional)","text":"<p>Afegir a la configuraci\u00f3 per rebre dades de MQTT:</p> <pre><code>[[inputs.mqtt_consumer]]\n  servers = [\"tcp://mqtt:1883\"]\n  topics = [\n    \"sensors/#\",\n    \"devices/#\"\n  ]\n  username = \"telegraf\"\n  password = \"password\"\n  data_format = \"json\"\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#5-docker-compose","title":"5. Docker Compose","text":"<pre><code>services:\n  telegraf:\n    image: telegraf:latest\n    container_name: telegraf\n    restart: unless-stopped\n    volumes:\n      - /opt/docker/telegraf/conf/telegraf.conf:/etc/telegraf/telegraf.conf:ro\n      - /opt/docker/telegraf/conf/telegraf.d:/etc/telegraf/telegraf.d:ro\n    depends_on:\n      - influxdb3\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#6-iniciar-el-servei","title":"6. Iniciar el servei","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#exemples-de-configuracio","title":"Exemples de configuraci\u00f3","text":""},{"location":"IoT/contenidors/telegraf/#input-metriques-del-sistema","title":"Input: M\u00e8triques del sistema","text":"<pre><code>[[inputs.cpu]]\n  percpu = true\n  totalcpu = true\n  collect_cpu_time = false\n\n[[inputs.mem]]\n\n[[inputs.disk]]\n  ignore_fs = [\"tmpfs\", \"devtmpfs\"]\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#input-http-listener-rebre-dades-via-http","title":"Input: HTTP Listener (rebre dades via HTTP)","text":"<pre><code>[[inputs.http_listener_v2]]\n  service_address = \":8080\"\n  paths = [\"/telegraf\"]\n  data_format = \"json\"\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#processador-afegir-tags","title":"Processador: Afegir tags","text":"<pre><code>[[processors.override]]\n  [processors.override.tags]\n    environment = \"production\"\n    location = \"barcelona\"\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#verificar-configuracio","title":"Verificar configuraci\u00f3","text":"<pre><code># Testejar la configuraci\u00f3\ndocker exec -it telegraf telegraf --config /etc/telegraf/telegraf.conf --test\n\n# Veure logs\ndocker logs -f telegraf\n</code></pre>"},{"location":"IoT/contenidors/telegraf/#plugins-mes-utilitzats-en-iot","title":"Plugins m\u00e9s utilitzats en IoT","text":"Plugin Tipus Descripci\u00f3 <code>mqtt_consumer</code> Input Subscriure's a topics MQTT <code>http_listener_v2</code> Input Rebre dades via HTTP POST <code>modbus</code> Input Llegir dispositius Modbus <code>snmp</code> Input Consultar dispositius SNMP <code>influxdb_v2</code> Output Enviar a InfluxDB 2.x/3.x <code>mqtt</code> Output Publicar a MQTT"},{"location":"IoT/contenidors/thingsboard/","title":"ThingsBoard","text":""},{"location":"IoT/contenidors/thingsboard/#que-es","title":"Qu\u00e8 \u00e9s?","text":"<p>ThingsBoard \u00e9s una plataforma IoT open source per a la gesti\u00f3 de dispositius, recol\u00b7lecci\u00f3 de dades, processament i visualitzaci\u00f3. Ofereix una soluci\u00f3 completa per a projectes IoT amb dashboards, regles de processament i gesti\u00f3 d'alarmes.</p>"},{"location":"IoT/contenidors/thingsboard/#caracteristiques-principals","title":"Caracter\u00edstiques principals","text":"<ul> <li>Gesti\u00f3 de dispositius i actius</li> <li>Dashboards personalitzables</li> <li>Motor de regles (Rule Engine)</li> <li>Suport multi-tenant</li> <li>Protocols: MQTT, HTTP, CoAP, LwM2M</li> <li>Integraci\u00f3 amb plataformes cloud</li> </ul>"},{"location":"IoT/contenidors/thingsboard/#edicions","title":"Edicions","text":"<ul> <li>Community Edition (CE): Open source, gratu\u00efta</li> <li>Professional Edition (PE): Funcionalitats avan\u00e7ades (de pagament)</li> </ul>"},{"location":"IoT/contenidors/thingsboard/#installacio-amb-docker","title":"Instal\u00b7laci\u00f3 amb Docker","text":""},{"location":"IoT/contenidors/thingsboard/#1-crear-xarxa-docker-si-no-existeix","title":"1. Crear xarxa Docker (si no existeix)","text":"<pre><code>docker network create xarxa_IOT\n</code></pre>"},{"location":"IoT/contenidors/thingsboard/#2-crear-carpetes","title":"2. Crear carpetes","text":"<pre><code>mkdir -p /opt/docker/thingsboard/data\nmkdir -p /opt/docker/thingsboard/logs\nchown -R 799:799 /opt/docker/thingsboard/data\nchown -R 799:799 /opt/docker/thingsboard/logs\n</code></pre>"},{"location":"IoT/contenidors/thingsboard/#3-docker-compose","title":"3. Docker Compose","text":"<pre><code>services:\n  thingsboard:\n    image: thingsboard/tb-postgres:latest\n    container_name: thingsboard\n    restart: unless-stopped\n    ports:\n      - \"8080:9090\"      # UI i API REST\n      - \"1883:1883\"      # MQTT\n      - \"7070:7070\"      # Edge RPC\n      - \"5683-5688:5683-5688/udp\"  # CoAP\n    environment:\n      - TB_QUEUE_TYPE=in-memory\n    volumes:\n      - /opt/docker/thingsboard/data:/data\n      - /opt/docker/thingsboard/logs:/var/log/thingsboard\n    networks:\n      - xarxa_IOT\n\nnetworks:\n  xarxa_IOT:\n    external: true\n</code></pre> <p>Nota: Si ja tens MQTT al port 1883, canvia el port de ThingsBoard: <pre><code>ports:\n  - \"8080:9090\"\n  - \"1884:1883\"   # MQTT en port alternatiu\n</code></pre></p>"},{"location":"IoT/contenidors/thingsboard/#4-iniciar-el-servei","title":"4. Iniciar el servei","text":"<pre><code>docker compose up -d\n</code></pre> <p>El primer inici pot trigar uns minuts mentre es configura la base de dades.</p>"},{"location":"IoT/contenidors/thingsboard/#acces","title":"Acc\u00e9s","text":"<ul> <li>URL: <code>http://localhost:8080</code></li> <li>Usuari: sysadmin@thingsboard.org</li> <li>Password: sysadmin</li> </ul>"},{"location":"IoT/contenidors/thingsboard/#credencials-per-defecte","title":"Credencials per defecte","text":"Rol Usuari Password System Administrator sysadmin@thingsboard.org sysadmin Tenant Administrator tenant@thingsboard.org tenant"},{"location":"IoT/contenidors/thingsboard/#configuracio-inicial","title":"Configuraci\u00f3 inicial","text":""},{"location":"IoT/contenidors/thingsboard/#1-canviar-passwords","title":"1. Canviar passwords","text":"<p>Despr\u00e9s del primer login, canviar immediatament els passwords per defecte.</p>"},{"location":"IoT/contenidors/thingsboard/#2-crear-un-dispositiu","title":"2. Crear un dispositiu","text":"<ol> <li>Anar a Devices \u2192 Add Device</li> <li>Donar un nom al dispositiu</li> <li>Clicar Add</li> <li>Obrir el dispositiu i copiar l'Access Token</li> </ol>"},{"location":"IoT/contenidors/thingsboard/#3-enviar-dades-al-dispositiu","title":"3. Enviar dades al dispositiu","text":""},{"location":"IoT/contenidors/thingsboard/#via-http","title":"Via HTTP","text":"<pre><code>curl -X POST \\\n  http://localhost:8080/api/v1/ACCESS_TOKEN/telemetry \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"temperature\": 25.5, \"humidity\": 60}'\n</code></pre>"},{"location":"IoT/contenidors/thingsboard/#via-mqtt","title":"Via MQTT","text":"<pre><code>mosquitto_pub -h localhost -p 1883 \\\n  -t \"v1/devices/me/telemetry\" \\\n  -u \"ACCESS_TOKEN\" \\\n  -m '{\"temperature\": 25.5, \"humidity\": 60}'\n</code></pre>"},{"location":"IoT/contenidors/thingsboard/#crear-un-dashboard","title":"Crear un Dashboard","text":"<ol> <li>Anar a Dashboards \u2192 Add Dashboard</li> <li>Donar un nom i clicar Add</li> <li>Obrir el dashboard i clicar Enter edit mode</li> <li>Afegir widgets arrossegant des de la biblioteca</li> <li>Configurar cada widget per mostrar les dades del dispositiu</li> </ol>"},{"location":"IoT/contenidors/thingsboard/#variables-dentorn-utils","title":"Variables d'entorn \u00fatils","text":"Variable Descripci\u00f3 Valor per defecte <code>TB_QUEUE_TYPE</code> Tipus de cua in-memory <code>SPRING_DATASOURCE_URL</code> URL de la BD PostgreSQL intern <code>TB_SERVICE_ID</code> ID del servei tb-core"},{"location":"IoT/contenidors/thingsboard/#ports","title":"Ports","text":"Port Protocol Descripci\u00f3 9090 HTTP UI i API REST 1883 MQTT Protocol MQTT 7070 gRPC Edge RPC 5683 UDP CoAP"},{"location":"IoT/contenidors/thingsboard/#recursos","title":"Recursos","text":"<ul> <li>Documentaci\u00f3 oficial</li> <li>GitHub</li> </ul>"},{"location":"Transversal/docker/","title":"Docker","text":"<p>Refer\u00e8ncies:</p> <p>Docker en 14 minuts: https://www.youtube.com/watch?v=6idFknRIOp4</p> <p>Curs de docker m\u00e9s profund: https://www.youtube.com/watch?v=CV_Uf3Dq-EU</p>"},{"location":"Transversal/docker/#comandes-docker-per-recordar","title":"Comandes docker per recordar:","text":"<p>Realitzem aquestes comandes per posar a punt un servidor web amb ubuntu/apache2:</p>"},{"location":"Transversal/docker/#1-baixar-la-imatge-docker-pull","title":"1. Baixar la imatge (docker pull)","text":"<p>Aquest pas descarrega els fitxers de la imatge des del registre oficial (Docker Hub) cap al teu ordinador local.</p> <pre><code>docker pull ubuntu/apache2:2.4-22.04_beta\n</code></pre> <p>Per qu\u00e8? Aix\u00ed t'assegures de tenir sempre la mateixa versi\u00f3 (si \u00e9s nom\u00e9s per una prova, pots utilitzar :latest per obtenir la \u00faltima versi\u00f3)</p>"},{"location":"Transversal/docker/#2-crear-el-contenidor-docker-create","title":"2. Crear el contenidor (docker create)","text":"<p>Aquest pas configura el contenidor (li dona un nom, assigna ports, etc.) per\u00f2 no l'executa encara.</p> <p><pre><code>docker create --name webserver -p 80:80 ubuntu/apache2:2.4-22.04_beta\n</code></pre> - --name el-meu-apache: Assigna un nom personalitzat perqu\u00e8 no hagis d'utilitzar l'ID alfanum\u00e8ric. - -p 80:80: Connecta el port 80 del teu ordinador al port 80 del contenidor (on corre Apache). Podr\u00e0s veure la web entrant a http://ipservidor .</p>"},{"location":"Transversal/docker/#3-iniciar-el-contenidor-docker-start","title":"3. Iniciar el contenidor (docker start)","text":"<p>Finalment, posem en marxa el contenidor que acabem de crear.</p> <pre><code>docker start webserver\n</code></pre> <p>Verificaci\u00f3: Un cop executat, pots obrir el teu navegador i visitar http://ipservidor. Hauries de veure la p\u00e0gina de benvinguda d'Apache a Ubuntu.</p> <p>Verificaci\u00f3 2: podem executar:</p> <pre><code>docker ps -a\n</code></pre> <p>I hauriem de veure tots els contenidors engegats:</p> <pre><code>root@server ~ $ docker ps -a\nCONTAINER ID   IMAGE                            COMMAND                  CREATED          STATUS          PORTS                                                    NAMES\n6dfce0d31eeb   ubuntu/apache2:2.4-22.04_beta    \"apache2-foreground\"     29 seconds ago   Up 18 seconds   0.0.0.0:80-&gt;80/tcp, [::]:80-&gt;80/tcp                      webserver\n</code></pre>"},{"location":"Transversal/docker/#4-entrar-dins-el-contenidor-executar-bash","title":"4. Entrar dins el contenidor (executar bash)","text":"<p>Per obrir una sessi\u00f3 de bash dins del teu contenidor d'Apache, executa:</p> <p><pre><code>docker exec -it webserver bash\n</code></pre> Els par\u00e0metres s\u00f3n:</p> <p>exec: Indica a Docker que vols executar una nova comanda dins d'un contenidor que ja s'est\u00e0 executant.</p> <p>-i (interactive): Mant\u00e9 l'entrada est\u00e0ndard (STDIN) oberta encara que no estiguis connectat. Permet que el contenidor rebi el que escrius.</p> <p>-t (tty): Assigna una pseudoterminal. Aix\u00f2 fa que sembli una terminal real amb colors, format de text i el prompt (el s\u00edmbol root@id:/#).</p> <p>webserver: \u00c9s el nom que li vam posar al contenidor en el pas anterior.</p> <p>bash: \u00c9s el programa que volem obrir (l'int\u00e8rpret de comandes).</p>"},{"location":"Unity/","title":"Introducci\u00f3 a Unity","text":"<p>Refer\u00e8ncies: https://www.youtube.com/watch?v=GbmRt0wydQU</p>"},{"location":"Unity/#installacio","title":"Instal\u00b7laci\u00f3","text":""},{"location":"Unity/#unity-hub","title":"Unity Hub.","text":""},{"location":"Unity/fisiquesmoviment/","title":"F\u00edsiques","text":""},{"location":"Unity/fisiquesmoviment/#rigidbody","title":"Rigidbody","text":"<p>Per a que tingui f\u00edsica</p>"},{"location":"Unity/fisiquesmoviment/#colider","title":"Colider","text":"<p>Per a que colisioni.</p>"},{"location":"Unity/fisiquesmoviment/#moviment","title":"Moviment","text":""},{"location":"Unity/fisiquesmoviment/#components","title":"Components","text":""},{"location":"Unity/fisiquesmoviment/#_1","title":"Fisiques i moviment","text":""},{"location":"Unity/recveu/","title":"Reconeixment de veu amb Unity","text":"<p>https://www.youtube.com/watch?v=zGnhZX08k24</p>"},{"location":"Unity/scenesprites/","title":"Scene (Tiles)","text":""},{"location":"Unity/scenesprites/#tileset","title":"Tileset","text":""},{"location":"Unity/scenesprites/#slice","title":"Slice","text":""},{"location":"Unity/scenesprites/#sprites","title":"Sprites","text":""},{"location":"Unity/scenesprites/#slice_1","title":"Slice","text":""}]}